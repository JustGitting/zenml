
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sdkdocs.zenml.io/0.68.0/integration_code_docs/integrations-skypilot/">
      
      <link rel="icon" href="../../_assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-8.5.10">
    
    
      
        <title>Skypilot - ZenML API Reference</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    

<script>
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="CaE5VaNjhyaUt48qXK4rLwwKJ0PdAOFM";;analytics.SNIPPET_VERSION="4.15.3";
  analytics.load("CaE5VaNjhyaUt48qXK4rLwwKJ0PdAOFM");
  analytics.page();
  }}();
</script>
<script defer data-domain="apidocs.zenml.io" src="https://plausible.io/js/plausible.js"></script>


  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#skypilot" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ZenML API Reference" class="md-header__button md-logo" aria-label="ZenML API Reference" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZenML API Reference
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Skypilot
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/zenml-io/zenml" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ZenML API Reference" class="md-nav__button md-logo" aria-label="ZenML API Reference" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ZenML API Reference
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zenml-io/zenml" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        ZenML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        CLI docs
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Core code docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core code docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Core code docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-actions/" class="md-nav__link">
        Actions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-alerter/" class="md-nav__link">
        Alerter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-analytics/" class="md-nav__link">
        Analytics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-annotators/" class="md-nav__link">
        Annotators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-api/" class="md-nav__link">
        Api
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-artifact_stores/" class="md-nav__link">
        Artifact Stores
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-artifacts/" class="md-nav__link">
        Artifacts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-client/" class="md-nav__link">
        Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-client_lazy_loader/" class="md-nav__link">
        Client Lazy Loader
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-code_repositories/" class="md-nav__link">
        Code Repositories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-config/" class="md-nav__link">
        Config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-console/" class="md-nav__link">
        Console
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-container_registries/" class="md-nav__link">
        Container Registries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-data_validators/" class="md-nav__link">
        Data Validators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-entrypoints/" class="md-nav__link">
        Entrypoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-enums/" class="md-nav__link">
        Enums
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-environment/" class="md-nav__link">
        Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-event_hub/" class="md-nav__link">
        Event Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-event_sources/" class="md-nav__link">
        Event Sources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-experiment_trackers/" class="md-nav__link">
        Experiment Trackers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-feature_stores/" class="md-nav__link">
        Feature Stores
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-hooks/" class="md-nav__link">
        Hooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-image_builders/" class="md-nav__link">
        Image Builders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-io/" class="md-nav__link">
        Io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-logger/" class="md-nav__link">
        Logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-materializers/" class="md-nav__link">
        Materializers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-metadata/" class="md-nav__link">
        Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-model/" class="md-nav__link">
        Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-model_deployers/" class="md-nav__link">
        Model Deployers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-model_registries/" class="md-nav__link">
        Model Registries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-orchestrators/" class="md-nav__link">
        Orchestrators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-pipelines/" class="md-nav__link">
        Pipelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-secret/" class="md-nav__link">
        Secret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-service_connectors/" class="md-nav__link">
        Service Connectors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-services/" class="md-nav__link">
        Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-stack/" class="md-nav__link">
        Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-stack_deployments/" class="md-nav__link">
        Stack Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-step_operators/" class="md-nav__link">
        Step Operators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-steps/" class="md-nav__link">
        Steps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-types/" class="md-nav__link">
        Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-zen_server/" class="md-nav__link">
        Zen Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-zen_stores/" class="md-nav__link">
        Zen Stores
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Integration code docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integration code docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Integration code docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-airflow/" class="md-nav__link">
        Airflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-argilla/" class="md-nav__link">
        Argilla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-aws/" class="md-nav__link">
        Aws
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-azure/" class="md-nav__link">
        Azure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-bentoml/" class="md-nav__link">
        Bentoml
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-bitbucket/" class="md-nav__link">
        Bitbucket
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-comet/" class="md-nav__link">
        Comet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-databricks/" class="md-nav__link">
        Databricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-deepchecks/" class="md-nav__link">
        Deepchecks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-discord/" class="md-nav__link">
        Discord
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-evidently/" class="md-nav__link">
        Evidently
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-facets/" class="md-nav__link">
        Facets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-feast/" class="md-nav__link">
        Feast
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-gcp/" class="md-nav__link">
        Gcp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-github/" class="md-nav__link">
        Github
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-gitlab/" class="md-nav__link">
        Gitlab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-great_expectations/" class="md-nav__link">
        Great Expectations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-huggingface/" class="md-nav__link">
        Huggingface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-hyperai/" class="md-nav__link">
        Hyperai
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-integration/" class="md-nav__link">
        Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-kaniko/" class="md-nav__link">
        Kaniko
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-kubeflow/" class="md-nav__link">
        Kubeflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-label_studio/" class="md-nav__link">
        Label Studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-langchain/" class="md-nav__link">
        Langchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-lightgbm/" class="md-nav__link">
        Lightgbm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-lightning/" class="md-nav__link">
        Lightning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-llama_index/" class="md-nav__link">
        Llama Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-mlflow/" class="md-nav__link">
        Mlflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-neptune/" class="md-nav__link">
        Neptune
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-neural_prophet/" class="md-nav__link">
        Neural Prophet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-openai/" class="md-nav__link">
        Openai
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pigeon/" class="md-nav__link">
        Pigeon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pillow/" class="md-nav__link">
        Pillow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-polars/" class="md-nav__link">
        Polars
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-prodigy/" class="md-nav__link">
        Prodigy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pycaret/" class="md-nav__link">
        Pycaret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pytorch/" class="md-nav__link">
        Pytorch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pytorch_lightning/" class="md-nav__link">
        Pytorch Lightning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-registry/" class="md-nav__link">
        Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-s3/" class="md-nav__link">
        S3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-scipy/" class="md-nav__link">
        Scipy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-seldon/" class="md-nav__link">
        Seldon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-sklearn/" class="md-nav__link">
        Sklearn
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Skypilot
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Skypilot
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot" class="md-nav__link">
    skypilot
  </a>
  
    <nav class="md-nav" aria-label="skypilot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors" class="md-nav__link">
    flavors
  </a>
  
    <nav class="md-nav" aria-label="flavors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config" class="md-nav__link">
    skypilot_orchestrator_base_vm_config
  </a>
  
    <nav class="md-nav" aria-label="skypilot_orchestrator_base_vm_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorConfig" class="md-nav__link">
    SkypilotBaseOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="SkypilotBaseOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorConfig.is_local" class="md-nav__link">
    is_local
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorSettings" class="md-nav__link">
    SkypilotBaseOrchestratorSettings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators" class="md-nav__link">
    orchestrators
  </a>
  
    <nav class="md-nav" aria-label="orchestrators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator" class="md-nav__link">
    skypilot_base_vm_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="skypilot_base_vm_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator" class="md-nav__link">
    SkypilotBaseOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="SkypilotBaseOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.cloud" class="md-nav__link">
    cloud
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.prepare_environment_variable" class="md-nav__link">
    prepare_environment_variable()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.sanitize_cluster_name" class="md-nav__link">
    sanitize_cluster_name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.setup_credentials" class="md-nav__link">
    setup_credentials()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint" class="md-nav__link">
    skypilot_orchestrator_entrypoint
  </a>
  
    <nav class="md-nav" aria-label="skypilot_orchestrator_entrypoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint.main" class="md-nav__link">
    main()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint.parse_args" class="md-nav__link">
    parse_args()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration" class="md-nav__link">
    skypilot_orchestrator_entrypoint_configuration
  </a>
  
    <nav class="md-nav" aria-label="skypilot_orchestrator_entrypoint_configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration" class="md-nav__link">
    SkypilotOrchestratorEntrypointConfiguration
  </a>
  
    <nav class="md-nav" aria-label="SkypilotOrchestratorEntrypointConfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_arguments" class="md-nav__link">
    get_entrypoint_arguments()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_command" class="md-nav__link">
    get_entrypoint_command()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_options" class="md-nav__link">
    get_entrypoint_options()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_aws/" class="md-nav__link">
        Skypilot Aws
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_azure/" class="md-nav__link">
        Skypilot Azure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_gcp/" class="md-nav__link">
        Skypilot Gcp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_kubernetes/" class="md-nav__link">
        Skypilot Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_lambda/" class="md-nav__link">
        Skypilot Lambda
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-slack/" class="md-nav__link">
        Slack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-spark/" class="md-nav__link">
        Spark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-tekton/" class="md-nav__link">
        Tekton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-tensorboard/" class="md-nav__link">
        Tensorboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-tensorflow/" class="md-nav__link">
        Tensorflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-wandb/" class="md-nav__link">
        Wandb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-whylogs/" class="md-nav__link">
        Whylogs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-xgboost/" class="md-nav__link">
        Xgboost
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot" class="md-nav__link">
    skypilot
  </a>
  
    <nav class="md-nav" aria-label="skypilot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors" class="md-nav__link">
    flavors
  </a>
  
    <nav class="md-nav" aria-label="flavors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config" class="md-nav__link">
    skypilot_orchestrator_base_vm_config
  </a>
  
    <nav class="md-nav" aria-label="skypilot_orchestrator_base_vm_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorConfig" class="md-nav__link">
    SkypilotBaseOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="SkypilotBaseOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorConfig.is_local" class="md-nav__link">
    is_local
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorSettings" class="md-nav__link">
    SkypilotBaseOrchestratorSettings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators" class="md-nav__link">
    orchestrators
  </a>
  
    <nav class="md-nav" aria-label="orchestrators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator" class="md-nav__link">
    skypilot_base_vm_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="skypilot_base_vm_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator" class="md-nav__link">
    SkypilotBaseOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="SkypilotBaseOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.cloud" class="md-nav__link">
    cloud
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.prepare_environment_variable" class="md-nav__link">
    prepare_environment_variable()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.sanitize_cluster_name" class="md-nav__link">
    sanitize_cluster_name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.setup_credentials" class="md-nav__link">
    setup_credentials()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint" class="md-nav__link">
    skypilot_orchestrator_entrypoint
  </a>
  
    <nav class="md-nav" aria-label="skypilot_orchestrator_entrypoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint.main" class="md-nav__link">
    main()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint.parse_args" class="md-nav__link">
    parse_args()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration" class="md-nav__link">
    skypilot_orchestrator_entrypoint_configuration
  </a>
  
    <nav class="md-nav" aria-label="skypilot_orchestrator_entrypoint_configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration" class="md-nav__link">
    SkypilotOrchestratorEntrypointConfiguration
  </a>
  
    <nav class="md-nav" aria-label="SkypilotOrchestratorEntrypointConfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_arguments" class="md-nav__link">
    get_entrypoint_arguments()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_command" class="md-nav__link">
    get_entrypoint_command()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_options" class="md-nav__link">
    get_entrypoint_options()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/zenml-io/zenml/docs/integration_code_docs/integrations-skypilot.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="skypilot">Skypilot</h1>


  <div class="doc doc-object doc-module">



<h2 id="zenml.integrations.skypilot" class="doc doc-heading">
        <code>zenml.integrations.skypilot</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents first">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.skypilot.flavors" class="doc doc-heading">
        <code>flavors</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config" class="doc doc-heading">
        <code>skypilot_orchestrator_base_vm_config</code>



</h4>

    <div class="doc doc-contents ">

      <p>Skypilot orchestrator base config and settings.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorConfig" class="doc doc-heading">
        <code>
SkypilotBaseOrchestratorConfig            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig" href="../../core_code_docs/core-orchestrators/#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig">BaseOrchestratorConfig</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorSettings" href="#zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorSettings">SkypilotBaseOrchestratorSettings</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Skypilot orchestrator base config.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>disable_step_based_settings</code></td>
        <td><code>bool</code></td>
        <td><p>whether to disable step-based settings.
If True, the orchestrator will run all steps with the pipeline
settings in one single VM. If False, the orchestrator will run
each step with its own settings in separate VMs if provided.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/flavors/skypilot_orchestrator_base_vm_config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SkypilotBaseOrchestratorConfig</span><span class="p">(</span>
    <span class="n">BaseOrchestratorConfig</span><span class="p">,</span> <span class="n">SkypilotBaseOrchestratorSettings</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Skypilot orchestrator base config.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        disable_step_based_settings: whether to disable step-based settings.</span>
<span class="sd">            If True, the orchestrator will run all steps with the pipeline</span>
<span class="sd">            settings in one single VM. If False, the orchestrator will run</span>
<span class="sd">            each step with its own settings in separate VMs if provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">disable_step_based_settings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_local</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if this stack component is running locally.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this config is for a local component, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorConfig.is_local" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_local</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Checks if this stack component is running locally.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if this config is for a local component, False otherwise.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.skypilot.flavors.skypilot_orchestrator_base_vm_config.SkypilotBaseOrchestratorSettings" class="doc doc-heading">
        <code>
SkypilotBaseOrchestratorSettings            (<a class="autorefs autorefs-internal" title="zenml.config.base_settings.BaseSettings" href="../../core_code_docs/core-config/#zenml.config.base_settings.BaseSettings">BaseSettings</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Skypilot orchestrator base settings.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>instance_type</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the instance type to use.</p></td>
      </tr>
      <tr>
        <td><code>cpus</code></td>
        <td><code>Union[NoneType, int, float, str]</code></td>
        <td><p>the number of CPUs required for the task.
If a str, must be a string of the form <code>'2'</code> or <code>'2+'</code>, where
the <code>+</code> indicates that the task requires at least 2 CPUs.</p></td>
      </tr>
      <tr>
        <td><code>memory</code></td>
        <td><code>Union[NoneType, int, float, str]</code></td>
        <td><p>the amount of memory in GiB required. If a
str, must be a string of the form <code>'16'</code> or <code>'16+'</code>, where
the <code>+</code> indicates that the task requires at least 16 GB of memory.</p></td>
      </tr>
      <tr>
        <td><code>accelerators</code></td>
        <td><code>Union[NoneType, str, Dict[str, int]]</code></td>
        <td><p>the accelerators required. If a str, must be
a string of the form <code>'V100'</code> or <code>'V100:2'</code>, where the <code>:2</code>
indicates that the task requires 2 V100 GPUs. If a dict, must be a
dict of the form <code>{'V100': 2}</code> or <code>{'tpu-v2-8': 1}</code>.</p></td>
      </tr>
      <tr>
        <td><code>accelerator_args</code></td>
        <td><code>Optional[Dict[str, str]]</code></td>
        <td><p>accelerator-specific arguments. For example,
<code>{'tpu_vm': True, 'runtime_version': 'tpu-vm-base'}</code> for TPUs.</p></td>
      </tr>
      <tr>
        <td><code>use_spot</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>whether to use spot instances. If None, defaults to
False.</p></td>
      </tr>
      <tr>
        <td><code>job_recovery</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the spot recovery strategy to use for the managed
spot to recover the cluster from preemption. Refer to
<code>recovery_strategy module &lt;https://github.com/skypilot-org/skypilot/blob/master/sky/spot/recovery_strategy.py&gt;</code>__ # pylint: disable=line-too-long
for more details.</p></td>
      </tr>
      <tr>
        <td><code>region</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the region to use.</p></td>
      </tr>
      <tr>
        <td><code>zone</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the zone to use.</p></td>
      </tr>
      <tr>
        <td><code>image_id</code></td>
        <td><code>Union[Dict[str, str], str]</code></td>
        <td><p>the image ID to use. If a str, must be a string
of the image id from the cloud, such as AWS:
<code>'ami-1234567890abcdef0'</code>, GCP:
<code>'projects/my-project-id/global/images/my-image-name'</code>;
Or, a image tag provided by SkyPilot, such as AWS:
<code>'skypilot:gpu-ubuntu-2004'</code>. If a dict, must be a dict mapping
from region to image ID, such as:</p>
<p>.. code-block:: python</p>
<pre><code>{
'us-west1': 'ami-1234567890abcdef0',
'us-east1': 'ami-1234567890abcdef0'
}
</code></pre></td>
      </tr>
      <tr>
        <td><code>disk_size</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>the size of the OS disk in GiB.</p></td>
      </tr>
      <tr>
        <td><code>disk_tier</code></td>
        <td><code>Optional[Literal[&#39;high&#39;, &#39;medium&#39;, &#39;low&#39;]]</code></td>
        <td><p>the disk performance tier to use. If None, defaults to
<code>'medium'</code>.</p></td>
      </tr>
      <tr>
        <td><code>cluster_name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>name of the cluster to create/reuse.  If None,
auto-generate a name.</p></td>
      </tr>
      <tr>
        <td><code>retry_until_up</code></td>
        <td><code>bool</code></td>
        <td><p>whether to retry launching the cluster until it is
up.</p></td>
      </tr>
      <tr>
        <td><code>idle_minutes_to_autostop</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>automatically stop the cluster after this
many minute of idleness, i.e., no running or pending jobs in the
cluster's job queue. Idleness gets reset whenever setting-up/
running/pending jobs are found in the job queue. Setting this
flag is equivalent to running
<code>sky.launch(..., detach_run=True, ...)</code> and then
<code>sky.autostop(idle_minutes=&lt;minutes&gt;)</code>. If not set, the cluster
will not be autostopped.</p></td>
      </tr>
      <tr>
        <td><code>down</code></td>
        <td><code>bool</code></td>
        <td><p>Tear down the cluster after all jobs finish (successfully or
abnormally). If --idle-minutes-to-autostop is also set, the
cluster will be torn down after the specified idle time.
Note that if errors occur during provisioning/data syncing/setting
up, the cluster will not be torn down for debugging purposes.</p></td>
      </tr>
      <tr>
        <td><code>stream_logs</code></td>
        <td><code>bool</code></td>
        <td><p>if True, show the logs in the terminal.</p></td>
      </tr>
      <tr>
        <td><code>docker_run_args</code></td>
        <td><code>List[str]</code></td>
        <td><p>Optional arguments to pass to the <code>docker run</code> command
running inside the VM.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/flavors/skypilot_orchestrator_base_vm_config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SkypilotBaseOrchestratorSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Skypilot orchestrator base settings.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        instance_type: the instance type to use.</span>
<span class="sd">        cpus: the number of CPUs required for the task.</span>
<span class="sd">            If a str, must be a string of the form `&#39;2&#39;` or `&#39;2+&#39;`, where</span>
<span class="sd">            the `+` indicates that the task requires at least 2 CPUs.</span>
<span class="sd">        memory: the amount of memory in GiB required. If a</span>
<span class="sd">            str, must be a string of the form `&#39;16&#39;` or `&#39;16+&#39;`, where</span>
<span class="sd">            the `+` indicates that the task requires at least 16 GB of memory.</span>
<span class="sd">        accelerators: the accelerators required. If a str, must be</span>
<span class="sd">            a string of the form `&#39;V100&#39;` or `&#39;V100:2&#39;`, where the `:2`</span>
<span class="sd">            indicates that the task requires 2 V100 GPUs. If a dict, must be a</span>
<span class="sd">            dict of the form `{&#39;V100&#39;: 2}` or `{&#39;tpu-v2-8&#39;: 1}`.</span>
<span class="sd">        accelerator_args: accelerator-specific arguments. For example,</span>
<span class="sd">            `{&#39;tpu_vm&#39;: True, &#39;runtime_version&#39;: &#39;tpu-vm-base&#39;}` for TPUs.</span>
<span class="sd">        use_spot: whether to use spot instances. If None, defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        job_recovery: the spot recovery strategy to use for the managed</span>
<span class="sd">            spot to recover the cluster from preemption. Refer to</span>
<span class="sd">            `recovery_strategy module &lt;https://github.com/skypilot-org/skypilot/blob/master/sky/spot/recovery_strategy.py&gt;`__ # pylint: disable=line-too-long</span>
<span class="sd">            for more details.</span>
<span class="sd">        region: the region to use.</span>
<span class="sd">        zone: the zone to use.</span>
<span class="sd">        image_id: the image ID to use. If a str, must be a string</span>
<span class="sd">            of the image id from the cloud, such as AWS:</span>
<span class="sd">            ``&#39;ami-1234567890abcdef0&#39;``, GCP:</span>
<span class="sd">            ``&#39;projects/my-project-id/global/images/my-image-name&#39;``;</span>
<span class="sd">            Or, a image tag provided by SkyPilot, such as AWS:</span>
<span class="sd">            ``&#39;skypilot:gpu-ubuntu-2004&#39;``. If a dict, must be a dict mapping</span>
<span class="sd">            from region to image ID, such as:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                {</span>
<span class="sd">                &#39;us-west1&#39;: &#39;ami-1234567890abcdef0&#39;,</span>
<span class="sd">                &#39;us-east1&#39;: &#39;ami-1234567890abcdef0&#39;</span>
<span class="sd">                }</span>

<span class="sd">        disk_size: the size of the OS disk in GiB.</span>
<span class="sd">        disk_tier: the disk performance tier to use. If None, defaults to</span>
<span class="sd">            ``&#39;medium&#39;``.</span>

<span class="sd">        cluster_name: name of the cluster to create/reuse.  If None,</span>
<span class="sd">            auto-generate a name.</span>
<span class="sd">        retry_until_up: whether to retry launching the cluster until it is</span>
<span class="sd">            up.</span>
<span class="sd">        idle_minutes_to_autostop: automatically stop the cluster after this</span>
<span class="sd">            many minute of idleness, i.e., no running or pending jobs in the</span>
<span class="sd">            cluster&#39;s job queue. Idleness gets reset whenever setting-up/</span>
<span class="sd">            running/pending jobs are found in the job queue. Setting this</span>
<span class="sd">            flag is equivalent to running</span>
<span class="sd">            ``sky.launch(..., detach_run=True, ...)`` and then</span>
<span class="sd">            ``sky.autostop(idle_minutes=&lt;minutes&gt;)``. If not set, the cluster</span>
<span class="sd">            will not be autostopped.</span>
<span class="sd">        down: Tear down the cluster after all jobs finish (successfully or</span>
<span class="sd">            abnormally). If --idle-minutes-to-autostop is also set, the</span>
<span class="sd">            cluster will be torn down after the specified idle time.</span>
<span class="sd">            Note that if errors occur during provisioning/data syncing/setting</span>
<span class="sd">            up, the cluster will not be torn down for debugging purposes.</span>
<span class="sd">        stream_logs: if True, show the logs in the terminal.</span>
<span class="sd">        docker_run_args: Optional arguments to pass to the `docker run` command</span>
<span class="sd">            running inside the VM.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Resources</span>
    <span class="n">instance_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cpus</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">union_mode</span><span class="o">=</span><span class="s2">&quot;left_to_right&quot;</span>
    <span class="p">)</span>
    <span class="n">memory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">union_mode</span><span class="o">=</span><span class="s2">&quot;left_to_right&quot;</span>
    <span class="p">)</span>
    <span class="n">accelerators</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">union_mode</span><span class="o">=</span><span class="s2">&quot;left_to_right&quot;</span>
    <span class="p">)</span>
    <span class="n">accelerator_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">use_spot</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">job_recovery</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">region</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">zone</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">image_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">union_mode</span><span class="o">=</span><span class="s2">&quot;left_to_right&quot;</span>
    <span class="p">)</span>
    <span class="n">disk_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">disk_tier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Run settings</span>
    <span class="n">cluster_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">retry_until_up</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">idle_minutes_to_autostop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">down</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stream_logs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">docker_run_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



























  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.skypilot.orchestrators" class="doc doc-heading">
        <code>orchestrators</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Initialization of the Skypilot ZenML orchestrators.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator" class="doc doc-heading">
        <code>skypilot_base_vm_orchestrator</code>



</h4>

    <div class="doc doc-contents ">

      <p>Implementation of the Skypilot base VM orchestrator.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator" class="doc doc-heading">
        <code>
SkypilotBaseOrchestrator            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator" href="../../core_code_docs/core-orchestrators/#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator">ContainerizedOrchestrator</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Base class for Orchestrator responsible for running pipelines remotely in a VM.</p>
<p>This orchestrator does not support running on a schedule.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_base_vm_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SkypilotBaseOrchestrator</span><span class="p">(</span><span class="n">ContainerizedOrchestrator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for Orchestrator responsible for running pipelines remotely in a VM.</span>

<span class="sd">    This orchestrator does not support running on a schedule.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The default instance type to use if none is specified in settings</span>
    <span class="n">DEFAULT_INSTANCE_TYPE</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StackValidator</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the stack.</span>

<span class="sd">        In the remote case, checks that the stack contains a container registry,</span>
<span class="sd">        image builder and only remote components.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `StackValidator` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_validate_remote_components</span><span class="p">(</span>
            <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">stack</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">is_local</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The Skypilot orchestrator runs pipelines remotely, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;but the &#39;</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> is &quot;</span>
                    <span class="s2">&quot;a local stack component and will not be available in &quot;</span>
                    <span class="s2">&quot;the Skypilot step.</span><span class="se">\n</span><span class="s2">Please ensure that you always &quot;</span>
                    <span class="s2">&quot;use non-local stack components with the Skypilot &quot;</span>
                    <span class="s2">&quot;orchestrator.&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="n">StackValidator</span><span class="p">(</span>
            <span class="n">required_components</span><span class="o">=</span><span class="p">{</span>
                <span class="n">StackComponentType</span><span class="o">.</span><span class="n">CONTAINER_REGISTRY</span><span class="p">,</span>
                <span class="n">StackComponentType</span><span class="o">.</span><span class="n">IMAGE_BUILDER</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">custom_validation_function</span><span class="o">=</span><span class="n">_validate_remote_components</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the active orchestrator run id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the environment variable specifying the run id</span>
<span class="sd">                is not set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The orchestrator run id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ENV_ZENML_SKYPILOT_ORCHESTRATOR_RUN_ID</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to read run id from environment variable &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ENV_ZENML_SKYPILOT_ORCHESTRATOR_RUN_ID</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SkypilotBaseOrchestratorConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `SkypilotBaseOrchestratorConfig` config.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">SkypilotBaseOrchestratorConfig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">cloud</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sky</span><span class="o">.</span><span class="n">clouds</span><span class="o">.</span><span class="n">Cloud</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The type of sky cloud to use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `sky.clouds.Cloud` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up credentials for the orchestrator.&quot;&quot;&quot;</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connector</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">connector</span><span class="o">.</span><span class="n">configure_local_client</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">prepare_environment_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">set</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up Environment variables that are required for the orchestrator.</span>

<span class="sd">        Args:</span>
<span class="sd">            set: Whether to set the environment variables or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
        <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs each pipeline step in a separate Skypilot container.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">            stack: The stack the pipeline will run on.</span>
<span class="sd">            environment: Environment variables to set in the orchestration</span>
<span class="sd">                environment.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If the pipeline run fails.</span>
<span class="sd">            RuntimeError: If the code is running in a notebook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First check whether the code is running in a notebook.</span>
        <span class="k">if</span> <span class="n">Environment</span><span class="o">.</span><span class="n">in_notebook</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The Skypilot orchestrator cannot run pipelines in a notebook &quot;</span>
                <span class="s2">&quot;environment. The reason is that it is non-trivial to create &quot;</span>
                <span class="s2">&quot;a Docker image of a notebook. Please consider refactoring &quot;</span>
                <span class="s2">&quot;your notebook cells into separate scripts in a Python module &quot;</span>
                <span class="s2">&quot;and run the code outside of a notebook when using this &quot;</span>
                <span class="s2">&quot;orchestrator.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Skypilot Orchestrator currently does not support the &quot;</span>
                <span class="s2">&quot;use of schedules. The `schedule` will be ignored &quot;</span>
                <span class="s2">&quot;and the pipeline will be run immediately.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Set up some variables for configuration</span>
        <span class="n">orchestrator_run_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">environment</span><span class="p">[</span><span class="n">ENV_ZENML_SKYPILOT_ORCHESTRATOR_RUN_ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">orchestrator_run_id</span>
        <span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">SkypilotBaseOrchestratorSettings</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">deployment</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span>
        <span class="n">orchestrator_run_name</span> <span class="o">=</span> <span class="n">get_orchestrator_run_name</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span>

        <span class="c1"># Get Docker image for the orchestrator pod</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># If no generic pipeline image exists (which means all steps have</span>
            <span class="c1"># custom builds) we use a random step image as all of them include</span>
            <span class="c1"># dependencies for the active stack</span>
            <span class="n">pipeline_step_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">))</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
                <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span> <span class="n">step_name</span><span class="o">=</span><span class="n">pipeline_step_name</span>
            <span class="p">)</span>

        <span class="n">different_settings_found</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">disable_step_based_settings</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">step_settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">SkypilotBaseOrchestratorSettings</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">step_settings</span> <span class="o">!=</span> <span class="n">settings</span><span class="p">:</span>
                    <span class="n">different_settings_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;At least one step has different settings than the &quot;</span>
                        <span class="s2">&quot;pipeline. The step with different settings will be &quot;</span>
                        <span class="s2">&quot;run in a separate VM.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;You can configure the orchestrator to disable this &quot;</span>
                        <span class="s2">&quot;behavior by updating the `disable_step_based_settings` &quot;</span>
                        <span class="s2">&quot;in your orchestrator configuration &quot;</span>
                        <span class="s2">&quot;by running the following command: &quot;</span>
                        <span class="s2">&quot;`zenml orchestrator update --disable-step-based-settings=True`&quot;</span>
                    <span class="p">)</span>
                    <span class="k">break</span>

        <span class="c1"># Decide which configuration to use based on whether different settings were found</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">disable_step_based_settings</span>
            <span class="ow">and</span> <span class="n">different_settings_found</span>
        <span class="p">):</span>
            <span class="c1"># Run each step in a separate VM using SkypilotOrchestratorEntrypointConfiguration</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">SkypilotOrchestratorEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">SkypilotOrchestratorEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
                <span class="n">run_name</span><span class="o">=</span><span class="n">orchestrator_run_name</span><span class="p">,</span>
                <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Run the entire pipeline in one VM using PipelineEntrypointConfiguration</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">PipelineEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">PipelineEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
                <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span>
            <span class="p">)</span>

        <span class="n">entrypoint_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">arguments_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">task_envs</span> <span class="o">=</span> <span class="n">environment</span>
        <span class="n">docker_environment_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;-e </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">custom_run_args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">docker_run_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">custom_run_args</span><span class="p">:</span>
            <span class="n">custom_run_args</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>

        <span class="n">instance_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">instance_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_INSTANCE_TYPE</span>

        <span class="c1"># Set up credentials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_credentials</span><span class="p">()</span>

        <span class="c1"># Guaranteed by stack validation</span>
        <span class="k">assert</span> <span class="n">stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">docker_creds</span> <span class="o">:=</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span><span class="o">.</span><span class="n">credentials</span><span class="p">:</span>
            <span class="n">docker_username</span><span class="p">,</span> <span class="n">docker_password</span> <span class="o">=</span> <span class="n">docker_creds</span>
            <span class="n">setup</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;sudo docker login --username $DOCKER_USERNAME --password &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;$DOCKER_PASSWORD </span><span class="si">{</span><span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">task_envs</span><span class="p">[</span><span class="s2">&quot;DOCKER_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docker_username</span>
            <span class="n">task_envs</span><span class="p">[</span><span class="s2">&quot;DOCKER_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docker_password</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">setup</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Run the entire pipeline</span>

        <span class="c1"># Set the service connector AWS profile ENV variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_environment_variable</span><span class="p">(</span><span class="nb">set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="n">sky</span><span class="o">.</span><span class="n">clouds</span><span class="o">.</span><span class="n">Kubernetes</span><span class="p">):</span>
                <span class="n">run_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="se">{{</span><span class="s2">VIRTUAL_ENV:+$VIRTUAL_ENV/bin/</span><span class="se">}}</span><span class="si">{</span><span class="n">entrypoint_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">arguments_str</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">setup</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">down</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">idle_minutes_to_autostop</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">run_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sudo docker run --rm </span><span class="si">{</span><span class="n">custom_run_args</span><span class="si">}{</span><span class="n">docker_environment_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">entrypoint_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">arguments_str</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">down</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">down</span>
                <span class="n">idle_minutes_to_autostop</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">idle_minutes_to_autostop</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">sky</span><span class="o">.</span><span class="n">Task</span><span class="p">(</span>
                <span class="n">run</span><span class="o">=</span><span class="n">run_command</span><span class="p">,</span>
                <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span>
                <span class="n">envs</span><span class="o">=</span><span class="n">task_envs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running run: </span><span class="si">{</span><span class="n">run_command</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">set_resources</span><span class="p">(</span>
                <span class="n">sky</span><span class="o">.</span><span class="n">Resources</span><span class="p">(</span>
                    <span class="n">cloud</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span>
                    <span class="n">instance_type</span><span class="o">=</span><span class="n">instance_type</span><span class="p">,</span>
                    <span class="n">cpus</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">cpus</span><span class="p">,</span>
                    <span class="n">memory</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span>
                    <span class="n">accelerators</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerators</span><span class="p">,</span>
                    <span class="n">accelerator_args</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerator_args</span><span class="p">,</span>
                    <span class="n">use_spot</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">use_spot</span><span class="p">,</span>
                    <span class="n">job_recovery</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">job_recovery</span><span class="p">,</span>
                    <span class="n">region</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                    <span class="n">zone</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">zone</span><span class="p">,</span>
                    <span class="n">image_id</span><span class="o">=</span><span class="n">image</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="n">sky</span><span class="o">.</span><span class="n">clouds</span><span class="o">.</span><span class="n">Kubernetes</span><span class="p">)</span>
                    <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">image_id</span><span class="p">,</span>
                    <span class="n">disk_size</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">disk_size</span><span class="p">,</span>
                    <span class="n">disk_tier</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">disk_tier</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Set the cluster name</span>
            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">cluster_name</span><span class="p">:</span>
                <span class="n">sky</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span>
                    <span class="n">task</span><span class="p">,</span>
                    <span class="n">settings</span><span class="o">.</span><span class="n">cluster_name</span><span class="p">,</span>
                    <span class="n">down</span><span class="o">=</span><span class="n">down</span><span class="p">,</span>
                    <span class="n">stream_logs</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">stream_logs</span><span class="p">,</span>
                    <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">detach_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Find existing cluster</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sky</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">[</span><span class="s2">&quot;handle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">launched_resources</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">cluster_name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;handle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cluster_name</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Found existing cluster </span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">. Reusing...&quot;</span>
                        <span class="p">)</span>
                <span class="n">cluster_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_cluster_name</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orchestrator_run_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="c1"># Launch the cluster</span>
                <span class="n">sky</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span>
                    <span class="n">task</span><span class="p">,</span>
                    <span class="n">cluster_name</span><span class="p">,</span>
                    <span class="n">retry_until_up</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">retry_until_up</span><span class="p">,</span>
                    <span class="n">idle_minutes_to_autostop</span><span class="o">=</span><span class="n">idle_minutes_to_autostop</span><span class="p">,</span>
                    <span class="n">down</span><span class="o">=</span><span class="n">down</span><span class="p">,</span>
                    <span class="n">stream_logs</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">stream_logs</span><span class="p">,</span>
                    <span class="n">detach_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline run failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Unset the service connector AWS profile ENV variable</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare_environment_variable</span><span class="p">(</span><span class="nb">set</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sanitize_cluster_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sanitize the value to be used in a cluster name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Arbitrary input cluster name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sanitized cluster name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;[^a-z0-9-]&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># replaces any character that is not a lowercase letter, digit, or hyphen with a hyphen</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[-]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># trim leading hyphens</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-]+$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># trim trailing hyphens</span>
        <span class="k">return</span> <span class="n">name</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.cloud" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cloud</span><span class="p">:</span> <span class="n">sky</span><span class="o">.</span><span class="n">clouds</span><span class="o">.</span><span class="n">Cloud</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>The type of sky cloud to use.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>sky.clouds.Cloud</code></td>
      <td><p>A <code>sky.clouds.Cloud</code> instance.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config</span><span class="p">:</span> <span class="n">SkypilotBaseOrchestratorConfig</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns the <code>SkypilotBaseOrchestratorConfig</code> config.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>SkypilotBaseOrchestratorConfig</code></td>
      <td><p>The configuration.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.validator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">stack_validator</span><span class="o">.</span><span class="n">StackValidator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Validates the stack.</p>
<p>In the remote case, checks that the stack contains a container registry,
image builder and only remote components.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.stack.stack_validator.StackValidator]</code></td>
      <td><p>A <code>StackValidator</code> instance.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.get_orchestrator_run_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Returns the active orchestrator run id.</p>

<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the environment variable specifying the run id
is not set.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The orchestrator run id.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_base_vm_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the active orchestrator run id.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the environment variable specifying the run id</span>
<span class="sd">            is not set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The orchestrator run id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ENV_ZENML_SKYPILOT_ORCHESTRATOR_RUN_ID</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Unable to read run id from environment variable &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ENV_ZENML_SKYPILOT_ORCHESTRATOR_RUN_ID</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.prepare_environment_variable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_environment_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Set up Environment variables that are required for the orchestrator.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>set</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to set the environment variables or not.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_base_vm_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">prepare_environment_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">set</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up Environment variables that are required for the orchestrator.</span>

<span class="sd">    Args:</span>
<span class="sd">        set: Whether to set the environment variables or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.prepare_or_run_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_or_run_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Runs each pipeline step in a separate Skypilot container.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment to prepare or run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack the pipeline will run on.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>environment</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Environment variables to set in the orchestration
environment.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>Exception</code></td>
        <td><p>If the pipeline run fails.</p></td>
      </tr>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the code is running in a notebook.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_base_vm_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs each pipeline step in a separate Skypilot container.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">        stack: The stack the pipeline will run on.</span>
<span class="sd">        environment: Environment variables to set in the orchestration</span>
<span class="sd">            environment.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If the pipeline run fails.</span>
<span class="sd">        RuntimeError: If the code is running in a notebook.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First check whether the code is running in a notebook.</span>
    <span class="k">if</span> <span class="n">Environment</span><span class="o">.</span><span class="n">in_notebook</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;The Skypilot orchestrator cannot run pipelines in a notebook &quot;</span>
            <span class="s2">&quot;environment. The reason is that it is non-trivial to create &quot;</span>
            <span class="s2">&quot;a Docker image of a notebook. Please consider refactoring &quot;</span>
            <span class="s2">&quot;your notebook cells into separate scripts in a Python module &quot;</span>
            <span class="s2">&quot;and run the code outside of a notebook when using this &quot;</span>
            <span class="s2">&quot;orchestrator.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Skypilot Orchestrator currently does not support the &quot;</span>
            <span class="s2">&quot;use of schedules. The `schedule` will be ignored &quot;</span>
            <span class="s2">&quot;and the pipeline will be run immediately.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Set up some variables for configuration</span>
    <span class="n">orchestrator_run_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">environment</span><span class="p">[</span><span class="n">ENV_ZENML_SKYPILOT_ORCHESTRATOR_RUN_ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">orchestrator_run_id</span>
    <span class="p">)</span>

    <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
        <span class="n">SkypilotBaseOrchestratorSettings</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">deployment</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span>
    <span class="n">orchestrator_run_name</span> <span class="o">=</span> <span class="n">get_orchestrator_run_name</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span>

    <span class="c1"># Get Docker image for the orchestrator pod</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># If no generic pipeline image exists (which means all steps have</span>
        <span class="c1"># custom builds) we use a random step image as all of them include</span>
        <span class="c1"># dependencies for the active stack</span>
        <span class="n">pipeline_step_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">))</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
            <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span> <span class="n">step_name</span><span class="o">=</span><span class="n">pipeline_step_name</span>
        <span class="p">)</span>

    <span class="n">different_settings_found</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">disable_step_based_settings</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">step_settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">SkypilotBaseOrchestratorSettings</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">step_settings</span> <span class="o">!=</span> <span class="n">settings</span><span class="p">:</span>
                <span class="n">different_settings_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;At least one step has different settings than the &quot;</span>
                    <span class="s2">&quot;pipeline. The step with different settings will be &quot;</span>
                    <span class="s2">&quot;run in a separate VM.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;You can configure the orchestrator to disable this &quot;</span>
                    <span class="s2">&quot;behavior by updating the `disable_step_based_settings` &quot;</span>
                    <span class="s2">&quot;in your orchestrator configuration &quot;</span>
                    <span class="s2">&quot;by running the following command: &quot;</span>
                    <span class="s2">&quot;`zenml orchestrator update --disable-step-based-settings=True`&quot;</span>
                <span class="p">)</span>
                <span class="k">break</span>

    <span class="c1"># Decide which configuration to use based on whether different settings were found</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">disable_step_based_settings</span>
        <span class="ow">and</span> <span class="n">different_settings_found</span>
    <span class="p">):</span>
        <span class="c1"># Run each step in a separate VM using SkypilotOrchestratorEntrypointConfiguration</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">SkypilotOrchestratorEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">SkypilotOrchestratorEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
            <span class="n">run_name</span><span class="o">=</span><span class="n">orchestrator_run_name</span><span class="p">,</span>
            <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Run the entire pipeline in one VM using PipelineEntrypointConfiguration</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">PipelineEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">PipelineEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
            <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span>
        <span class="p">)</span>

    <span class="n">entrypoint_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="n">arguments_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="n">task_envs</span> <span class="o">=</span> <span class="n">environment</span>
    <span class="n">docker_environment_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;-e </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">custom_run_args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">docker_run_args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">custom_run_args</span><span class="p">:</span>
        <span class="n">custom_run_args</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>

    <span class="n">instance_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">instance_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_INSTANCE_TYPE</span>

    <span class="c1"># Set up credentials</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_credentials</span><span class="p">()</span>

    <span class="c1"># Guaranteed by stack validation</span>
    <span class="k">assert</span> <span class="n">stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">docker_creds</span> <span class="o">:=</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span><span class="o">.</span><span class="n">credentials</span><span class="p">:</span>
        <span class="n">docker_username</span><span class="p">,</span> <span class="n">docker_password</span> <span class="o">=</span> <span class="n">docker_creds</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;sudo docker login --username $DOCKER_USERNAME --password &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;$DOCKER_PASSWORD </span><span class="si">{</span><span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">task_envs</span><span class="p">[</span><span class="s2">&quot;DOCKER_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docker_username</span>
        <span class="n">task_envs</span><span class="p">[</span><span class="s2">&quot;DOCKER_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docker_password</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Run the entire pipeline</span>

    <span class="c1"># Set the service connector AWS profile ENV variable</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prepare_environment_variable</span><span class="p">(</span><span class="nb">set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="n">sky</span><span class="o">.</span><span class="n">clouds</span><span class="o">.</span><span class="n">Kubernetes</span><span class="p">):</span>
            <span class="n">run_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="se">{{</span><span class="s2">VIRTUAL_ENV:+$VIRTUAL_ENV/bin/</span><span class="se">}}</span><span class="si">{</span><span class="n">entrypoint_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">arguments_str</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">setup</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">down</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">idle_minutes_to_autostop</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">run_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sudo docker run --rm </span><span class="si">{</span><span class="n">custom_run_args</span><span class="si">}{</span><span class="n">docker_environment_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">entrypoint_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">arguments_str</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">down</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">down</span>
            <span class="n">idle_minutes_to_autostop</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">idle_minutes_to_autostop</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">sky</span><span class="o">.</span><span class="n">Task</span><span class="p">(</span>
            <span class="n">run</span><span class="o">=</span><span class="n">run_command</span><span class="p">,</span>
            <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span>
            <span class="n">envs</span><span class="o">=</span><span class="n">task_envs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running run: </span><span class="si">{</span><span class="n">run_command</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">set_resources</span><span class="p">(</span>
            <span class="n">sky</span><span class="o">.</span><span class="n">Resources</span><span class="p">(</span>
                <span class="n">cloud</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span>
                <span class="n">instance_type</span><span class="o">=</span><span class="n">instance_type</span><span class="p">,</span>
                <span class="n">cpus</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">cpus</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span>
                <span class="n">accelerators</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerators</span><span class="p">,</span>
                <span class="n">accelerator_args</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerator_args</span><span class="p">,</span>
                <span class="n">use_spot</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">use_spot</span><span class="p">,</span>
                <span class="n">job_recovery</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">job_recovery</span><span class="p">,</span>
                <span class="n">region</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="n">zone</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">zone</span><span class="p">,</span>
                <span class="n">image_id</span><span class="o">=</span><span class="n">image</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="n">sky</span><span class="o">.</span><span class="n">clouds</span><span class="o">.</span><span class="n">Kubernetes</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">image_id</span><span class="p">,</span>
                <span class="n">disk_size</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">disk_size</span><span class="p">,</span>
                <span class="n">disk_tier</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">disk_tier</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Set the cluster name</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">cluster_name</span><span class="p">:</span>
            <span class="n">sky</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span>
                <span class="n">task</span><span class="p">,</span>
                <span class="n">settings</span><span class="o">.</span><span class="n">cluster_name</span><span class="p">,</span>
                <span class="n">down</span><span class="o">=</span><span class="n">down</span><span class="p">,</span>
                <span class="n">stream_logs</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">stream_logs</span><span class="p">,</span>
                <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">detach_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Find existing cluster</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sky</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">[</span><span class="s2">&quot;handle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">launched_resources</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">cluster_name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;handle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cluster_name</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Found existing cluster </span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">. Reusing...&quot;</span>
                    <span class="p">)</span>
            <span class="n">cluster_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_cluster_name</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orchestrator_run_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Launch the cluster</span>
            <span class="n">sky</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span>
                <span class="n">task</span><span class="p">,</span>
                <span class="n">cluster_name</span><span class="p">,</span>
                <span class="n">retry_until_up</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">retry_until_up</span><span class="p">,</span>
                <span class="n">idle_minutes_to_autostop</span><span class="o">=</span><span class="n">idle_minutes_to_autostop</span><span class="p">,</span>
                <span class="n">down</span><span class="o">=</span><span class="n">down</span><span class="p">,</span>
                <span class="n">stream_logs</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">stream_logs</span><span class="p">,</span>
                <span class="n">detach_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline run failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Unset the service connector AWS profile ENV variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_environment_variable</span><span class="p">(</span><span class="nb">set</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.sanitize_cluster_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sanitize_cluster_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Sanitize the value to be used in a cluster name.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>Arbitrary input cluster name.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Sanitized cluster name.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_base_vm_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">sanitize_cluster_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sanitize the value to be used in a cluster name.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Arbitrary input cluster name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sanitized cluster name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;[^a-z0-9-]&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># replaces any character that is not a lowercase letter, digit, or hyphen with a hyphen</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[-]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># trim leading hyphens</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-]+$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># trim trailing hyphens</span>
    <span class="k">return</span> <span class="n">name</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_base_vm_orchestrator.SkypilotBaseOrchestrator.setup_credentials" class="doc doc-heading">
<code class="highlight language-python"><span class="n">setup_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Set up credentials for the orchestrator.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_base_vm_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up credentials for the orchestrator.&quot;&quot;&quot;</span>
    <span class="n">connector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connector</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">connector</span><span class="o">.</span><span class="n">configure_local_client</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint" class="doc doc-heading">
        <code>skypilot_orchestrator_entrypoint</code>



</h4>

    <div class="doc doc-contents ">

      <p>Entrypoint of the Skypilot master/orchestrator VM.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h5 id="zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint.main" class="doc doc-heading">
<code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Entrypoint of the Skypilot master/orchestrator VM.</p>
<p>This is the entrypoint of the Skypilot master/orchestrator VM. It is
responsible for provisioning the VM and running the pipeline steps in
separate VMs.</p>
<p>The VM is provisioned using the <code>sky</code> library. The pipeline steps are run
using the <code>sky</code> library as well.</p>

<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>TypeError</code></td>
        <td><p>If the active stack's orchestrator is not an instance of
SkypilotBaseOrchestrator.</p></td>
      </tr>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the active stack's container registry is None.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_orchestrator_entrypoint.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entrypoint of the Skypilot master/orchestrator VM.</span>

<span class="sd">    This is the entrypoint of the Skypilot master/orchestrator VM. It is</span>
<span class="sd">    responsible for provisioning the VM and running the pipeline steps in</span>
<span class="sd">    separate VMs.</span>

<span class="sd">    The VM is provisioned using the `sky` library. The pipeline steps are run</span>
<span class="sd">    using the `sky` library as well.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If the active stack&#39;s orchestrator is not an instance of</span>
<span class="sd">            SkypilotBaseOrchestrator.</span>
<span class="sd">        ValueError: If the active stack&#39;s container registry is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Log to the container&#39;s stdout so it can be streamed by the client.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skypilot orchestrator VM started.&quot;</span><span class="p">)</span>

    <span class="c1"># Parse / extract args.</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="n">orchestrator_run_id</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

    <span class="n">deployment</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">get_deployment</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">)</span>

    <span class="n">pipeline_dag</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">step_name</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span>
        <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">step_command</span> <span class="o">=</span> <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>
    <span class="n">entrypoint_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">step_command</span><span class="p">)</span>

    <span class="n">active_stack</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack</span>

    <span class="n">orchestrator</span> <span class="o">=</span> <span class="n">active_stack</span><span class="o">.</span><span class="n">orchestrator</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orchestrator</span><span class="p">,</span> <span class="n">SkypilotBaseOrchestrator</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;The active stack&#39;s orchestrator is not an instance of SkypilotBaseOrchestrator.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Set up credentials</span>
    <span class="n">orchestrator</span><span class="o">.</span><span class="n">setup_credentials</span><span class="p">()</span>

    <span class="c1"># Set the service connector AWS profile ENV variable</span>
    <span class="n">orchestrator</span><span class="o">.</span><span class="n">prepare_environment_variable</span><span class="p">(</span><span class="nb">set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># get active container registry</span>
    <span class="n">container_registry</span> <span class="o">=</span> <span class="n">active_stack</span><span class="o">.</span><span class="n">container_registry</span>
    <span class="k">if</span> <span class="n">container_registry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Container registry cannot be None.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">docker_creds</span> <span class="o">:=</span> <span class="n">container_registry</span><span class="o">.</span><span class="n">credentials</span><span class="p">:</span>
        <span class="n">docker_username</span><span class="p">,</span> <span class="n">docker_password</span> <span class="o">=</span> <span class="n">docker_creds</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;docker login --username $DOCKER_USERNAME --password &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;$DOCKER_PASSWORD </span><span class="si">{</span><span class="n">container_registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">task_envs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;DOCKER_USERNAME&quot;</span><span class="p">:</span> <span class="n">docker_username</span><span class="p">,</span>
            <span class="s2">&quot;DOCKER_PASSWORD&quot;</span><span class="p">:</span> <span class="n">docker_password</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">task_envs</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">unique_resource_configs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">SkypilotBaseOrchestratorSettings</span><span class="p">,</span>
            <span class="n">orchestrator</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># Handle both str and Dict[str, int] types for accelerators</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerators</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">accelerators_hashable</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerators</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerators</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">accelerators_hashable</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">({(</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerators</span><span class="p">,</span> <span class="mi">1</span><span class="p">)})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accelerators_hashable</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">resource_config</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">instance_type</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">cpus</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">disk_size</span><span class="p">,</span>  <span class="c1"># Assuming disk_size is part of the settings</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">disk_tier</span><span class="p">,</span>  <span class="c1"># Assuming disk_tier is part of the settings</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">use_spot</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">job_recovery</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">zone</span><span class="p">,</span>
            <span class="n">accelerators_hashable</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cluster_name_parts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">orchestrator</span><span class="o">.</span><span class="n">sanitize_cluster_name</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">part</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">resource_config</span>
            <span class="k">if</span> <span class="n">part</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="n">cluster_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cluster-</span><span class="si">{</span><span class="n">orchestrator_run_id</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">cluster_name_parts</span>
        <span class="p">)</span>
        <span class="n">unique_resource_configs</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_name</span>

    <span class="n">run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">list_pipeline_runs</span><span class="p">(</span>
        <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;asc:created&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">deployment_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">INITIALIZING</span><span class="p">,</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetching pipeline run: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run_step_on_skypilot_vm</span><span class="p">(</span><span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a pipeline step in a separate Skypilot VM.</span>

<span class="sd">        Args:</span>
<span class="sd">            step_name: Name of the step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cluster_name</span> <span class="o">=</span> <span class="n">unique_resource_configs</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">SkypilotBaseOrchestrator</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
            <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span> <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span>
        <span class="p">)</span>

        <span class="n">step_args</span> <span class="o">=</span> <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span> <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span>
        <span class="p">)</span>
        <span class="n">arguments_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">step_args</span><span class="p">)</span>

        <span class="n">step</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">SkypilotBaseOrchestratorSettings</span><span class="p">,</span>
            <span class="n">orchestrator</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">get_config_environment_vars</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="n">ENV_ZENML_SKYPILOT_ORCHESTRATOR_RUN_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">orchestrator_run_id</span>

        <span class="n">docker_environment_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;-e </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">custom_run_args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">docker_run_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">custom_run_args</span><span class="p">:</span>
            <span class="n">custom_run_args</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>

        <span class="c1"># Set up the task</span>
        <span class="n">run_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;docker run --rm </span><span class="si">{</span><span class="n">custom_run_args</span><span class="si">}{</span><span class="n">docker_environment_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">entrypoint_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">arguments_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">task_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">sky</span><span class="o">.</span><span class="n">Task</span><span class="p">(</span>
            <span class="n">run</span><span class="o">=</span><span class="n">run_command</span><span class="p">,</span>
            <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span>
            <span class="n">envs</span><span class="o">=</span><span class="n">task_envs</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">task_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">set_resources</span><span class="p">(</span>
            <span class="n">sky</span><span class="o">.</span><span class="n">Resources</span><span class="p">(</span>
                <span class="n">cloud</span><span class="o">=</span><span class="n">orchestrator</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span>
                <span class="n">instance_type</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">instance_type</span>
                <span class="ow">or</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">DEFAULT_INSTANCE_TYPE</span><span class="p">,</span>
                <span class="n">cpus</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">cpus</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span>
                <span class="n">disk_size</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">disk_size</span><span class="p">,</span>
                <span class="n">disk_tier</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">disk_tier</span><span class="p">,</span>
                <span class="n">accelerators</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerators</span><span class="p">,</span>
                <span class="n">accelerator_args</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerator_args</span><span class="p">,</span>
                <span class="n">use_spot</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">use_spot</span><span class="p">,</span>
                <span class="n">job_recovery</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">job_recovery</span><span class="p">,</span>
                <span class="n">region</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                <span class="n">zone</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">zone</span><span class="p">,</span>
                <span class="n">image_id</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">image_id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">sky</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span>
            <span class="n">task</span><span class="p">,</span>
            <span class="n">cluster_name</span><span class="p">,</span>
            <span class="n">retry_until_up</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">retry_until_up</span><span class="p">,</span>
            <span class="n">idle_minutes_to_autostop</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">idle_minutes_to_autostop</span><span class="p">,</span>
            <span class="n">down</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">down</span><span class="p">,</span>
            <span class="n">stream_logs</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">stream_logs</span><span class="p">,</span>
            <span class="n">detach_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">detach_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Wait for pod to finish.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Waiting for pod of step `</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">` to start...&quot;</span><span class="p">)</span>

        <span class="n">current_run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">get_pipeline_run</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">step_is_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">step_is_finished</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">current_run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">get_pipeline_run</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">step_is_finished</span> <span class="o">=</span> <span class="n">current_run</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span>
                    <span class="n">step_name</span>
                <span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_finished</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># Step is not yet in the run, so we wait for it to appear</span>
                <span class="k">continue</span>

        <span class="c1"># Pop the resource configuration for this step</span>
        <span class="n">unique_resource_configs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">step_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cluster_name</span> <span class="ow">in</span> <span class="n">unique_resource_configs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="c1"># If there are more steps using this configuration, skip deprovisioning the cluster</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Resource configuration for cluster &#39;</span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="s2">&quot;is used by subsequent steps. Skipping the deprovisioning of &quot;</span>
                <span class="s2">&quot;the cluster.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If there are no more steps using this configuration, down the cluster</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Resource configuration for cluster &#39;</span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="s2">&quot;is not used by subsequent steps. deprovisioning the cluster.&quot;</span>
            <span class="p">)</span>
            <span class="n">sky</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">cluster_name</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running step `</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">` on a VM is completed.&quot;</span><span class="p">)</span>

    <span class="n">ThreadedDagRunner</span><span class="p">(</span><span class="n">dag</span><span class="o">=</span><span class="n">pipeline_dag</span><span class="p">,</span> <span class="n">run_fn</span><span class="o">=</span><span class="n">run_step_on_skypilot_vm</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Orchestration VM provisioned.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint.parse_args" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_args</span><span class="p">()</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Parse entrypoint arguments.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Namespace</code></td>
      <td><p>Parsed args.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_orchestrator_entrypoint.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_args</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse entrypoint arguments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Parsed args.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--run_name&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--deployment_id&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration" class="doc doc-heading">
        <code>skypilot_orchestrator_entrypoint_configuration</code>



</h4>

    <div class="doc doc-contents ">

      <p>Entrypoint configuration for the Skypilot master/orchestrator VM.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration" class="doc doc-heading">
        <code>
SkypilotOrchestratorEntrypointConfiguration        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Entrypoint configuration for the Skypilot master/orchestrator VM.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_orchestrator_entrypoint_configuration.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SkypilotOrchestratorEntrypointConfiguration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entrypoint configuration for the Skypilot master/orchestrator VM.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_entrypoint_options</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets all the options required for running this entrypoint.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Entrypoint options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">RUN_NAME_OPTION</span><span class="p">,</span>
            <span class="n">DEPLOYMENT_ID_OPTION</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">options</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_entrypoint_command</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a command that runs the entrypoint module.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Entrypoint command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;python&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">command</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_entrypoint_arguments</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">run_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">deployment_id</span><span class="p">:</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets all arguments that the entrypoint command should be called with.</span>

<span class="sd">        Args:</span>
<span class="sd">            run_name: Name of the ZenML run.</span>
<span class="sd">            deployment_id: ID of the deployment.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of entrypoint arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">RUN_NAME_OPTION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">run_name</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">DEPLOYMENT_ID_OPTION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">args</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_arguments" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_entrypoint_arguments</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Gets all arguments that the entrypoint command should be called with.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>run_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the ZenML run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>deployment_id</code></td>
        <td><code>UUID</code></td>
        <td><p>ID of the deployment.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[str]</code></td>
      <td><p>List of entrypoint arguments.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_orchestrator_entrypoint_configuration.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_entrypoint_arguments</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">run_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">deployment_id</span><span class="p">:</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all arguments that the entrypoint command should be called with.</span>

<span class="sd">    Args:</span>
<span class="sd">        run_name: Name of the ZenML run.</span>
<span class="sd">        deployment_id: ID of the deployment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of entrypoint arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">RUN_NAME_OPTION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">run_name</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">DEPLOYMENT_ID_OPTION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">args</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_command" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_entrypoint_command</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns a command that runs the entrypoint module.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[str]</code></td>
      <td><p>Entrypoint command.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_orchestrator_entrypoint_configuration.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_entrypoint_command</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a command that runs the entrypoint module.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Entrypoint command.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;python&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">command</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.skypilot.orchestrators.skypilot_orchestrator_entrypoint_configuration.SkypilotOrchestratorEntrypointConfiguration.get_entrypoint_options" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_entrypoint_options</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Gets all the options required for running this entrypoint.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Set[str]</code></td>
      <td><p>Entrypoint options.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/skypilot/orchestrators/skypilot_orchestrator_entrypoint_configuration.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_entrypoint_options</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all the options required for running this entrypoint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Entrypoint options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">RUN_NAME_OPTION</span><span class="p">,</span>
        <span class="n">DEPLOYMENT_ID_OPTION</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">options</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>




  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../integrations-sklearn/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Sklearn" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Sklearn
            </div>
          </div>
        </a>
      
      
        
        <a href="../integrations-skypilot_aws/" class="md-footer__link md-footer__link--next" aria-label="Next: Skypilot Aws" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Skypilot Aws
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 ZenML GmbH – <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  
    
  




<h4>This website uses cookies</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        <label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>