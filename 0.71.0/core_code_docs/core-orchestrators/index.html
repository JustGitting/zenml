
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sdkdocs.zenml.io/0.71.0/core_code_docs/core-orchestrators/">
      
      <link rel="icon" href="../../_assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-8.5.10">
    
    
      
        <title>Orchestrators - ZenML API Reference</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    

<script>
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="CaE5VaNjhyaUt48qXK4rLwwKJ0PdAOFM";;analytics.SNIPPET_VERSION="4.15.3";
  analytics.load("CaE5VaNjhyaUt48qXK4rLwwKJ0PdAOFM");
  analytics.page();
  }}();
</script>
<script defer data-domain="apidocs.zenml.io" src="https://plausible.io/js/plausible.js"></script>


  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#orchestrators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ZenML API Reference" class="md-header__button md-logo" aria-label="ZenML API Reference" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZenML API Reference
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Orchestrators
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/zenml-io/zenml" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ZenML API Reference" class="md-nav__button md-logo" aria-label="ZenML API Reference" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ZenML API Reference
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zenml-io/zenml" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        ZenML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        CLI docs
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Core code docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core code docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Core code docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-actions/" class="md-nav__link">
        Actions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-alerter/" class="md-nav__link">
        Alerter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-analytics/" class="md-nav__link">
        Analytics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-annotators/" class="md-nav__link">
        Annotators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-artifact_stores/" class="md-nav__link">
        Artifact Stores
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-artifacts/" class="md-nav__link">
        Artifacts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-client/" class="md-nav__link">
        Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-client_lazy_loader/" class="md-nav__link">
        Client Lazy Loader
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-code_repositories/" class="md-nav__link">
        Code Repositories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-config/" class="md-nav__link">
        Config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-console/" class="md-nav__link">
        Console
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-container_registries/" class="md-nav__link">
        Container Registries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-data_validators/" class="md-nav__link">
        Data Validators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-entrypoints/" class="md-nav__link">
        Entrypoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-enums/" class="md-nav__link">
        Enums
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-environment/" class="md-nav__link">
        Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-event_hub/" class="md-nav__link">
        Event Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-event_sources/" class="md-nav__link">
        Event Sources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-experiment_trackers/" class="md-nav__link">
        Experiment Trackers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-feature_stores/" class="md-nav__link">
        Feature Stores
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-hooks/" class="md-nav__link">
        Hooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-image_builders/" class="md-nav__link">
        Image Builders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-io/" class="md-nav__link">
        Io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-logger/" class="md-nav__link">
        Logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-login/" class="md-nav__link">
        Login
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-materializers/" class="md-nav__link">
        Materializers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-metadata/" class="md-nav__link">
        Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-model/" class="md-nav__link">
        Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-model_deployers/" class="md-nav__link">
        Model Deployers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-model_registries/" class="md-nav__link">
        Model Registries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Orchestrators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Orchestrators
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zenml.orchestrators" class="md-nav__link">
    orchestrators
  </a>
  
    <nav class="md-nav" aria-label="orchestrators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator" class="md-nav__link">
    base_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="base_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator" class="md-nav__link">
    BaseOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="BaseOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator--how-it-works" class="md-nav__link">
    How it works:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.fetch_status" class="md-nav__link">
    fetch_status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
    <nav class="md-nav" aria-label="prepare_or_run_pipeline()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline--simple-case" class="md-nav__link">
    Simple Case:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline--advanced-case" class="md-nav__link">
    Advanced Case:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.requires_resources_in_orchestration_environment" class="md-nav__link">
    requires_resources_in_orchestration_environment()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.run_step" class="md-nav__link">
    run_step()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig" class="md-nav__link">
    BaseOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="BaseOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.is_schedulable" class="md-nav__link">
    is_schedulable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.is_synchronous" class="md-nav__link">
    is_synchronous
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.supports_client_side_caching" class="md-nav__link">
    supports_client_side_caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor" class="md-nav__link">
    BaseOrchestratorFlavor
  </a>
  
    <nav class="md-nav" aria-label="BaseOrchestratorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.type" class="md-nav__link">
    type
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.cache_utils" class="md-nav__link">
    cache_utils
  </a>
  
    <nav class="md-nav" aria-label="cache_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.cache_utils.generate_cache_key" class="md-nav__link">
    generate_cache_key()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.cache_utils.get_cached_step_run" class="md-nav__link">
    get_cached_step_run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.containerized_orchestrator" class="md-nav__link">
    containerized_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="containerized_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator" class="md-nav__link">
    ContainerizedOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="ContainerizedOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator.get_docker_builds" class="md-nav__link">
    get_docker_builds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator.get_image" class="md-nav__link">
    get_image()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner" class="md-nav__link">
    dag_runner
  </a>
  
    <nav class="md-nav" aria-label="dag_runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.NodeStatus" class="md-nav__link">
    NodeStatus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.ThreadedDagRunner" class="md-nav__link">
    ThreadedDagRunner
  </a>
  
    <nav class="md-nav" aria-label="ThreadedDagRunner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.ThreadedDagRunner.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.ThreadedDagRunner.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.reverse_dag" class="md-nav__link">
    reverse_dag()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.input_utils" class="md-nav__link">
    input_utils
  </a>
  
    <nav class="md-nav" aria-label="input_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.input_utils.resolve_step_inputs" class="md-nav__link">
    resolve_step_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local" class="md-nav__link">
    local
  </a>
  
    <nav class="md-nav" aria-label="local">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator" class="md-nav__link">
    local_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="local_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestrator" class="md-nav__link">
    LocalOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="LocalOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig" class="md-nav__link">
    LocalOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="LocalOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig.is_local" class="md-nav__link">
    is_local
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig.is_synchronous" class="md-nav__link">
    is_synchronous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor" class="md-nav__link">
    LocalOrchestratorFlavor
  </a>
  
    <nav class="md-nav" aria-label="LocalOrchestratorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker" class="md-nav__link">
    local_docker
  </a>
  
    <nav class="md-nav" aria-label="local_docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator" class="md-nav__link">
    local_docker_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="local_docker_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator" class="md-nav__link">
    LocalDockerOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="LocalDockerOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.settings_class" class="md-nav__link">
    settings_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig" class="md-nav__link">
    LocalDockerOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="LocalDockerOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig.is_local" class="md-nav__link">
    is_local
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig.is_synchronous" class="md-nav__link">
    is_synchronous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor" class="md-nav__link">
    LocalDockerOrchestratorFlavor
  </a>
  
    <nav class="md-nav" aria-label="LocalDockerOrchestratorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorSettings" class="md-nav__link">
    LocalDockerOrchestratorSettings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.output_utils" class="md-nav__link">
    output_utils
  </a>
  
    <nav class="md-nav" aria-label="output_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.output_utils.generate_artifact_uri" class="md-nav__link">
    generate_artifact_uri()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.output_utils.prepare_output_artifact_uris" class="md-nav__link">
    prepare_output_artifact_uris()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.output_utils.remove_artifact_dirs" class="md-nav__link">
    remove_artifact_dirs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils" class="md-nav__link">
    publish_utils
  </a>
  
    <nav class="md-nav" aria-label="publish_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.get_pipeline_run_status" class="md-nav__link">
    get_pipeline_run_status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_failed_pipeline_run" class="md-nav__link">
    publish_failed_pipeline_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_failed_step_run" class="md-nav__link">
    publish_failed_step_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_pipeline_run_metadata" class="md-nav__link">
    publish_pipeline_run_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_step_run_metadata" class="md-nav__link">
    publish_step_run_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_successful_step_run" class="md-nav__link">
    publish_successful_step_run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_launcher" class="md-nav__link">
    step_launcher
  </a>
  
    <nav class="md-nav" aria-label="step_launcher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_launcher.StepLauncher" class="md-nav__link">
    StepLauncher
  </a>
  
    <nav class="md-nav" aria-label="StepLauncher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_launcher.StepLauncher.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_launcher.StepLauncher.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils" class="md-nav__link">
    step_run_utils
  </a>
  
    <nav class="md-nav" aria-label="step_run_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.StepRunRequestFactory" class="md-nav__link">
    StepRunRequestFactory
  </a>
  
    <nav class="md-nav" aria-label="StepRunRequestFactory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.StepRunRequestFactory.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.StepRunRequestFactory.create_request" class="md-nav__link">
    create_request()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.StepRunRequestFactory.populate_request" class="md-nav__link">
    populate_request()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.create_cached_step_runs" class="md-nav__link">
    create_cached_step_runs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.find_cacheable_invocation_candidates" class="md-nav__link">
    find_cacheable_invocation_candidates()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.get_model_version_created_by_pipeline_run" class="md-nav__link">
    get_model_version_created_by_pipeline_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.get_or_create_model_version_for_pipeline_run" class="md-nav__link">
    get_or_create_model_version_for_pipeline_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.link_output_artifacts_to_model_version" class="md-nav__link">
    link_output_artifacts_to_model_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.link_pipeline_run_to_model_version" class="md-nav__link">
    link_pipeline_run_to_model_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.log_model_version_dashboard_url" class="md-nav__link">
    log_model_version_dashboard_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.prepare_pipeline_run_model_version" class="md-nav__link">
    prepare_pipeline_run_model_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.prepare_step_run_model_version" class="md-nav__link">
    prepare_step_run_model_version()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner" class="md-nav__link">
    step_runner
  </a>
  
    <nav class="md-nav" aria-label="step_runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner" class="md-nav__link">
    StepRunner
  </a>
  
    <nav class="md-nav" aria-label="StepRunner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner.configuration" class="md-nav__link">
    configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner.load_and_run_hook" class="md-nav__link">
    load_and_run_hook()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.topsort" class="md-nav__link">
    topsort
  </a>
  
    <nav class="md-nav" aria-label="topsort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.topsort.topsorted_layers" class="md-nav__link">
    topsorted_layers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.register_artifact_store_filesystem" class="md-nav__link">
    register_artifact_store_filesystem
  </a>
  
    <nav class="md-nav" aria-label="register_artifact_store_filesystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.register_artifact_store_filesystem.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.register_artifact_store_filesystem.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.register_artifact_store_filesystem.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.get_config_environment_vars" class="md-nav__link">
    get_config_environment_vars()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.get_orchestrator_run_name" class="md-nav__link">
    get_orchestrator_run_name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.is_setting_enabled" class="md-nav__link">
    is_setting_enabled()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator" class="md-nav__link">
    wheeled_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="wheeled_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator" class="md-nav__link">
    WheeledOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="WheeledOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.copy_repository_to_temp_dir_and_add_setup_py" class="md-nav__link">
    copy_repository_to_temp_dir_and_add_setup_py()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.create_wheel" class="md-nav__link">
    create_wheel()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.sanitize_name" class="md-nav__link">
    sanitize_name()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-pipelines/" class="md-nav__link">
        Pipelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-secret/" class="md-nav__link">
        Secret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-service_connectors/" class="md-nav__link">
        Service Connectors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-services/" class="md-nav__link">
        Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-stack/" class="md-nav__link">
        Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-stack_deployments/" class="md-nav__link">
        Stack Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-step_operators/" class="md-nav__link">
        Step Operators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-steps/" class="md-nav__link">
        Steps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-types/" class="md-nav__link">
        Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-zen_server/" class="md-nav__link">
        Zen Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-zen_stores/" class="md-nav__link">
        Zen Stores
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Integration code docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integration code docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Integration code docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-airflow/" class="md-nav__link">
        Airflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-argilla/" class="md-nav__link">
        Argilla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-aws/" class="md-nav__link">
        Aws
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-azure/" class="md-nav__link">
        Azure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-bentoml/" class="md-nav__link">
        Bentoml
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-bitbucket/" class="md-nav__link">
        Bitbucket
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-comet/" class="md-nav__link">
        Comet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-databricks/" class="md-nav__link">
        Databricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-deepchecks/" class="md-nav__link">
        Deepchecks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-discord/" class="md-nav__link">
        Discord
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-evidently/" class="md-nav__link">
        Evidently
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-facets/" class="md-nav__link">
        Facets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-feast/" class="md-nav__link">
        Feast
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-gcp/" class="md-nav__link">
        Gcp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-github/" class="md-nav__link">
        Github
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-gitlab/" class="md-nav__link">
        Gitlab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-great_expectations/" class="md-nav__link">
        Great Expectations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-huggingface/" class="md-nav__link">
        Huggingface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-hyperai/" class="md-nav__link">
        Hyperai
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-integration/" class="md-nav__link">
        Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-kaniko/" class="md-nav__link">
        Kaniko
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-kubeflow/" class="md-nav__link">
        Kubeflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-label_studio/" class="md-nav__link">
        Label Studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-langchain/" class="md-nav__link">
        Langchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-lightgbm/" class="md-nav__link">
        Lightgbm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-lightning/" class="md-nav__link">
        Lightning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-llama_index/" class="md-nav__link">
        Llama Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-mlflow/" class="md-nav__link">
        Mlflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-modal/" class="md-nav__link">
        Modal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-neptune/" class="md-nav__link">
        Neptune
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-neural_prophet/" class="md-nav__link">
        Neural Prophet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-openai/" class="md-nav__link">
        Openai
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-pigeon/" class="md-nav__link">
        Pigeon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-pillow/" class="md-nav__link">
        Pillow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-polars/" class="md-nav__link">
        Polars
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-prodigy/" class="md-nav__link">
        Prodigy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-pycaret/" class="md-nav__link">
        Pycaret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-pytorch/" class="md-nav__link">
        Pytorch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-pytorch_lightning/" class="md-nav__link">
        Pytorch Lightning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-registry/" class="md-nav__link">
        Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-s3/" class="md-nav__link">
        S3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-scipy/" class="md-nav__link">
        Scipy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-seldon/" class="md-nav__link">
        Seldon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-sklearn/" class="md-nav__link">
        Sklearn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-skypilot/" class="md-nav__link">
        Skypilot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-skypilot_aws/" class="md-nav__link">
        Skypilot Aws
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-skypilot_azure/" class="md-nav__link">
        Skypilot Azure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-skypilot_gcp/" class="md-nav__link">
        Skypilot Gcp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-skypilot_kubernetes/" class="md-nav__link">
        Skypilot Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-skypilot_lambda/" class="md-nav__link">
        Skypilot Lambda
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-slack/" class="md-nav__link">
        Slack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-spark/" class="md-nav__link">
        Spark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-tekton/" class="md-nav__link">
        Tekton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-tensorboard/" class="md-nav__link">
        Tensorboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-tensorflow/" class="md-nav__link">
        Tensorflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-vllm/" class="md-nav__link">
        Vllm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-wandb/" class="md-nav__link">
        Wandb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-whylogs/" class="md-nav__link">
        Whylogs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../integration_code_docs/integrations-xgboost/" class="md-nav__link">
        Xgboost
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zenml.orchestrators" class="md-nav__link">
    orchestrators
  </a>
  
    <nav class="md-nav" aria-label="orchestrators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator" class="md-nav__link">
    base_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="base_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator" class="md-nav__link">
    BaseOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="BaseOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator--how-it-works" class="md-nav__link">
    How it works:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.fetch_status" class="md-nav__link">
    fetch_status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
    <nav class="md-nav" aria-label="prepare_or_run_pipeline()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline--simple-case" class="md-nav__link">
    Simple Case:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline--advanced-case" class="md-nav__link">
    Advanced Case:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.requires_resources_in_orchestration_environment" class="md-nav__link">
    requires_resources_in_orchestration_environment()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator.run_step" class="md-nav__link">
    run_step()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig" class="md-nav__link">
    BaseOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="BaseOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.is_schedulable" class="md-nav__link">
    is_schedulable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.is_synchronous" class="md-nav__link">
    is_synchronous
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.supports_client_side_caching" class="md-nav__link">
    supports_client_side_caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor" class="md-nav__link">
    BaseOrchestratorFlavor
  </a>
  
    <nav class="md-nav" aria-label="BaseOrchestratorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.type" class="md-nav__link">
    type
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.cache_utils" class="md-nav__link">
    cache_utils
  </a>
  
    <nav class="md-nav" aria-label="cache_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.cache_utils.generate_cache_key" class="md-nav__link">
    generate_cache_key()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.cache_utils.get_cached_step_run" class="md-nav__link">
    get_cached_step_run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.containerized_orchestrator" class="md-nav__link">
    containerized_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="containerized_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator" class="md-nav__link">
    ContainerizedOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="ContainerizedOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator.get_docker_builds" class="md-nav__link">
    get_docker_builds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator.get_image" class="md-nav__link">
    get_image()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner" class="md-nav__link">
    dag_runner
  </a>
  
    <nav class="md-nav" aria-label="dag_runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.NodeStatus" class="md-nav__link">
    NodeStatus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.ThreadedDagRunner" class="md-nav__link">
    ThreadedDagRunner
  </a>
  
    <nav class="md-nav" aria-label="ThreadedDagRunner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.ThreadedDagRunner.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.ThreadedDagRunner.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.dag_runner.reverse_dag" class="md-nav__link">
    reverse_dag()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.input_utils" class="md-nav__link">
    input_utils
  </a>
  
    <nav class="md-nav" aria-label="input_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.input_utils.resolve_step_inputs" class="md-nav__link">
    resolve_step_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local" class="md-nav__link">
    local
  </a>
  
    <nav class="md-nav" aria-label="local">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator" class="md-nav__link">
    local_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="local_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestrator" class="md-nav__link">
    LocalOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="LocalOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig" class="md-nav__link">
    LocalOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="LocalOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig.is_local" class="md-nav__link">
    is_local
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig.is_synchronous" class="md-nav__link">
    is_synchronous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor" class="md-nav__link">
    LocalOrchestratorFlavor
  </a>
  
    <nav class="md-nav" aria-label="LocalOrchestratorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker" class="md-nav__link">
    local_docker
  </a>
  
    <nav class="md-nav" aria-label="local_docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator" class="md-nav__link">
    local_docker_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="local_docker_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator" class="md-nav__link">
    LocalDockerOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="LocalDockerOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.settings_class" class="md-nav__link">
    settings_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig" class="md-nav__link">
    LocalDockerOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="LocalDockerOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig.is_local" class="md-nav__link">
    is_local
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig.is_synchronous" class="md-nav__link">
    is_synchronous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor" class="md-nav__link">
    LocalDockerOrchestratorFlavor
  </a>
  
    <nav class="md-nav" aria-label="LocalDockerOrchestratorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorSettings" class="md-nav__link">
    LocalDockerOrchestratorSettings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.output_utils" class="md-nav__link">
    output_utils
  </a>
  
    <nav class="md-nav" aria-label="output_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.output_utils.generate_artifact_uri" class="md-nav__link">
    generate_artifact_uri()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.output_utils.prepare_output_artifact_uris" class="md-nav__link">
    prepare_output_artifact_uris()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.output_utils.remove_artifact_dirs" class="md-nav__link">
    remove_artifact_dirs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils" class="md-nav__link">
    publish_utils
  </a>
  
    <nav class="md-nav" aria-label="publish_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.get_pipeline_run_status" class="md-nav__link">
    get_pipeline_run_status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_failed_pipeline_run" class="md-nav__link">
    publish_failed_pipeline_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_failed_step_run" class="md-nav__link">
    publish_failed_step_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_pipeline_run_metadata" class="md-nav__link">
    publish_pipeline_run_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_step_run_metadata" class="md-nav__link">
    publish_step_run_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.publish_utils.publish_successful_step_run" class="md-nav__link">
    publish_successful_step_run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_launcher" class="md-nav__link">
    step_launcher
  </a>
  
    <nav class="md-nav" aria-label="step_launcher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_launcher.StepLauncher" class="md-nav__link">
    StepLauncher
  </a>
  
    <nav class="md-nav" aria-label="StepLauncher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_launcher.StepLauncher.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_launcher.StepLauncher.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils" class="md-nav__link">
    step_run_utils
  </a>
  
    <nav class="md-nav" aria-label="step_run_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.StepRunRequestFactory" class="md-nav__link">
    StepRunRequestFactory
  </a>
  
    <nav class="md-nav" aria-label="StepRunRequestFactory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.StepRunRequestFactory.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.StepRunRequestFactory.create_request" class="md-nav__link">
    create_request()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.StepRunRequestFactory.populate_request" class="md-nav__link">
    populate_request()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.create_cached_step_runs" class="md-nav__link">
    create_cached_step_runs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.find_cacheable_invocation_candidates" class="md-nav__link">
    find_cacheable_invocation_candidates()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.get_model_version_created_by_pipeline_run" class="md-nav__link">
    get_model_version_created_by_pipeline_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.get_or_create_model_version_for_pipeline_run" class="md-nav__link">
    get_or_create_model_version_for_pipeline_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.link_output_artifacts_to_model_version" class="md-nav__link">
    link_output_artifacts_to_model_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.link_pipeline_run_to_model_version" class="md-nav__link">
    link_pipeline_run_to_model_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.log_model_version_dashboard_url" class="md-nav__link">
    log_model_version_dashboard_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.prepare_pipeline_run_model_version" class="md-nav__link">
    prepare_pipeline_run_model_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_run_utils.prepare_step_run_model_version" class="md-nav__link">
    prepare_step_run_model_version()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner" class="md-nav__link">
    step_runner
  </a>
  
    <nav class="md-nav" aria-label="step_runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner" class="md-nav__link">
    StepRunner
  </a>
  
    <nav class="md-nav" aria-label="StepRunner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner.configuration" class="md-nav__link">
    configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner.load_and_run_hook" class="md-nav__link">
    load_and_run_hook()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.step_runner.StepRunner.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.topsort" class="md-nav__link">
    topsort
  </a>
  
    <nav class="md-nav" aria-label="topsort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.topsort.topsorted_layers" class="md-nav__link">
    topsorted_layers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.register_artifact_store_filesystem" class="md-nav__link">
    register_artifact_store_filesystem
  </a>
  
    <nav class="md-nav" aria-label="register_artifact_store_filesystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.register_artifact_store_filesystem.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.register_artifact_store_filesystem.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.register_artifact_store_filesystem.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.get_config_environment_vars" class="md-nav__link">
    get_config_environment_vars()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.get_orchestrator_run_name" class="md-nav__link">
    get_orchestrator_run_name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.utils.is_setting_enabled" class="md-nav__link">
    is_setting_enabled()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator" class="md-nav__link">
    wheeled_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="wheeled_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator" class="md-nav__link">
    WheeledOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="WheeledOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.copy_repository_to_temp_dir_and_add_setup_py" class="md-nav__link">
    copy_repository_to_temp_dir_and_add_setup_py()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.create_wheel" class="md-nav__link">
    create_wheel()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.sanitize_name" class="md-nav__link">
    sanitize_name()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/zenml-io/zenml/docs/core_code_docs/core-orchestrators.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="orchestrators">Orchestrators</h1>


  <div class="doc doc-object doc-module">



<h2 id="zenml.orchestrators" class="doc doc-heading">
        <code>zenml.orchestrators</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents first">

      <p>Initialization for ZenML orchestrators.</p>
<p>An orchestrator is a special kind of backend that manages the running of each
step of the pipeline. Orchestrators administer the actual pipeline runs. You can
think of it as the 'root' of any pipeline job that you run during your
experimentation.</p>
<p>ZenML supports a local orchestrator out of the box which allows you to run your
pipelines in a local environment. We also support using Apache Airflow as the
orchestrator to handle the steps of your pipeline.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.base_orchestrator" class="doc doc-heading">
        <code>base_orchestrator</code>



</h3>

    <div class="doc doc-contents ">

      <p>Base orchestrator class.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator" class="doc doc-heading">
        <code>
BaseOrchestrator            (<a class="autorefs autorefs-internal" title="zenml.stack.stack_component.StackComponent" href="../core-stack/#zenml.stack.stack_component.StackComponent">StackComponent</a>, <span title="abc.ABC">ABC</span>)
        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Base class for all orchestrators.</p>
<p>In order to implement an orchestrator you will need to subclass from this
class.</p>
<h6 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator--how-it-works">How it works:</h6>
<p>The <code>run(...)</code> method is the entrypoint that is executed when the
pipeline's run method is called within the user code
(<code>pipeline_instance.run(...)</code>).</p>
<p>This method will do some internal preparation and then call the
<code>prepare_or_run_pipeline(...)</code> method. BaseOrchestrator subclasses must
implement this method and either run the pipeline steps directly or deploy
the pipeline to some remote infrastructure.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseOrchestrator</span><span class="p">(</span><span class="n">StackComponent</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all orchestrators.</span>

<span class="sd">    In order to implement an orchestrator you will need to subclass from this</span>
<span class="sd">    class.</span>

<span class="sd">    How it works:</span>
<span class="sd">    -------------</span>
<span class="sd">    The `run(...)` method is the entrypoint that is executed when the</span>
<span class="sd">    pipeline&#39;s run method is called within the user code</span>
<span class="sd">    (`pipeline_instance.run(...)`).</span>

<span class="sd">    This method will do some internal preparation and then call the</span>
<span class="sd">    `prepare_or_run_pipeline(...)` method. BaseOrchestrator subclasses must</span>
<span class="sd">    implement this method and either run the pipeline steps directly or deploy</span>
<span class="sd">    the pipeline to some remote infrastructure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_active_deployment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseOrchestratorConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `BaseOrchestratorConfig` config.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">BaseOrchestratorConfig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the run id of the active orchestrator run.</span>

<span class="sd">        Important: This needs to be a unique ID and return the same value for</span>
<span class="sd">        all steps of a pipeline run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The orchestrator run id.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
        <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The method needs to be implemented by the respective orchestrator.</span>

<span class="sd">        Depending on the type of orchestrator you&#39;ll have to perform slightly</span>
<span class="sd">        different operations.</span>

<span class="sd">        Simple Case:</span>
<span class="sd">        ------------</span>
<span class="sd">        The Steps are run directly from within the same environment in which</span>
<span class="sd">        the orchestrator code is executed. In this case you will need to</span>
<span class="sd">        deal with implementation-specific runtime configurations (like the</span>
<span class="sd">        schedule) and then iterate through the steps and finally call</span>
<span class="sd">        `self.run_step(...)` to execute each step.</span>

<span class="sd">        Advanced Case:</span>
<span class="sd">        --------------</span>
<span class="sd">        Most orchestrators will not run the steps directly. Instead, they</span>
<span class="sd">        build some intermediate representation of the pipeline that is then</span>
<span class="sd">        used to create and run the pipeline and its steps on the target</span>
<span class="sd">        environment. For such orchestrators this method will have to build</span>
<span class="sd">        this representation and deploy it.</span>

<span class="sd">        Regardless of the implementation details, the orchestrator will need</span>
<span class="sd">        to run each step in the target environment. For this the</span>
<span class="sd">        `self.run_step(...)` method should be used.</span>

<span class="sd">        The easiest way to make this work is by using an entrypoint</span>
<span class="sd">        configuration to run single steps (`zenml.entrypoints.step_entrypoint_configuration.StepEntrypointConfiguration`)</span>
<span class="sd">        or entire pipelines (`zenml.entrypoints.pipeline_entrypoint_configuration.PipelineEntrypointConfiguration`).</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">            stack: The stack the pipeline will run on.</span>
<span class="sd">            environment: Environment variables to set in the orchestration</span>
<span class="sd">                environment. These don&#39;t need to be set if running locally.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Metadata for the pipeline run.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
        <span class="n">placeholder_run</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs a pipeline on a stack.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment.</span>
<span class="sd">            stack: The stack on which to run the pipeline.</span>
<span class="sd">            placeholder_run: An optional placeholder run for the deployment.</span>
<span class="sd">                This will be deleted in case the pipeline deployment failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_run</span><span class="p">(</span><span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">)</span>

        <span class="n">pipeline_run_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">schedule_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
            <span class="n">schedule_id</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="n">placeholder_run</span><span class="p">:</span>
            <span class="n">pipeline_run_id</span> <span class="o">=</span> <span class="n">placeholder_run</span><span class="o">.</span><span class="n">id</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="n">get_config_environment_vars</span><span class="p">(</span>
            <span class="n">schedule_id</span><span class="o">=</span><span class="n">schedule_id</span><span class="p">,</span>
            <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">pipeline_run_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">prevent_client_side_caching</span> <span class="o">=</span> <span class="n">handle_bool_env_var</span><span class="p">(</span>
            <span class="n">ENV_ZENML_PREVENT_CLIENT_SIDE_CACHING</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">placeholder_run</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">supports_client_side_caching</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">prevent_client_side_caching</span>
        <span class="p">):</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.orchestrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">step_run_utils</span>

            <span class="n">cached_invocations</span> <span class="o">=</span> <span class="n">step_run_utils</span><span class="o">.</span><span class="n">create_cached_step_runs</span><span class="p">(</span>
                <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span>
                <span class="n">pipeline_run</span><span class="o">=</span><span class="n">placeholder_run</span><span class="p">,</span>
                <span class="n">stack</span><span class="o">=</span><span class="n">stack</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">invocation_id</span> <span class="ow">in</span> <span class="n">cached_invocations</span><span class="p">:</span>
                <span class="c1"># Remove the cached step invocations from the deployment so</span>
                <span class="c1"># the orchestrator does not try to run them</span>
                <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">invocation_id</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">invocation_id</span> <span class="ow">in</span> <span class="n">cached_invocations</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">invocation_id</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span><span class="p">:</span>
                        <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">invocation_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># All steps were cached, we update the pipeline run status and</span>
                <span class="c1"># don&#39;t actually use the orchestrator to run the pipeline</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_run</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All steps of the pipeline run were cached.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Skipping client-side caching.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metadata_iterator</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_or_run_pipeline</span><span class="p">(</span>
                <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span>
                <span class="n">stack</span><span class="o">=</span><span class="n">stack</span><span class="p">,</span>
                <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="n">metadata_dict</span> <span class="ow">in</span> <span class="n">metadata_iterator</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">placeholder_run</span><span class="p">:</span>
                            <span class="n">publish_pipeline_run_metadata</span><span class="p">(</span>
                                <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">placeholder_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                <span class="n">pipeline_run_metadata</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">metadata_dict</span><span class="p">},</span>
                            <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;Something went went wrong trying to publish the&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;run metadata: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_run</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs the given step.</span>

<span class="sd">        Args:</span>
<span class="sd">            step: The step to run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_deployment</span>
        <span class="n">launcher</span> <span class="o">=</span> <span class="n">StepLauncher</span><span class="p">(</span>
            <span class="n">deployment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_deployment</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
            <span class="n">orchestrator_run_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_orchestrator_run_id</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">launcher</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">requires_resources_in_orchestration_environment</span><span class="p">(</span>
        <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the orchestrator should run this step on special resources.</span>

<span class="sd">        Args:</span>
<span class="sd">            step: The step that will be checked.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the step requires special resources in the orchestration</span>
<span class="sd">            environment, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the step requires custom resources and doesn&#39;t run with a step</span>
        <span class="c1"># operator, it would need these requirements in the orchestrator</span>
        <span class="c1"># environment</span>
        <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">step_operator</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">resource_settings</span><span class="o">.</span><span class="n">empty</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares a run.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The deployment to prepare.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_deployment</span> <span class="o">=</span> <span class="n">deployment</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cleanup_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleans up the active run.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_deployment</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refreshes the status of a specific pipeline run.</span>

<span class="sd">        Args:</span>
<span class="sd">            run: A pipeline run response to fetch its status.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If any orchestrator inheriting from the base</span>
<span class="sd">                class does not implement this logic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The fetch status functionality is not implemented for the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; orchestrator.&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config</span><span class="p">:</span> <span class="n">BaseOrchestratorConfig</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Returns the <code>BaseOrchestratorConfig</code> config.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>BaseOrchestratorConfig</code></td>
      <td><p>The configuration.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.fetch_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fetch_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Refreshes the status of a specific pipeline run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>A pipeline run response to fetch its status.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>NotImplementedError</code></td>
        <td><p>If any orchestrator inheriting from the base
class does not implement this logic.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Refreshes the status of a specific pipeline run.</span>

<span class="sd">    Args:</span>
<span class="sd">        run: A pipeline run response to fetch its status.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If any orchestrator inheriting from the base</span>
<span class="sd">            class does not implement this logic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s2">&quot;The fetch status functionality is not implemented for the &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; orchestrator.&quot;</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.get_orchestrator_run_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Returns the run id of the active orchestrator run.</p>
<p>Important: This needs to be a unique ID and return the same value for
all steps of a pipeline run.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The orchestrator run id.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the run id of the active orchestrator run.</span>

<span class="sd">    Important: This needs to be a unique ID and return the same value for</span>
<span class="sd">    all steps of a pipeline run.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The orchestrator run id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_or_run_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>The method needs to be implemented by the respective orchestrator.</p>
<p>Depending on the type of orchestrator you'll have to perform slightly
different operations.</p>
<h6 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline--simple-case">Simple Case:</h6>
<p>The Steps are run directly from within the same environment in which
the orchestrator code is executed. In this case you will need to
deal with implementation-specific runtime configurations (like the
schedule) and then iterate through the steps and finally call
<code>self.run_step(...)</code> to execute each step.</p>
<h6 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.prepare_or_run_pipeline--advanced-case">Advanced Case:</h6>
<p>Most orchestrators will not run the steps directly. Instead, they
build some intermediate representation of the pipeline that is then
used to create and run the pipeline and its steps on the target
environment. For such orchestrators this method will have to build
this representation and deploy it.</p>
<p>Regardless of the implementation details, the orchestrator will need
to run each step in the target environment. For this the
<code>self.run_step(...)</code> method should be used.</p>
<p>The easiest way to make this work is by using an entrypoint
configuration to run single steps (<code>zenml.entrypoints.step_entrypoint_configuration.StepEntrypointConfiguration</code>)
or entire pipelines (<code>zenml.entrypoints.pipeline_entrypoint_configuration.PipelineEntrypointConfiguration</code>).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment to prepare or run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack the pipeline will run on.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>environment</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Environment variables to set in the orchestration
environment. These don't need to be set if running locally.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Yields:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[Iterator[Dict[str, Union[str, int, float, bool, Dict[Any, Any], List[Any], Set[Any], Tuple[Any, ...], zenml.metadata.metadata_types.Uri, zenml.metadata.metadata_types.Path, zenml.metadata.metadata_types.DType, zenml.metadata.metadata_types.StorageSize]]]]</code></td>
      <td><p>Metadata for the pipeline run.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The method needs to be implemented by the respective orchestrator.</span>

<span class="sd">    Depending on the type of orchestrator you&#39;ll have to perform slightly</span>
<span class="sd">    different operations.</span>

<span class="sd">    Simple Case:</span>
<span class="sd">    ------------</span>
<span class="sd">    The Steps are run directly from within the same environment in which</span>
<span class="sd">    the orchestrator code is executed. In this case you will need to</span>
<span class="sd">    deal with implementation-specific runtime configurations (like the</span>
<span class="sd">    schedule) and then iterate through the steps and finally call</span>
<span class="sd">    `self.run_step(...)` to execute each step.</span>

<span class="sd">    Advanced Case:</span>
<span class="sd">    --------------</span>
<span class="sd">    Most orchestrators will not run the steps directly. Instead, they</span>
<span class="sd">    build some intermediate representation of the pipeline that is then</span>
<span class="sd">    used to create and run the pipeline and its steps on the target</span>
<span class="sd">    environment. For such orchestrators this method will have to build</span>
<span class="sd">    this representation and deploy it.</span>

<span class="sd">    Regardless of the implementation details, the orchestrator will need</span>
<span class="sd">    to run each step in the target environment. For this the</span>
<span class="sd">    `self.run_step(...)` method should be used.</span>

<span class="sd">    The easiest way to make this work is by using an entrypoint</span>
<span class="sd">    configuration to run single steps (`zenml.entrypoints.step_entrypoint_configuration.StepEntrypointConfiguration`)</span>
<span class="sd">    or entire pipelines (`zenml.entrypoints.pipeline_entrypoint_configuration.PipelineEntrypointConfiguration`).</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">        stack: The stack the pipeline will run on.</span>
<span class="sd">        environment: Environment variables to set in the orchestration</span>
<span class="sd">            environment. These don&#39;t need to be set if running locally.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Metadata for the pipeline run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.requires_resources_in_orchestration_environment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">requires_resources_in_orchestration_environment</span><span class="p">(</span><span class="n">step</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Checks if the orchestrator should run this step on special resources.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step</code></td>
        <td><code>Step</code></td>
        <td><p>The step that will be checked.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if the step requires special resources in the orchestration
environment, False otherwise.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">requires_resources_in_orchestration_environment</span><span class="p">(</span>
    <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the orchestrator should run this step on special resources.</span>

<span class="sd">    Args:</span>
<span class="sd">        step: The step that will be checked.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the step requires special resources in the orchestration</span>
<span class="sd">        environment, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the step requires custom resources and doesn&#39;t run with a step</span>
    <span class="c1"># operator, it would need these requirements in the orchestrator</span>
    <span class="c1"># environment</span>
    <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">step_operator</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="ow">not</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">resource_settings</span><span class="o">.</span><span class="n">empty</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">placeholder_run</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Runs a pipeline on a stack.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack on which to run the pipeline.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>placeholder_run</code></td>
        <td><code>Optional[PipelineRunResponse]</code></td>
        <td><p>An optional placeholder run for the deployment.
This will be deleted in case the pipeline deployment failed.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
    <span class="n">placeholder_run</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs a pipeline on a stack.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment.</span>
<span class="sd">        stack: The stack on which to run the pipeline.</span>
<span class="sd">        placeholder_run: An optional placeholder run for the deployment.</span>
<span class="sd">            This will be deleted in case the pipeline deployment failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_run</span><span class="p">(</span><span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">)</span>

    <span class="n">pipeline_run_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">schedule_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
        <span class="n">schedule_id</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">id</span>
    <span class="k">if</span> <span class="n">placeholder_run</span><span class="p">:</span>
        <span class="n">pipeline_run_id</span> <span class="o">=</span> <span class="n">placeholder_run</span><span class="o">.</span><span class="n">id</span>

    <span class="n">environment</span> <span class="o">=</span> <span class="n">get_config_environment_vars</span><span class="p">(</span>
        <span class="n">schedule_id</span><span class="o">=</span><span class="n">schedule_id</span><span class="p">,</span>
        <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">pipeline_run_id</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">prevent_client_side_caching</span> <span class="o">=</span> <span class="n">handle_bool_env_var</span><span class="p">(</span>
        <span class="n">ENV_ZENML_PREVENT_CLIENT_SIDE_CACHING</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">placeholder_run</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">supports_client_side_caching</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">prevent_client_side_caching</span>
    <span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.orchestrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">step_run_utils</span>

        <span class="n">cached_invocations</span> <span class="o">=</span> <span class="n">step_run_utils</span><span class="o">.</span><span class="n">create_cached_step_runs</span><span class="p">(</span>
            <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">placeholder_run</span><span class="p">,</span>
            <span class="n">stack</span><span class="o">=</span><span class="n">stack</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">invocation_id</span> <span class="ow">in</span> <span class="n">cached_invocations</span><span class="p">:</span>
            <span class="c1"># Remove the cached step invocations from the deployment so</span>
            <span class="c1"># the orchestrator does not try to run them</span>
            <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">invocation_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">invocation_id</span> <span class="ow">in</span> <span class="n">cached_invocations</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">invocation_id</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span><span class="p">:</span>
                    <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">invocation_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># All steps were cached, we update the pipeline run status and</span>
            <span class="c1"># don&#39;t actually use the orchestrator to run the pipeline</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_run</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All steps of the pipeline run were cached.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Skipping client-side caching.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">metadata_iterator</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_or_run_pipeline</span><span class="p">(</span>
            <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span>
            <span class="n">stack</span><span class="o">=</span><span class="n">stack</span><span class="p">,</span>
            <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">metadata_dict</span> <span class="ow">in</span> <span class="n">metadata_iterator</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">placeholder_run</span><span class="p">:</span>
                        <span class="n">publish_pipeline_run_metadata</span><span class="p">(</span>
                            <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">placeholder_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                            <span class="n">pipeline_run_metadata</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">metadata_dict</span><span class="p">},</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Something went went wrong trying to publish the&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;run metadata: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_run</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestrator.run_step" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Runs the given step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step</code></td>
        <td><code>Step</code></td>
        <td><p>The step to run.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the given step.</span>

<span class="sd">    Args:</span>
<span class="sd">        step: The step to run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_deployment</span>
    <span class="n">launcher</span> <span class="o">=</span> <span class="n">StepLauncher</span><span class="p">(</span>
        <span class="n">deployment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_deployment</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
        <span class="n">orchestrator_run_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_orchestrator_run_id</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">launcher</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig" class="doc doc-heading">
        <code>
BaseOrchestratorConfig            (<a class="autorefs autorefs-internal" title="zenml.stack.stack_component.StackComponentConfig" href="../core-stack/#zenml.stack.stack_component.StackComponentConfig">StackComponentConfig</a>)
        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Base orchestrator config.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseOrchestratorConfig</span><span class="p">(</span><span class="n">StackComponentConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base orchestrator config.&quot;&quot;&quot;</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="nd">@before_validator_handler</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_deprecations</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate and/or remove deprecated fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The values to validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;custom_docker_base_image_name&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">image_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;custom_docker_base_image_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_name</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;The &#39;custom_docker_base_image_name&#39; field has been &quot;</span>
                    <span class="s2">&quot;deprecated. To use a custom base container image with your &quot;</span>
                    <span class="s2">&quot;orchestrators, please use the DockerSettings in your &quot;</span>
                    <span class="s2">&quot;pipeline (see https://docs.zenml.io/how-to/infrastructure-deployment/customize-docker-builds).&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_synchronous</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the orchestrator runs synchronous or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the orchestrator runs synchronous or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_schedulable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the orchestrator is schedulable or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the orchestrator is schedulable or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">supports_client_side_caching</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the orchestrator supports client side caching.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the orchestrator supports client side caching.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.is_schedulable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_schedulable</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Whether the orchestrator is schedulable or not.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Whether the orchestrator is schedulable or not.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.is_synchronous" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_synchronous</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Whether the orchestrator runs synchronous or not.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Whether the orchestrator runs synchronous or not.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-attribute">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig.supports_client_side_caching" class="doc doc-heading">
<code class="highlight language-python"><span class="n">supports_client_side_caching</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Whether the orchestrator supports client side caching.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Whether the orchestrator supports client side caching.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>









  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor" class="doc doc-heading">
        <code>
BaseOrchestratorFlavor            (<a class="autorefs autorefs-internal" title="zenml.stack.flavor.Flavor" href="../core-stack/#zenml.stack.flavor.Flavor">Flavor</a>)
        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Base orchestrator flavor class.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/base_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseOrchestratorFlavor</span><span class="p">(</span><span class="n">Flavor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base orchestrator flavor class.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StackComponentType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the flavor type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The flavor type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StackComponentType</span><span class="o">.</span><span class="n">ORCHESTRATOR</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">config_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseOrchestratorConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Config class for the base orchestrator flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The config class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BaseOrchestratorConfig</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">implementation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;BaseOrchestrator&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation class for this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The implementation class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.config_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">orchestrators</span><span class="o">.</span><span class="n">base_orchestrator</span><span class="o">.</span><span class="n">BaseOrchestratorConfig</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Config class for the base orchestrator flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig]</code></td>
      <td><p>The config class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.implementation_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">implementation_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseOrchestrator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Implementation class for this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[BaseOrchestrator]</code></td>
      <td><p>The implementation class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor.type" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">type</span><span class="p">:</span> <span class="n">StackComponentType</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Returns the flavor type.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>StackComponentType</code></td>
      <td><p>The flavor type.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>








  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.cache_utils" class="doc doc-heading">
        <code>cache_utils</code>



</h3>

    <div class="doc doc-contents ">

      <p>Utilities for caching.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.cache_utils.generate_cache_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_cache_key</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">input_artifact_ids</span><span class="p">,</span> <span class="n">artifact_store</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Generates a cache key for a step run.</p>
<p>If the cache key is the same for two step runs, we conclude that the step
runs are identical and can be cached.</p>
<p>The cache key is a MD5 hash of:
- the workspace ID,
- the artifact store ID and path,
- the source code that defines the step,
- the parameters of the step,
- the names and IDs of the input artifacts of the step,
- the names and source codes of the output artifacts of the step,
- the source codes of the output materializers of the step.
- additional custom caching parameters of the step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step</code></td>
        <td><code>Step</code></td>
        <td><p>The step to generate the cache key for.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>input_artifact_ids</code></td>
        <td><code>Dict[str, UUID]</code></td>
        <td><p>The input artifact IDs for the step.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>artifact_store</code></td>
        <td><code>BaseArtifactStore</code></td>
        <td><p>The artifact store of the active stack.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>workspace_id</code></td>
        <td><code>UUID</code></td>
        <td><p>The ID of the active workspace.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>A cache key.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/cache_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_cache_key</span><span class="p">(</span>
    <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span>
    <span class="n">input_artifact_ids</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;UUID&quot;</span><span class="p">],</span>
    <span class="n">artifact_store</span><span class="p">:</span> <span class="s2">&quot;BaseArtifactStore&quot;</span><span class="p">,</span>
    <span class="n">workspace_id</span><span class="p">:</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a cache key for a step run.</span>

<span class="sd">    If the cache key is the same for two step runs, we conclude that the step</span>
<span class="sd">    runs are identical and can be cached.</span>

<span class="sd">    The cache key is a MD5 hash of:</span>
<span class="sd">    - the workspace ID,</span>
<span class="sd">    - the artifact store ID and path,</span>
<span class="sd">    - the source code that defines the step,</span>
<span class="sd">    - the parameters of the step,</span>
<span class="sd">    - the names and IDs of the input artifacts of the step,</span>
<span class="sd">    - the names and source codes of the output artifacts of the step,</span>
<span class="sd">    - the source codes of the output materializers of the step.</span>
<span class="sd">    - additional custom caching parameters of the step.</span>

<span class="sd">    Args:</span>
<span class="sd">        step: The step to generate the cache key for.</span>
<span class="sd">        input_artifact_ids: The input artifact IDs for the step.</span>
<span class="sd">        artifact_store: The artifact store of the active stack.</span>
<span class="sd">        workspace_id: The ID of the active workspace.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A cache key.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hash_</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>  <span class="c1"># nosec</span>

    <span class="c1"># Workspace ID</span>
    <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">workspace_id</span><span class="o">.</span><span class="n">bytes</span><span class="p">)</span>

    <span class="c1"># Artifact store ID and path</span>
    <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">bytes</span><span class="p">)</span>
    <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">artifact_store</span><span class="o">.</span><span class="n">custom_cache_key</span><span class="p">:</span>
        <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">custom_cache_key</span><span class="p">)</span>

    <span class="c1"># Step source. This currently only uses the string representation of the</span>
    <span class="c1"># source (e.g. my_module.step_class) instead of the full source to keep</span>
    <span class="c1"># the caching behavior of previous versions and to not invalidate caching</span>
    <span class="c1"># when committing some unrelated files</span>
    <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">import_path</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

    <span class="c1"># Step parameters</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

    <span class="c1"># Input artifacts</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">artifact_version_id</span> <span class="ow">in</span> <span class="n">input_artifact_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">artifact_version_id</span><span class="o">.</span><span class="n">bytes</span><span class="p">)</span>

    <span class="c1"># Output artifacts and materializers</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">materializer_source</span><span class="p">:</span>
            <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">import_path</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

    <span class="c1"># Custom caching parameters</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">caching_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">hash_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">hash_</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.cache_utils.get_cached_step_run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_cached_step_run</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>If a given step can be cached, get the corresponding existing step run.</p>
<p>A step run can be cached if there is an existing step run in the same
workspace which has the same cache key and was successfully executed.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>cache_key</code></td>
        <td><code>str</code></td>
        <td><p>The cache key of the step.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[StepRunResponse]</code></td>
      <td><p>The existing step run if the step can be cached, otherwise None.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/cache_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_cached_step_run</span><span class="p">(</span><span class="n">cache_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;StepRunResponse&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If a given step can be cached, get the corresponding existing step run.</span>

<span class="sd">    A step run can be cached if there is an existing step run in the same</span>
<span class="sd">    workspace which has the same cache key and was successfully executed.</span>

<span class="sd">    Args:</span>
<span class="sd">        cache_key: The cache key of the step.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The existing step run if the step can be cached, otherwise None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>

    <span class="n">cache_candidates</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_run_steps</span><span class="p">(</span>
        <span class="n">workspace_id</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">active_workspace</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">cache_key</span><span class="o">=</span><span class="n">cache_key</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span>
        <span class="n">sort_by</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">SorterOps</span><span class="o">.</span><span class="n">DESCENDING</span><span class="si">}</span><span class="s2">:created&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">items</span>

    <span class="k">if</span> <span class="n">cache_candidates</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cache_candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.containerized_orchestrator" class="doc doc-heading">
        <code>containerized_orchestrator</code>



</h3>

    <div class="doc doc-contents ">

      <p>Containerized orchestrator class.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator" class="doc doc-heading">
        <code>
ContainerizedOrchestrator            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestrator" href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator">BaseOrchestrator</a>, <span title="abc.ABC">ABC</span>)
        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Base class for containerized orchestrators.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/containerized_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ContainerizedOrchestrator</span><span class="p">(</span><span class="n">BaseOrchestrator</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for containerized orchestrators.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">step_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the Docker image for the pipeline/a step.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The deployment from which to get the image.</span>
<span class="sd">            step_name: Pipeline step name for which to get the image. If not</span>
<span class="sd">                given the generic pipeline image will be returned.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the deployment does not have an associated build.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The image name or digest.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">deployment</span><span class="o">.</span><span class="n">build</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing build for deployment </span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">. This is &quot;</span>
                <span class="s2">&quot;probably because the build was manually deleted.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">deployment</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
            <span class="n">component_key</span><span class="o">=</span><span class="n">ORCHESTRATOR_DOCKER_IMAGE_KEY</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step_name</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_docker_builds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentBase&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;BuildConfiguration&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the Docker builds required for the component.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment for which to get the builds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The required Docker builds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline_settings</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">docker_settings</span>

        <span class="n">included_pipeline_build</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">builds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">step_settings</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">docker_settings</span>

            <span class="k">if</span> <span class="n">step_settings</span> <span class="o">!=</span> <span class="n">pipeline_settings</span><span class="p">:</span>
                <span class="n">build</span> <span class="o">=</span> <span class="n">BuildConfiguration</span><span class="p">(</span>
                    <span class="n">key</span><span class="o">=</span><span class="n">ORCHESTRATOR_DOCKER_IMAGE_KEY</span><span class="p">,</span>
                    <span class="n">settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
                    <span class="n">step_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">builds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">included_pipeline_build</span><span class="p">:</span>
                <span class="n">pipeline_build</span> <span class="o">=</span> <span class="n">BuildConfiguration</span><span class="p">(</span>
                    <span class="n">key</span><span class="o">=</span><span class="n">ORCHESTRATOR_DOCKER_IMAGE_KEY</span><span class="p">,</span>
                    <span class="n">settings</span><span class="o">=</span><span class="n">pipeline_settings</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">builds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline_build</span><span class="p">)</span>
                <span class="n">included_pipeline_build</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">builds</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator.get_docker_builds" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_docker_builds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Gets the Docker builds required for the component.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentBase</code></td>
        <td><p>The pipeline deployment for which to get the builds.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[BuildConfiguration]</code></td>
      <td><p>The required Docker builds.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/containerized_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_docker_builds</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentBase&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;BuildConfiguration&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the Docker builds required for the component.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment for which to get the builds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The required Docker builds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pipeline_settings</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">docker_settings</span>

    <span class="n">included_pipeline_build</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">builds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">step_settings</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">docker_settings</span>

        <span class="k">if</span> <span class="n">step_settings</span> <span class="o">!=</span> <span class="n">pipeline_settings</span><span class="p">:</span>
            <span class="n">build</span> <span class="o">=</span> <span class="n">BuildConfiguration</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="n">ORCHESTRATOR_DOCKER_IMAGE_KEY</span><span class="p">,</span>
                <span class="n">settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
                <span class="n">step_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">builds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">included_pipeline_build</span><span class="p">:</span>
            <span class="n">pipeline_build</span> <span class="o">=</span> <span class="n">BuildConfiguration</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="n">ORCHESTRATOR_DOCKER_IMAGE_KEY</span><span class="p">,</span>
                <span class="n">settings</span><span class="o">=</span><span class="n">pipeline_settings</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">builds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline_build</span><span class="p">)</span>
            <span class="n">included_pipeline_build</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">builds</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator.get_image" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_image</span><span class="p">(</span><span class="n">deployment</span><span class="p">,</span> <span class="n">step_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Gets the Docker image for the pipeline/a step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The deployment from which to get the image.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>step_name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Pipeline step name for which to get the image. If not
given the generic pipeline image will be returned.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the deployment does not have an associated build.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The image name or digest.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/containerized_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">step_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the Docker image for the pipeline/a step.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The deployment from which to get the image.</span>
<span class="sd">        step_name: Pipeline step name for which to get the image. If not</span>
<span class="sd">            given the generic pipeline image will be returned.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the deployment does not have an associated build.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The image name or digest.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">deployment</span><span class="o">.</span><span class="n">build</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing build for deployment </span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">. This is &quot;</span>
            <span class="s2">&quot;probably because the build was manually deleted.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">deployment</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
        <span class="n">component_key</span><span class="o">=</span><span class="n">ORCHESTRATOR_DOCKER_IMAGE_KEY</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step_name</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.dag_runner" class="doc doc-heading">
        <code>dag_runner</code>



</h3>

    <div class="doc doc-contents ">

      <p>DAG (Directed Acyclic Graph) Runners.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.dag_runner.NodeStatus" class="doc doc-heading">
        <code>
NodeStatus            (<span title="enum.Enum">Enum</span>)
        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Status of the execution of a node.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/dag_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NodeStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Status of the execution of a node.&quot;&quot;&quot;</span>

    <span class="n">WAITING</span> <span class="o">=</span> <span class="s2">&quot;Waiting&quot;</span>
    <span class="n">RUNNING</span> <span class="o">=</span> <span class="s2">&quot;Running&quot;</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">&quot;Completed&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.dag_runner.ThreadedDagRunner" class="doc doc-heading">
        <code>
ThreadedDagRunner        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Multi-threaded DAG Runner.</p>
<p>This class expects a DAG of strings in adjacency list representation, as
well as a custom <code>run_fn</code> as input, then calls <code>run_fn(node)</code> for each
string node in the DAG.</p>
<p>Steps that can be executed in parallel will be started in separate threads.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/dag_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ThreadedDagRunner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multi-threaded DAG Runner.</span>

<span class="sd">    This class expects a DAG of strings in adjacency list representation, as</span>
<span class="sd">    well as a custom `run_fn` as input, then calls `run_fn(node)` for each</span>
<span class="sd">    string node in the DAG.</span>

<span class="sd">    Steps that can be executed in parallel will be started in separate threads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dag</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">run_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">parallel_node_startup_waiting_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define attributes and initialize all nodes in waiting state.</span>

<span class="sd">        Args:</span>
<span class="sd">            dag: Adjacency list representation of a DAG.</span>
<span class="sd">                E.g.: [(1-&gt;2), (1-&gt;3), (2-&gt;4), (3-&gt;4)] should be represented as</span>
<span class="sd">                `dag={2: [1], 3: [1], 4: [2, 3]}`</span>
<span class="sd">            run_fn: A function `run_fn(node)` that runs a single node</span>
<span class="sd">            parallel_node_startup_waiting_period: Delay in seconds to wait in</span>
<span class="sd">                between starting parallel nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parallel_node_startup_waiting_period</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">parallel_node_startup_waiting_period</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dag</span> <span class="o">=</span> <span class="n">dag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reversed_dag</span> <span class="o">=</span> <span class="n">reverse_dag</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_fn</span> <span class="o">=</span> <span class="n">run_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">WAITING</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a node is ready to be run.</span>

<span class="sd">        This is the case if the node has not run yet and all of its upstream</span>
<span class="sd">        node have already completed.</span>

<span class="sd">        Args:</span>
<span class="sd">            node: The node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the node can run else False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that node has not run yet.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">WAITING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check that all upstream nodes of this node have already completed.</span>
        <span class="k">for</span> <span class="n">upstream_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span><span class="p">[</span><span class="n">upstream_node</span><span class="p">]</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a single node.</span>

<span class="sd">        Calls the user-defined run_fn, then calls `self._finish_node`.</span>

<span class="sd">        Args:</span>
<span class="sd">            node: The node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_fn</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finish_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_node_in_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a single node in a separate thread.</span>

<span class="sd">        First updates the node status to running.</span>
<span class="sd">        Then calls self._run_node() in a new thread and returns the thread.</span>

<span class="sd">        Args:</span>
<span class="sd">            node: The node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The thread in which the node was run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update node status to running.</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">WAITING</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">RUNNING</span>

        <span class="c1"># Run node in new thread.</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_node</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">node</span><span class="p">,))</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">thread</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_finish_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Finish a node run.</span>

<span class="sd">        First updates the node status to completed.</span>
<span class="sd">        Then starts all other nodes that can now be run and waits for them.</span>

<span class="sd">        Args:</span>
<span class="sd">            node: The node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update node status to completed.</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">RUNNING</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">COMPLETED</span>

        <span class="c1"># Run downstream nodes.</span>
        <span class="n">threads</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">downstram_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversed_dag</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_run</span><span class="p">(</span><span class="n">downstram_node</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">threads</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_node_startup_waiting_period</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallel_node_startup_waiting_period</span><span class="p">)</span>

                <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_node_in_thread</span><span class="p">(</span><span class="n">downstram_node</span><span class="p">)</span>
                <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

        <span class="c1"># Wait for all downstream nodes to complete.</span>
        <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call `self.run_fn` on all nodes in `self.dag`.</span>

<span class="sd">        The order of execution is determined using topological sort.</span>
<span class="sd">        Each node is run in a separate thread to enable parallelism.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Run all nodes that can be started immediately.</span>
        <span class="c1"># These will, in turn, start other nodes once all of their respective</span>
        <span class="c1"># upstream nodes have completed.</span>
        <span class="n">threads</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_run</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">threads</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_node_startup_waiting_period</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallel_node_startup_waiting_period</span><span class="p">)</span>

                <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_node_in_thread</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

        <span class="c1"># Wait till all nodes have completed.</span>
        <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="c1"># Make sure all nodes were run, otherwise print a warning.</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">WAITING</span><span class="p">:</span>
                <span class="n">upstream_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Node `</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">` was never run, because it was still&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; waiting for the following nodes: `</span><span class="si">{</span><span class="n">upstream_nodes</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.dag_runner.ThreadedDagRunner.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dag</span><span class="p">,</span> <span class="n">run_fn</span><span class="p">,</span> <span class="n">parallel_node_startup_waiting_period</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Define attributes and initialize all nodes in waiting state.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>dag</code></td>
        <td><code>Dict[str, List[str]]</code></td>
        <td><p>Adjacency list representation of a DAG.
E.g.: [(1-&gt;2), (1-&gt;3), (2-&gt;4), (3-&gt;4)] should be represented as
<code>dag={2: [1], 3: [1], 4: [2, 3]}</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>run_fn</code></td>
        <td><code>Callable[[str], Any]</code></td>
        <td><p>A function <code>run_fn(node)</code> that runs a single node</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>parallel_node_startup_waiting_period</code></td>
        <td><code>float</code></td>
        <td><p>Delay in seconds to wait in
between starting parallel nodes.</p></td>
        <td><code>0.0</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/dag_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dag</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">run_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">parallel_node_startup_waiting_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define attributes and initialize all nodes in waiting state.</span>

<span class="sd">    Args:</span>
<span class="sd">        dag: Adjacency list representation of a DAG.</span>
<span class="sd">            E.g.: [(1-&gt;2), (1-&gt;3), (2-&gt;4), (3-&gt;4)] should be represented as</span>
<span class="sd">            `dag={2: [1], 3: [1], 4: [2, 3]}`</span>
<span class="sd">        run_fn: A function `run_fn(node)` that runs a single node</span>
<span class="sd">        parallel_node_startup_waiting_period: Delay in seconds to wait in</span>
<span class="sd">            between starting parallel nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parallel_node_startup_waiting_period</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">parallel_node_startup_waiting_period</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dag</span> <span class="o">=</span> <span class="n">dag</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reversed_dag</span> <span class="o">=</span> <span class="n">reverse_dag</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_fn</span> <span class="o">=</span> <span class="n">run_fn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">WAITING</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.dag_runner.ThreadedDagRunner.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Call <code>self.run_fn</code> on all nodes in <code>self.dag</code>.</p>
<p>The order of execution is determined using topological sort.
Each node is run in a separate thread to enable parallelism.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/dag_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call `self.run_fn` on all nodes in `self.dag`.</span>

<span class="sd">    The order of execution is determined using topological sort.</span>
<span class="sd">    Each node is run in a separate thread to enable parallelism.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Run all nodes that can be started immediately.</span>
    <span class="c1"># These will, in turn, start other nodes once all of their respective</span>
    <span class="c1"># upstream nodes have completed.</span>
    <span class="n">threads</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_run</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">threads</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_node_startup_waiting_period</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallel_node_startup_waiting_period</span><span class="p">)</span>

            <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_node_in_thread</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

    <span class="c1"># Wait till all nodes have completed.</span>
    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="c1"># Make sure all nodes were run, otherwise print a warning.</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_states</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">WAITING</span><span class="p">:</span>
            <span class="n">upstream_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Node `</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">` was never run, because it was still&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; waiting for the following nodes: `</span><span class="si">{</span><span class="n">upstream_nodes</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.dag_runner.reverse_dag" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reverse_dag</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Reverse a DAG.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>dag</code></td>
        <td><code>Dict[str, List[str]]</code></td>
        <td><p>Adjacency list representation of a DAG.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, List[str]]</code></td>
      <td><p>Adjacency list representation of the reversed DAG.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/dag_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reverse_dag</span><span class="p">(</span><span class="n">dag</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reverse a DAG.</span>

<span class="sd">    Args:</span>
<span class="sd">        dag: Adjacency list representation of a DAG.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Adjacency list representation of the reversed DAG.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reversed_dag</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Reverse all edges in the graph.</span>
    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">upstream_nodes</span> <span class="ow">in</span> <span class="n">dag</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">upstream_node</span> <span class="ow">in</span> <span class="n">upstream_nodes</span><span class="p">:</span>
            <span class="n">reversed_dag</span><span class="p">[</span><span class="n">upstream_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="c1"># Add nodes without incoming edges back in.</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dag</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reversed_dag</span><span class="p">:</span>
            <span class="n">reversed_dag</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">reversed_dag</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.input_utils" class="doc doc-heading">
        <code>input_utils</code>



</h3>

    <div class="doc doc-contents ">

      <p>Utilities for inputs.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.input_utils.resolve_step_inputs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resolve_step_inputs</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Resolves inputs for the current step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step</code></td>
        <td><code>Step</code></td>
        <td><p>The step for which to resolve the inputs.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The current pipeline run.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>InputResolutionError</code></td>
        <td><p>If input resolving failed due to a missing
step or output.</p></td>
      </tr>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If object from model version passed into a step cannot be
resolved in runtime due to missing object.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[Dict[str, StepRunInputResponse], List[uuid.UUID]]</code></td>
      <td><p>The IDs of the input artifact versions and the IDs of parent steps of
    the current step.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/input_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve_step_inputs</span><span class="p">(</span>
    <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span>
    <span class="n">pipeline_run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;StepRunInputResponse&quot;</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">UUID</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resolves inputs for the current step.</span>

<span class="sd">    Args:</span>
<span class="sd">        step: The step for which to resolve the inputs.</span>
<span class="sd">        pipeline_run: The current pipeline run.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InputResolutionError: If input resolving failed due to a missing</span>
<span class="sd">            step or output.</span>
<span class="sd">        ValueError: If object from model version passed into a step cannot be</span>
<span class="sd">            resolved in runtime due to missing object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The IDs of the input artifact versions and the IDs of parent steps of</span>
<span class="sd">            the current step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArtifactVersionResponse</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.models.v2.core.step_run</span><span class="w"> </span><span class="kn">import</span> <span class="n">StepRunInputResponse</span>

    <span class="n">current_run_steps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">run_step</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">run_step</span>
        <span class="k">for</span> <span class="n">run_step</span> <span class="ow">in</span> <span class="n">pagination_utils</span><span class="o">.</span><span class="n">depaginate</span><span class="p">(</span>
            <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">list_run_steps</span><span class="p">,</span>
            <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="n">input_artifacts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StepRunInputResponse</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">input_</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">step_run</span> <span class="o">=</span> <span class="n">current_run_steps</span><span class="p">[</span><span class="n">input_</span><span class="o">.</span><span class="n">step_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputResolutionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No step `</span><span class="si">{</span><span class="n">input_</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2">` found in current run.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Try to get the substitutions from the pipeline run first, as we</span>
        <span class="c1"># already have a hydrated version of that. In the unlikely case</span>
        <span class="c1"># that the pipeline run is outdated, we fetch it from the step</span>
        <span class="c1"># run instead which will costs us one hydration call.</span>
        <span class="n">substitutions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pipeline_run</span><span class="o">.</span><span class="n">step_substitutions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">step_run</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">substitutions</span>
        <span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">string_utils</span><span class="o">.</span><span class="n">format_name_template</span><span class="p">(</span>
            <span class="n">input_</span><span class="o">.</span><span class="n">output_name</span><span class="p">,</span> <span class="n">substitutions</span><span class="o">=</span><span class="n">substitutions</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">step_run</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputResolutionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No step output `</span><span class="si">{</span><span class="n">output_name</span><span class="si">}</span><span class="s2">` found for step &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">input_</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>

        <span class="n">step_outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">output</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span>
            <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">save_type</span> <span class="o">==</span> <span class="n">ArtifactSaveType</span><span class="o">.</span><span class="n">STEP_OUTPUT</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_outputs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># This should never happen, there can only be a single regular step</span>
            <span class="c1"># output for a name</span>
            <span class="k">raise</span> <span class="n">InputResolutionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Too many step outputs for output `</span><span class="si">{</span><span class="n">output_name</span><span class="si">}</span><span class="s2">` of &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;step `</span><span class="si">{</span><span class="n">input_</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_outputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputResolutionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No step output `</span><span class="si">{</span><span class="n">output_name</span><span class="si">}</span><span class="s2">` found for step &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">input_</span><span class="o">.</span><span class="n">step_name</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>

        <span class="n">input_artifacts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">StepRunInputResponse</span><span class="p">(</span>
            <span class="n">input_type</span><span class="o">=</span><span class="n">StepRunInputArtifactType</span><span class="o">.</span><span class="n">STEP_OUTPUT</span><span class="p">,</span>
            <span class="o">**</span><span class="n">step_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">external_artifact</span><span class="p">,</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">external_input_artifacts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">artifact_version_id</span> <span class="o">=</span> <span class="n">external_artifact</span><span class="o">.</span><span class="n">get_artifact_version_id</span><span class="p">()</span>
        <span class="n">input_artifacts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">StepRunInputResponse</span><span class="p">(</span>
            <span class="n">input_type</span><span class="o">=</span><span class="n">StepRunInputArtifactType</span><span class="o">.</span><span class="n">EXTERNAL</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">get_artifact_version</span><span class="p">(</span><span class="n">artifact_version_id</span><span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">config_</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_artifacts_or_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">context_model_version</span> <span class="o">=</span> <span class="n">config_</span><span class="o">.</span><span class="n">_get_model_response</span><span class="p">(</span>
                <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">config_</span><span class="o">.</span><span class="n">artifact_name</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">config_</span><span class="o">.</span><span class="n">metadata_name</span>
                <span class="ow">and</span> <span class="n">context_model_version</span><span class="o">.</span><span class="n">run_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="c1"># metadata values should go directly in parameters, as primitive types</span>
                <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">context_model_version</span><span class="o">.</span><span class="n">run_metadata</span><span class="p">[</span><span class="n">config_</span><span class="o">.</span><span class="n">metadata_name</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">config_</span><span class="o">.</span><span class="n">artifact_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Cannot load artifact from model version, &quot;</span>
                    <span class="s2">&quot;no artifact name specified.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">artifact_</span> <span class="o">:=</span> <span class="n">context_model_version</span><span class="o">.</span><span class="n">get_artifact</span><span class="p">(</span>
                    <span class="n">config_</span><span class="o">.</span><span class="n">artifact_name</span><span class="p">,</span> <span class="n">config_</span><span class="o">.</span><span class="n">artifact_version</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">config_</span><span class="o">.</span><span class="n">metadata_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">input_artifacts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">StepRunInputResponse</span><span class="p">(</span>
                            <span class="n">input_type</span><span class="o">=</span><span class="n">StepRunInputArtifactType</span><span class="o">.</span><span class="n">LAZY_LOADED</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">artifact_</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">config_</span><span class="o">.</span><span class="n">metadata_name</span><span class="p">:</span>
                        <span class="c1"># metadata values should go directly in parameters, as primitive types</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">artifact_</span><span class="o">.</span><span class="n">run_metadata</span><span class="p">[</span><span class="n">config_</span><span class="o">.</span><span class="n">metadata_name</span><span class="p">]</span>
                            <span class="p">)</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Artifact run metadata `</span><span class="si">{</span><span class="n">config_</span><span class="o">.</span><span class="n">metadata_name</span><span class="si">}</span><span class="s2">` &quot;</span>
                                <span class="s2">&quot;could not be found in artifact &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">config_</span><span class="o">.</span><span class="n">artifact_name</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">config_</span><span class="o">.</span><span class="n">artifact_version</span><span class="si">}</span><span class="s2">`.&quot;</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Artifact `</span><span class="si">{</span><span class="n">config_</span><span class="o">.</span><span class="n">artifact_name</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">config_</span><span class="o">.</span><span class="n">artifact_version</span><span class="si">}</span><span class="s2">` &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;not found in model `</span><span class="si">{</span><span class="n">context_model_version</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;version `</span><span class="si">{</span><span class="n">context_model_version</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="n">err_msg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to lazy load model version data in step `</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`: &quot;</span>
                <span class="o">+</span> <span class="n">err_msg</span>
            <span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">cll_</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">client_lazy_loaders</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value_</span> <span class="o">=</span> <span class="n">cll_</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_</span><span class="p">,</span> <span class="n">ArtifactVersionResponse</span><span class="p">):</span>
            <span class="n">input_artifacts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">StepRunInputResponse</span><span class="p">(</span>
                <span class="n">input_type</span><span class="o">=</span><span class="n">StepRunInputArtifactType</span><span class="o">.</span><span class="n">LAZY_LOADED</span><span class="p">,</span>
                <span class="o">**</span><span class="n">value_</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_</span>

    <span class="n">parent_step_ids</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">current_run_steps</span><span class="p">[</span><span class="n">upstream_step</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="k">for</span> <span class="n">upstream_step</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">input_artifacts</span><span class="p">,</span> <span class="n">parent_step_ids</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.local" class="doc doc-heading">
        <code>local</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Initialization for the local orchestrator.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h4 id="zenml.orchestrators.local.local_orchestrator" class="doc doc-heading">
        <code>local_orchestrator</code>



</h4>

    <div class="doc doc-contents ">

      <p>Implementation of the ZenML local orchestrator.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h5 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestrator" class="doc doc-heading">
        <code>
LocalOrchestrator            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestrator" href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator">BaseOrchestrator</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Orchestrator responsible for running pipelines locally.</p>
<p>This orchestrator does not allow for concurrent execution of steps and also
does not support running on a schedule.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local/local_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LocalOrchestrator</span><span class="p">(</span><span class="n">BaseOrchestrator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrator responsible for running pipelines locally.</span>

<span class="sd">    This orchestrator does not allow for concurrent execution of steps and also</span>
<span class="sd">    does not support running on a schedule.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_orchestrator_run_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
        <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterates through all steps and executes them sequentially.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">            stack: The stack on which the pipeline is deployed.</span>
<span class="sd">            environment: Environment variables to set in the orchestration</span>
<span class="sd">                environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Local Orchestrator currently does not support the &quot;</span>
                <span class="s2">&quot;use of schedules. The `schedule` will be ignored &quot;</span>
                <span class="s2">&quot;and the pipeline will be run immediately.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Run each step</span>
        <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_resources_in_orchestration_environment</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Specifying step resources is not supported for the local &quot;</span>
                    <span class="s2">&quot;orchestrator, ignoring resource configuration for &quot;</span>
                    <span class="s2">&quot;step </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                    <span class="n">step_name</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">run_step</span><span class="p">(</span>
                <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">run_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Pipeline run has finished in `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
            <span class="n">string_utils</span><span class="o">.</span><span class="n">get_human_readable_time</span><span class="p">(</span><span class="n">run_duration</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the active orchestrator run id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If no run id exists. This happens when this method</span>
<span class="sd">                gets called while the orchestrator is not running a pipeline.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The orchestrator run id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No run id set.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestrator.get_orchestrator_run_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Returns the active orchestrator run id.</p>

<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If no run id exists. This happens when this method
gets called while the orchestrator is not running a pipeline.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The orchestrator run id.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local/local_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the active orchestrator run id.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If no run id exists. This happens when this method</span>
<span class="sd">            gets called while the orchestrator is not running a pipeline.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The orchestrator run id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No run id set.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestrator.prepare_or_run_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_or_run_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Iterates through all steps and executes them sequentially.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment to prepare or run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack on which the pipeline is deployed.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>environment</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Environment variables to set in the orchestration
environment.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local/local_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterates through all steps and executes them sequentially.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">        stack: The stack on which the pipeline is deployed.</span>
<span class="sd">        environment: Environment variables to set in the orchestration</span>
<span class="sd">            environment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Local Orchestrator currently does not support the &quot;</span>
            <span class="s2">&quot;use of schedules. The `schedule` will be ignored &quot;</span>
            <span class="s2">&quot;and the pipeline will be run immediately.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Run each step</span>
    <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_resources_in_orchestration_environment</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Specifying step resources is not supported for the local &quot;</span>
                <span class="s2">&quot;orchestrator, ignoring resource configuration for &quot;</span>
                <span class="s2">&quot;step </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="n">step_name</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_step</span><span class="p">(</span>
            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">run_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Pipeline run has finished in `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
        <span class="n">string_utils</span><span class="o">.</span><span class="n">get_human_readable_time</span><span class="p">(</span><span class="n">run_duration</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig" class="doc doc-heading">
        <code>
LocalOrchestratorConfig            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig" href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig">BaseOrchestratorConfig</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Local orchestrator config.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local/local_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LocalOrchestratorConfig</span><span class="p">(</span><span class="n">BaseOrchestratorConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Local orchestrator config.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_local</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if this stack component is running locally.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this config is for a local component, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_synchronous</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the orchestrator runs synchronous or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the orchestrator runs synchronous or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig.is_local" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_local</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Checks if this stack component is running locally.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if this config is for a local component, False otherwise.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorConfig.is_synchronous" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_synchronous</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Whether the orchestrator runs synchronous or not.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Whether the orchestrator runs synchronous or not.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor" class="doc doc-heading">
        <code>
LocalOrchestratorFlavor            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor" href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor">BaseOrchestratorFlavor</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Class for the <code>LocalOrchestratorFlavor</code>.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local/local_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LocalOrchestratorFlavor</span><span class="p">(</span><span class="n">BaseOrchestratorFlavor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for the `LocalOrchestratorFlavor`.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The flavor name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The flavor name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;local&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A URL to point at docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sdk_docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A URL to point at SDK docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor SDK docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_sdk_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">logo_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A URL to represent the flavor in the dashboard.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The flavor logo.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;https://public-flavor-logos.s3.eu-central-1.amazonaws.com/orchestrator/local.png&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">config_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseOrchestratorConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Config class for the base orchestrator flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The config class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LocalOrchestratorConfig</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">implementation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">LocalOrchestrator</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation class for this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The implementation class for this flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LocalOrchestrator</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.config_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">orchestrators</span><span class="o">.</span><span class="n">base_orchestrator</span><span class="o">.</span><span class="n">BaseOrchestratorConfig</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Config class for the base orchestrator flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig]</code></td>
      <td><p>The config class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A URL to point at docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.implementation_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">implementation_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">orchestrators</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">local_orchestrator</span><span class="o">.</span><span class="n">LocalOrchestrator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Implementation class for this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[zenml.orchestrators.local.local_orchestrator.LocalOrchestrator]</code></td>
      <td><p>The implementation class for this flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.logo_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logo_url</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A URL to represent the flavor in the dashboard.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The flavor logo.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>The flavor name.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The flavor name.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local.local_orchestrator.LocalOrchestratorFlavor.sdk_docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sdk_docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A URL to point at SDK docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor SDK docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>








  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.local_docker" class="doc doc-heading">
        <code>local_docker</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Initialization for the local Docker orchestrator.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h4 id="zenml.orchestrators.local_docker.local_docker_orchestrator" class="doc doc-heading">
        <code>local_docker_orchestrator</code>



</h4>

    <div class="doc doc-contents ">

      <p>Implementation of the ZenML local Docker orchestrator.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h5 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator" class="doc doc-heading">
        <code>
LocalDockerOrchestrator            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator" href="#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator">ContainerizedOrchestrator</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Orchestrator responsible for running pipelines locally using Docker.</p>
<p>This orchestrator does not allow for concurrent execution of steps and also
does not support running on a schedule.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local_docker/local_docker_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LocalDockerOrchestrator</span><span class="p">(</span><span class="n">ContainerizedOrchestrator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrator responsible for running pipelines locally using Docker.</span>

<span class="sd">    This orchestrator does not allow for concurrent execution of steps and also</span>
<span class="sd">    does not support running on a schedule.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;BaseSettings&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Settings class for the Local Docker orchestrator.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The settings class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LocalDockerOrchestratorSettings</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StackValidator</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensures there is an image builder in the stack.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `StackValidator` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StackValidator</span><span class="p">(</span>
            <span class="n">required_components</span><span class="o">=</span><span class="p">{</span><span class="n">StackComponentType</span><span class="o">.</span><span class="n">IMAGE_BUILDER</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the active orchestrator run id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the environment variable specifying the run id</span>
<span class="sd">                is not set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The orchestrator run id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ENV_ZENML_DOCKER_ORCHESTRATOR_RUN_ID</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to read run id from environment variable &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ENV_ZENML_DOCKER_ORCHESTRATOR_RUN_ID</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
        <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sequentially runs all pipeline steps in local Docker containers.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">            stack: The stack the pipeline will run on.</span>
<span class="sd">            environment: Environment variables to set in the orchestration</span>
<span class="sd">                environment.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If a step fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Local Docker Orchestrator currently does not support the &quot;</span>
                <span class="s2">&quot;use of schedules. The `schedule` will be ignored &quot;</span>
                <span class="s2">&quot;and the pipeline will be run immediately.&quot;</span>
            <span class="p">)</span>

        <span class="n">docker_client</span> <span class="o">=</span> <span class="n">docker_utils</span><span class="o">.</span><span class="n">_try_get_docker_client_from_env</span><span class="p">()</span>

        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>

        <span class="c1"># Add the local stores path as a volume mount</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">check_local_paths</span><span class="p">()</span>
        <span class="n">local_stores_path</span> <span class="o">=</span> <span class="n">GlobalConfiguration</span><span class="p">()</span><span class="o">.</span><span class="n">local_stores_path</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">local_stores_path</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">local_stores_path</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;rw&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">orchestrator_run_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">environment</span><span class="p">[</span><span class="n">ENV_ZENML_DOCKER_ORCHESTRATOR_RUN_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">orchestrator_run_id</span>
        <span class="n">environment</span><span class="p">[</span><span class="n">ENV_ZENML_LOCAL_STORES_PATH</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_stores_path</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Run each step</span>
        <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_resources_in_orchestration_environment</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Specifying step resources is not supported for the local &quot;</span>
                    <span class="s2">&quot;Docker orchestrator, ignoring resource configuration for &quot;</span>
                    <span class="s2">&quot;step </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                    <span class="n">step_name</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">arguments</span> <span class="o">=</span> <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
                <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span> <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span>
            <span class="p">)</span>

            <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">LocalDockerOrchestratorSettings</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span> <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">)</span>

            <span class="n">user</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running step `</span><span class="si">%s</span><span class="s2">` in Docker:&quot;</span><span class="p">,</span> <span class="n">step_name</span><span class="p">)</span>

            <span class="n">run_args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">run_args</span><span class="p">)</span>
            <span class="n">docker_environment</span> <span class="o">=</span> <span class="n">run_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">docker_environment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>

            <span class="n">docker_volumes</span> <span class="o">=</span> <span class="n">run_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;volumes&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">docker_volumes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>

            <span class="n">extra_hosts</span> <span class="o">=</span> <span class="n">run_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;extra_hosts&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">extra_hosts</span><span class="p">[</span><span class="s2">&quot;host.docker.internal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;host-gateway&quot;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">logs</span> <span class="o">=</span> <span class="n">docker_client</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                    <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
                    <span class="n">entrypoint</span><span class="o">=</span><span class="n">entrypoint</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
                    <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
                    <span class="n">volumes</span><span class="o">=</span><span class="n">docker_volumes</span><span class="p">,</span>
                    <span class="n">environment</span><span class="o">=</span><span class="n">docker_environment</span><span class="p">,</span>
                    <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">extra_hosts</span><span class="o">=</span><span class="n">extra_hosts</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">run_args</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
            <span class="k">except</span> <span class="n">ContainerError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error_message</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

        <span class="n">run_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Pipeline run has finished in `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
            <span class="n">string_utils</span><span class="o">.</span><span class="n">get_human_readable_time</span><span class="p">(</span><span class="n">run_duration</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.settings_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">settings_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Settings class for the Local Docker orchestrator.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[Type[BaseSettings]]</code></td>
      <td><p>The settings class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.validator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">stack_validator</span><span class="o">.</span><span class="n">StackValidator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Ensures there is an image builder in the stack.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.stack.stack_validator.StackValidator]</code></td>
      <td><p>A <code>StackValidator</code> instance.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.get_orchestrator_run_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Returns the active orchestrator run id.</p>

<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the environment variable specifying the run id
is not set.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The orchestrator run id.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local_docker/local_docker_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the active orchestrator run id.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the environment variable specifying the run id</span>
<span class="sd">            is not set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The orchestrator run id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ENV_ZENML_DOCKER_ORCHESTRATOR_RUN_ID</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Unable to read run id from environment variable &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ENV_ZENML_DOCKER_ORCHESTRATOR_RUN_ID</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestrator.prepare_or_run_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_or_run_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Sequentially runs all pipeline steps in local Docker containers.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment to prepare or run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack the pipeline will run on.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>environment</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Environment variables to set in the orchestration
environment.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If a step fails.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local_docker/local_docker_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sequentially runs all pipeline steps in local Docker containers.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">        stack: The stack the pipeline will run on.</span>
<span class="sd">        environment: Environment variables to set in the orchestration</span>
<span class="sd">            environment.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If a step fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Local Docker Orchestrator currently does not support the &quot;</span>
            <span class="s2">&quot;use of schedules. The `schedule` will be ignored &quot;</span>
            <span class="s2">&quot;and the pipeline will be run immediately.&quot;</span>
        <span class="p">)</span>

    <span class="n">docker_client</span> <span class="o">=</span> <span class="n">docker_utils</span><span class="o">.</span><span class="n">_try_get_docker_client_from_env</span><span class="p">()</span>

    <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>

    <span class="c1"># Add the local stores path as a volume mount</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">check_local_paths</span><span class="p">()</span>
    <span class="n">local_stores_path</span> <span class="o">=</span> <span class="n">GlobalConfiguration</span><span class="p">()</span><span class="o">.</span><span class="n">local_stores_path</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">local_stores_path</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">local_stores_path</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;rw&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">orchestrator_run_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">environment</span><span class="p">[</span><span class="n">ENV_ZENML_DOCKER_ORCHESTRATOR_RUN_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">orchestrator_run_id</span>
    <span class="n">environment</span><span class="p">[</span><span class="n">ENV_ZENML_LOCAL_STORES_PATH</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_stores_path</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Run each step</span>
    <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_resources_in_orchestration_environment</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Specifying step resources is not supported for the local &quot;</span>
                <span class="s2">&quot;Docker orchestrator, ignoring resource configuration for &quot;</span>
                <span class="s2">&quot;step </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="n">step_name</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">arguments</span> <span class="o">=</span> <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span> <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span>
        <span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">LocalDockerOrchestratorSettings</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span> <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">)</span>

        <span class="n">user</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running step `</span><span class="si">%s</span><span class="s2">` in Docker:&quot;</span><span class="p">,</span> <span class="n">step_name</span><span class="p">)</span>

        <span class="n">run_args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">run_args</span><span class="p">)</span>
        <span class="n">docker_environment</span> <span class="o">=</span> <span class="n">run_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">docker_environment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>

        <span class="n">docker_volumes</span> <span class="o">=</span> <span class="n">run_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;volumes&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">docker_volumes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>

        <span class="n">extra_hosts</span> <span class="o">=</span> <span class="n">run_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;extra_hosts&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">extra_hosts</span><span class="p">[</span><span class="s2">&quot;host.docker.internal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;host-gateway&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">logs</span> <span class="o">=</span> <span class="n">docker_client</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
                <span class="n">entrypoint</span><span class="o">=</span><span class="n">entrypoint</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
                <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
                <span class="n">volumes</span><span class="o">=</span><span class="n">docker_volumes</span><span class="p">,</span>
                <span class="n">environment</span><span class="o">=</span><span class="n">docker_environment</span><span class="p">,</span>
                <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">extra_hosts</span><span class="o">=</span><span class="n">extra_hosts</span><span class="p">,</span>
                <span class="o">**</span><span class="n">run_args</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">ContainerError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

    <span class="n">run_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Pipeline run has finished in `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
        <span class="n">string_utils</span><span class="o">.</span><span class="n">get_human_readable_time</span><span class="p">(</span><span class="n">run_duration</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig" class="doc doc-heading">
        <code>
LocalDockerOrchestratorConfig            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig" href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig">BaseOrchestratorConfig</a>, <a class="autorefs autorefs-internal" title="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorSettings" href="#zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorSettings">LocalDockerOrchestratorSettings</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Local Docker orchestrator config.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local_docker/local_docker_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LocalDockerOrchestratorConfig</span><span class="p">(</span>
    <span class="n">BaseOrchestratorConfig</span><span class="p">,</span> <span class="n">LocalDockerOrchestratorSettings</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Local Docker orchestrator config.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_local</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if this stack component is running locally.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this config is for a local component, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_synchronous</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the orchestrator runs synchronous or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the orchestrator runs synchronous or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig.is_local" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_local</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Checks if this stack component is running locally.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if this config is for a local component, False otherwise.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorConfig.is_synchronous" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_synchronous</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Whether the orchestrator runs synchronous or not.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Whether the orchestrator runs synchronous or not.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor" class="doc doc-heading">
        <code>
LocalDockerOrchestratorFlavor            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor" href="#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor">BaseOrchestratorFlavor</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Flavor for the local Docker orchestrator.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local_docker/local_docker_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LocalDockerOrchestratorFlavor</span><span class="p">(</span><span class="n">BaseOrchestratorFlavor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flavor for the local Docker orchestrator.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the orchestrator flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Name of the orchestrator flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;local_docker&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sdk_docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at SDK docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor SDK docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_sdk_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">logo_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to represent the flavor in the dashboard.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The flavor logo.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;https://public-flavor-logos.s3.eu-central-1.amazonaws.com/orchestrator/docker.png&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">config_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseOrchestratorConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Config class for the base orchestrator flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The config class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LocalDockerOrchestratorConfig</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">implementation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;LocalDockerOrchestrator&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation class for this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Implementation class for this flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LocalDockerOrchestrator</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.config_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">orchestrators</span><span class="o">.</span><span class="n">base_orchestrator</span><span class="o">.</span><span class="n">BaseOrchestratorConfig</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Config class for the base orchestrator flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig]</code></td>
      <td><p>The config class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.implementation_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">implementation_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">LocalDockerOrchestrator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Implementation class for this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[LocalDockerOrchestrator]</code></td>
      <td><p>Implementation class for this flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.logo_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logo_url</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to represent the flavor in the dashboard.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The flavor logo.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Name of the orchestrator flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Name of the orchestrator flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorFlavor.sdk_docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sdk_docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at SDK docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor SDK docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>








  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.orchestrators.local_docker.local_docker_orchestrator.LocalDockerOrchestratorSettings" class="doc doc-heading">
        <code>
LocalDockerOrchestratorSettings            (<a class="autorefs autorefs-internal" title="zenml.config.base_settings.BaseSettings" href="../core-config/#zenml.config.base_settings.BaseSettings">BaseSettings</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Local Docker orchestrator settings.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>run_args</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Arguments to pass to the <code>docker run</code> call. (See
https://docker-py.readthedocs.io/en/stable/containers.html for a list
of what can be passed.)</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/local_docker/local_docker_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LocalDockerOrchestratorSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Local Docker orchestrator settings.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        run_args: Arguments to pass to the `docker run` call. (See</span>
<span class="sd">            https://docker-py.readthedocs.io/en/stable/containers.html for a list</span>
<span class="sd">            of what can be passed.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">run_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



























  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.output_utils" class="doc doc-heading">
        <code>output_utils</code>



</h3>

    <div class="doc doc-contents ">

      <p>Utilities for outputs.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.output_utils.generate_artifact_uri" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_artifact_uri</span><span class="p">(</span><span class="n">artifact_store</span><span class="p">,</span> <span class="n">step_run</span><span class="p">,</span> <span class="n">output_name</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Generates a URI for an output artifact.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>artifact_store</code></td>
        <td><code>BaseArtifactStore</code></td>
        <td><p>The artifact store on which the artifact will be stored.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>step_run</code></td>
        <td><code>StepRunResponse</code></td>
        <td><p>The step run that created the artifact.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the output in the step run for this artifact.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The URI of the output artifact.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/output_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_artifact_uri</span><span class="p">(</span>
    <span class="n">artifact_store</span><span class="p">:</span> <span class="s2">&quot;BaseArtifactStore&quot;</span><span class="p">,</span>
    <span class="n">step_run</span><span class="p">:</span> <span class="s2">&quot;StepRunResponse&quot;</span><span class="p">,</span>
    <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a URI for an output artifact.</span>

<span class="sd">    Args:</span>
<span class="sd">        artifact_store: The artifact store on which the artifact will be stored.</span>
<span class="sd">        step_run: The step run that created the artifact.</span>
<span class="sd">        output_name: The name of the output in the step run for this artifact.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The URI of the output artifact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">banned_character</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">]:</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">banned_character</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">artifact_store</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="n">step_run</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">output_name</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">step_run</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">],</span>  <span class="c1"># add random subfolder to avoid collisions</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.output_utils.prepare_output_artifact_uris" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_output_artifact_uris</span><span class="p">(</span><span class="n">step_run</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Prepares the output artifact URIs to run the current step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step_run</code></td>
        <td><code>StepRunResponse</code></td>
        <td><p>The step run for which to prepare the artifact URIs.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack on which the pipeline is running.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>step</code></td>
        <td><code>Step</code></td>
        <td><p>The step configuration.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If an artifact URI already exists.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, str]</code></td>
      <td><p>A dictionary mapping output names to artifact URIs.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/output_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_output_artifact_uris</span><span class="p">(</span>
    <span class="n">step_run</span><span class="p">:</span> <span class="s2">&quot;StepRunResponse&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepares the output artifact URIs to run the current step.</span>

<span class="sd">    Args:</span>
<span class="sd">        step_run: The step run for which to prepare the artifact URIs.</span>
<span class="sd">        stack: The stack on which the pipeline is running.</span>
<span class="sd">        step: The step configuration.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If an artifact URI already exists.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary mapping output names to artifact URIs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">artifact_store</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span>
    <span class="n">output_artifact_uris</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">output_name</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">substituted_output_name</span> <span class="o">=</span> <span class="n">string_utils</span><span class="o">.</span><span class="n">format_name_template</span><span class="p">(</span>
            <span class="n">output_name</span><span class="p">,</span> <span class="n">substitutions</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">substitutions</span>
        <span class="p">)</span>
        <span class="n">artifact_uri</span> <span class="o">=</span> <span class="n">generate_artifact_uri</span><span class="p">(</span>
            <span class="n">artifact_store</span><span class="o">=</span><span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="p">,</span>
            <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span>
            <span class="n">output_name</span><span class="o">=</span><span class="n">substituted_output_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">artifact_store</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">artifact_uri</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Artifact already exists&quot;</span><span class="p">)</span>
        <span class="n">artifact_store</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">artifact_uri</span><span class="p">)</span>
        <span class="n">output_artifact_uris</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">artifact_uri</span>
    <span class="k">return</span> <span class="n">output_artifact_uris</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.output_utils.remove_artifact_dirs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_artifact_dirs</span><span class="p">(</span><span class="n">artifact_uris</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Removes the artifact directories.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>artifact_uris</code></td>
        <td><code>Sequence[str]</code></td>
        <td><p>URIs of the artifacts to remove the directories for.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/output_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_artifact_dirs</span><span class="p">(</span><span class="n">artifact_uris</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes the artifact directories.</span>

<span class="sd">    Args:</span>
<span class="sd">        artifact_uris: URIs of the artifacts to remove the directories for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">artifact_store</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack</span><span class="o">.</span><span class="n">artifact_store</span>
    <span class="k">for</span> <span class="n">artifact_uri</span> <span class="ow">in</span> <span class="n">artifact_uris</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">artifact_store</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">artifact_uri</span><span class="p">):</span>
            <span class="n">artifact_store</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">artifact_uri</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.publish_utils" class="doc doc-heading">
        <code>publish_utils</code>



</h3>

    <div class="doc doc-contents ">

      <p>Utilities to publish pipeline and step runs.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.publish_utils.get_pipeline_run_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_pipeline_run_status</span><span class="p">(</span><span class="n">step_statuses</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Gets the pipeline run status for the given step statuses.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step_statuses</code></td>
        <td><code>List[zenml.enums.ExecutionStatus]</code></td>
        <td><p>The status of steps in this run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>num_steps</code></td>
        <td><code>int</code></td>
        <td><p>The total amount of steps in this run.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ExecutionStatus</code></td>
      <td><p>The run status.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/publish_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_pipeline_run_status</span><span class="p">(</span>
    <span class="n">step_statuses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecutionStatus</span><span class="p">],</span> <span class="n">num_steps</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the pipeline run status for the given step statuses.</span>

<span class="sd">    Args:</span>
<span class="sd">        step_statuses: The status of steps in this run.</span>
<span class="sd">        num_steps: The total amount of steps in this run.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The run status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">FAILED</span> <span class="ow">in</span> <span class="n">step_statuses</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">FAILED</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">RUNNING</span> <span class="ow">in</span> <span class="n">step_statuses</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_statuses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_steps</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">RUNNING</span>

    <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">COMPLETED</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.publish_utils.publish_failed_pipeline_run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">publish_failed_pipeline_run</span><span class="p">(</span><span class="n">pipeline_run_id</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Publishes a failed pipeline run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pipeline_run_id</code></td>
        <td><code>UUID</code></td>
        <td><p>The ID of the pipeline run to update.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>PipelineRunResponse</code></td>
      <td><p>The updated pipeline run.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/publish_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_failed_pipeline_run</span><span class="p">(</span>
    <span class="n">pipeline_run_id</span><span class="p">:</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publishes a failed pipeline run.</span>

<span class="sd">    Args:</span>
<span class="sd">        pipeline_run_id: The ID of the pipeline run to update.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The updated pipeline run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">update_run</span><span class="p">(</span>
        <span class="n">run_id</span><span class="o">=</span><span class="n">pipeline_run_id</span><span class="p">,</span>
        <span class="n">run_update</span><span class="o">=</span><span class="n">PipelineRunUpdate</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">,</span>
            <span class="n">end_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.publish_utils.publish_failed_step_run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">publish_failed_step_run</span><span class="p">(</span><span class="n">step_run_id</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Publishes a failed step run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step_run_id</code></td>
        <td><code>UUID</code></td>
        <td><p>The ID of the step run to update.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>StepRunResponse</code></td>
      <td><p>The updated step run.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/publish_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_failed_step_run</span><span class="p">(</span><span class="n">step_run_id</span><span class="p">:</span> <span class="s2">&quot;UUID&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StepRunResponse&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publishes a failed step run.</span>

<span class="sd">    Args:</span>
<span class="sd">        step_run_id: The ID of the step run to update.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The updated step run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">update_run_step</span><span class="p">(</span>
        <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run_id</span><span class="p">,</span>
        <span class="n">step_run_update</span><span class="o">=</span><span class="n">StepRunUpdate</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">,</span>
            <span class="n">end_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.publish_utils.publish_pipeline_run_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">publish_pipeline_run_metadata</span><span class="p">(</span><span class="n">pipeline_run_id</span><span class="p">,</span> <span class="n">pipeline_run_metadata</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Publishes the given pipeline run metadata.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pipeline_run_id</code></td>
        <td><code>UUID</code></td>
        <td><p>The ID of the pipeline run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>pipeline_run_metadata</code></td>
        <td><code>Dict[UUID, Dict[str, MetadataType]]</code></td>
        <td><p>A dictionary mapping stack component IDs to the
metadata they created.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/publish_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_pipeline_run_metadata</span><span class="p">(</span>
    <span class="n">pipeline_run_id</span><span class="p">:</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
    <span class="n">pipeline_run_metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="s2">&quot;UUID&quot;</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;MetadataType&quot;</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publishes the given pipeline run metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        pipeline_run_id: The ID of the pipeline run.</span>
<span class="sd">        pipeline_run_metadata: A dictionary mapping stack component IDs to the</span>
<span class="sd">            metadata they created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">stack_component_id</span><span class="p">,</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">pipeline_run_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">client</span><span class="o">.</span><span class="n">create_run_metadata</span><span class="p">(</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">resources</span><span class="o">=</span><span class="p">[</span>
                <span class="n">RunMetadataResource</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">pipeline_run_id</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">MetadataResourceTypes</span><span class="o">.</span><span class="n">PIPELINE_RUN</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="n">stack_component_id</span><span class="o">=</span><span class="n">stack_component_id</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.publish_utils.publish_step_run_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">publish_step_run_metadata</span><span class="p">(</span><span class="n">step_run_id</span><span class="p">,</span> <span class="n">step_run_metadata</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Publishes the given step run metadata.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step_run_id</code></td>
        <td><code>UUID</code></td>
        <td><p>The ID of the step run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>step_run_metadata</code></td>
        <td><code>Dict[UUID, Dict[str, MetadataType]]</code></td>
        <td><p>A dictionary mapping stack component IDs to the
metadata they created.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/publish_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_step_run_metadata</span><span class="p">(</span>
    <span class="n">step_run_id</span><span class="p">:</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
    <span class="n">step_run_metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="s2">&quot;UUID&quot;</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;MetadataType&quot;</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publishes the given step run metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        step_run_id: The ID of the step run.</span>
<span class="sd">        step_run_metadata: A dictionary mapping stack component IDs to the</span>
<span class="sd">            metadata they created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">stack_component_id</span><span class="p">,</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">step_run_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">client</span><span class="o">.</span><span class="n">create_run_metadata</span><span class="p">(</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">resources</span><span class="o">=</span><span class="p">[</span>
                <span class="n">RunMetadataResource</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">step_run_id</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">MetadataResourceTypes</span><span class="o">.</span><span class="n">STEP_RUN</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="n">stack_component_id</span><span class="o">=</span><span class="n">stack_component_id</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.publish_utils.publish_successful_step_run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">publish_successful_step_run</span><span class="p">(</span><span class="n">step_run_id</span><span class="p">,</span> <span class="n">output_artifact_ids</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Publishes a successful step run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step_run_id</code></td>
        <td><code>UUID</code></td>
        <td><p>The ID of the step run to update.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_artifact_ids</code></td>
        <td><code>Dict[str, List[UUID]]</code></td>
        <td><p>The output artifact IDs for the step run.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>StepRunResponse</code></td>
      <td><p>The updated step run.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/publish_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_successful_step_run</span><span class="p">(</span>
    <span class="n">step_run_id</span><span class="p">:</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span> <span class="n">output_artifact_ids</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;UUID&quot;</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StepRunResponse&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publishes a successful step run.</span>

<span class="sd">    Args:</span>
<span class="sd">        step_run_id: The ID of the step run to update.</span>
<span class="sd">        output_artifact_ids: The output artifact IDs for the step run.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The updated step run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">update_run_step</span><span class="p">(</span>
        <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run_id</span><span class="p">,</span>
        <span class="n">step_run_update</span><span class="o">=</span><span class="n">StepRunUpdate</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span>
            <span class="n">end_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
            <span class="n">outputs</span><span class="o">=</span><span class="n">output_artifact_ids</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.step_launcher" class="doc doc-heading">
        <code>step_launcher</code>



</h3>

    <div class="doc doc-contents ">

      <p>Class to launch (run directly or using a step operator) steps.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.step_launcher.StepLauncher" class="doc doc-heading">
        <code>
StepLauncher        </code>



</h4>

    <div class="doc doc-contents ">

      <p>A class responsible for launching a step of a ZenML pipeline.</p>
<p>This class follows these steps to launch and publish a ZenML step:
1. Publish or reuse a <code>PipelineRun</code>
2. Resolve the input artifacts of the step
3. Generate a cache key for the step
4. Check if the step can be cached or not
5. Publish a new <code>StepRun</code>
6. If the step can't be cached, the step will be executed in one of these
two ways depending on its configuration:
    - Calling a <code>step operator</code> to run the step in a different environment
    - Calling a <code>step runner</code> to run the step in the current environment
7. Update the status of the previously published <code>StepRun</code>
8. Update the status of the <code>PipelineRun</code></p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_launcher.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StepLauncher</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class responsible for launching a step of a ZenML pipeline.</span>

<span class="sd">    This class follows these steps to launch and publish a ZenML step:</span>
<span class="sd">    1. Publish or reuse a `PipelineRun`</span>
<span class="sd">    2. Resolve the input artifacts of the step</span>
<span class="sd">    3. Generate a cache key for the step</span>
<span class="sd">    4. Check if the step can be cached or not</span>
<span class="sd">    5. Publish a new `StepRun`</span>
<span class="sd">    6. If the step can&#39;t be cached, the step will be executed in one of these</span>
<span class="sd">    two ways depending on its configuration:</span>
<span class="sd">        - Calling a `step operator` to run the step in a different environment</span>
<span class="sd">        - Calling a `step runner` to run the step in the current environment</span>
<span class="sd">    7. Update the status of the previously published `StepRun`</span>
<span class="sd">    8. Update the status of the `PipelineRun`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="n">PipelineDeploymentResponse</span><span class="p">,</span>
        <span class="n">step</span><span class="p">:</span> <span class="n">Step</span><span class="p">,</span>
        <span class="n">orchestrator_run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the launcher.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment.</span>
<span class="sd">            step: The step to launch.</span>
<span class="sd">            orchestrator_run_id: The orchestrator pipeline run id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the deployment has no associated stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span> <span class="o">=</span> <span class="n">deployment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span> <span class="o">=</span> <span class="n">orchestrator_run_id</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">deployment</span><span class="o">.</span><span class="n">stack</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing stack for deployment </span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">. This is &quot;</span>
                <span class="s2">&quot;probably because the stack was manually deleted.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span> <span class="o">=</span> <span class="n">Stack</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span><span class="n">deployment</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">pipeline_parameter_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Launches the step.</span>

<span class="sd">        Raises:</span>
<span class="sd">            BaseException: If the step failed to launch, run, or publish.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline_run</span><span class="p">,</span> <span class="n">run_was_created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_or_reuse_run</span><span class="p">()</span>

        <span class="c1"># Enable or disable step logs storage</span>
        <span class="k">if</span> <span class="n">handle_bool_env_var</span><span class="p">(</span><span class="n">ENV_ZENML_DISABLE_STEP_LOGS_STORAGE</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">step_logging_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step_logging_enabled</span> <span class="o">=</span> <span class="n">orchestrator_utils</span><span class="o">.</span><span class="n">is_setting_enabled</span><span class="p">(</span>
                <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_step_logs</span><span class="p">,</span>
                <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">enable_step_logs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">logs_context</span> <span class="o">=</span> <span class="n">nullcontext</span><span class="p">()</span>
        <span class="n">logs_model</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">step_logging_enabled</span><span class="p">:</span>
            <span class="c1"># Configure the logs</span>
            <span class="n">logs_uri</span> <span class="o">=</span> <span class="n">step_logging</span><span class="o">.</span><span class="n">prepare_logs_uri</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">logs_context</span> <span class="o">=</span> <span class="n">step_logging</span><span class="o">.</span><span class="n">StepLogsStorageContext</span><span class="p">(</span>
                <span class="n">logs_uri</span><span class="o">=</span><span class="n">logs_uri</span><span class="p">,</span> <span class="n">artifact_store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span>
            <span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>

            <span class="n">logs_model</span> <span class="o">=</span> <span class="n">LogsRequest</span><span class="p">(</span>
                <span class="n">uri</span><span class="o">=</span><span class="n">logs_uri</span><span class="p">,</span>
                <span class="n">artifact_store_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">logs_context</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">run_was_created</span><span class="p">:</span>
                    <span class="n">pipeline_run_metadata</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">get_pipeline_run_metadata</span><span class="p">(</span>
                            <span class="n">run_id</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">publish_utils</span><span class="o">.</span><span class="n">publish_pipeline_run_metadata</span><span class="p">(</span>
                        <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="n">pipeline_run_metadata</span><span class="o">=</span><span class="n">pipeline_run_metadata</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">pipeline_model_version</span><span class="p">,</span> <span class="n">pipeline_run</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">step_run_utils</span><span class="o">.</span><span class="n">prepare_pipeline_run_model_version</span><span class="p">(</span>
                        <span class="n">pipeline_run</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">request_factory</span> <span class="o">=</span> <span class="n">step_run_utils</span><span class="o">.</span><span class="n">StepRunRequestFactory</span><span class="p">(</span>
                    <span class="n">deployment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="p">,</span>
                    <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
                    <span class="n">stack</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">step_run_request</span> <span class="o">=</span> <span class="n">request_factory</span><span class="o">.</span><span class="n">create_request</span><span class="p">(</span>
                    <span class="n">invocation_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span>
                <span class="p">)</span>
                <span class="n">step_run_request</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="n">logs_model</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">request_factory</span><span class="o">.</span><span class="n">populate_request</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">step_run_request</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed preparing step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">step_run_request</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">FAILED</span>
                    <span class="n">step_run_request</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
                    <span class="k">raise</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">step_run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">create_run_step</span><span class="p">(</span>
                        <span class="n">step_run_request</span>
                    <span class="p">)</span>

                    <span class="n">step_model_version</span><span class="p">,</span> <span class="n">step_run</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">step_run_utils</span><span class="o">.</span><span class="n">prepare_step_run_model_version</span><span class="p">(</span>
                            <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">step_run</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">` has started.&quot;</span><span class="p">)</span>
                    <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">last_retry</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">max_retries</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span><span class="o">.</span><span class="n">max_retries</span>
                        <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span>
                        <span class="k">else</span> <span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="n">delay</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span><span class="o">.</span><span class="n">delay</span>
                        <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span>
                        <span class="k">else</span> <span class="mi">0</span>
                    <span class="p">)</span>
                    <span class="n">backoff</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span><span class="o">.</span><span class="n">backoff</span>
                        <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span>
                        <span class="k">else</span> <span class="mi">1</span>
                    <span class="p">)</span>

                    <span class="k">while</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
                        <span class="n">last_retry</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">==</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># here pass a forced save_to_file callable to be</span>
                            <span class="c1"># used as a dump function to use before starting</span>
                            <span class="c1"># the external jobs in step operators</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                                <span class="n">logs_context</span><span class="p">,</span>
                                <span class="n">step_logging</span><span class="o">.</span><span class="n">StepLogsStorageContext</span><span class="p">,</span>
                            <span class="p">):</span>
                                <span class="n">force_write_logs</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
                                    <span class="n">logs_context</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">,</span>
                                    <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>

                                <span class="k">def</span><span class="w"> </span><span class="nf">_bypass</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="k">return</span> <span class="kc">None</span>

                                <span class="n">force_write_logs</span> <span class="o">=</span> <span class="n">_bypass</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_run_step</span><span class="p">(</span>
                                <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
                                <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span>
                                <span class="n">last_retry</span><span class="o">=</span><span class="n">last_retry</span><span class="p">,</span>
                                <span class="n">force_write_logs</span><span class="o">=</span><span class="n">force_write_logs</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="k">break</span>
                        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
                            <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Failed to run step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">`. Retrying...&quot;</span>
                                <span class="p">)</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Sleeping for </span><span class="si">{</span><span class="n">delay</span><span class="si">}</span><span class="s2"> seconds before retrying.&quot;</span>
                                <span class="p">)</span>
                                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
                                <span class="n">delay</span> <span class="o">*=</span> <span class="n">backoff</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Failed to run step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">` after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> retries. Exiting.&quot;</span>
                                <span class="p">)</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                                <span class="n">publish_utils</span><span class="o">.</span><span class="n">publish_failed_step_run</span><span class="p">(</span>
                                    <span class="n">step_run</span><span class="o">.</span><span class="n">id</span>
                                <span class="p">)</span>
                                <span class="k">raise</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Using cached version of step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">model_version</span> <span class="o">:=</span> <span class="n">step_model_version</span>
                        <span class="ow">or</span> <span class="n">pipeline_model_version</span>
                    <span class="p">):</span>
                        <span class="n">step_run_utils</span><span class="o">.</span><span class="n">link_output_artifacts_to_model_version</span><span class="p">(</span>
                            <span class="n">artifacts</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span>
                            <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span><span class="p">,</span>
                        <span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline run `</span><span class="si">{</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` failed.&quot;</span><span class="p">)</span>
            <span class="n">publish_utils</span><span class="o">.</span><span class="n">publish_failed_pipeline_run</span><span class="p">(</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_or_reuse_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">PipelineRunResponse</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a pipeline run or reuses an existing one.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created or existing pipeline run,</span>
<span class="sd">            and a boolean indicating whether the run was created or reused.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">run_name</span> <span class="o">=</span> <span class="n">string_utils</span><span class="o">.</span><span class="n">format_name_template</span><span class="p">(</span>
            <span class="n">name_template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">run_name_template</span><span class="p">,</span>
            <span class="n">substitutions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">_get_full_substitutions</span><span class="p">(</span>
                <span class="n">start_time</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating pipeline run </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
        <span class="n">pipeline_run</span> <span class="o">=</span> <span class="n">PipelineRunRequest</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">run_name</span><span class="p">,</span>
            <span class="n">orchestrator_run_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">active_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">workspace</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">active_workspace</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">deployment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">pipeline</span><span class="o">=</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">id</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">pipeline</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
            <span class="n">orchestrator_environment</span><span class="o">=</span><span class="n">get_run_environment_dict</span><span class="p">(),</span>
            <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
            <span class="n">tags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">get_or_create_run</span><span class="p">(</span><span class="n">pipeline_run</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_step</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pipeline_run</span><span class="p">:</span> <span class="n">PipelineRunResponse</span><span class="p">,</span>
        <span class="n">step_run</span><span class="p">:</span> <span class="n">StepRunResponse</span><span class="p">,</span>
        <span class="n">force_write_logs</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">last_retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs the current step.</span>

<span class="sd">        Args:</span>
<span class="sd">            pipeline_run: The model of the current pipeline run.</span>
<span class="sd">            step_run: The model of the current step run.</span>
<span class="sd">            force_write_logs: The context for the step logs.</span>
<span class="sd">            last_retry: Whether this is the last retry of the step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Prepare step run information.</span>
        <span class="n">step_run_info</span> <span class="o">=</span> <span class="n">StepRunInfo</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">pipeline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="p">,</span>
            <span class="n">run_name</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">pipeline_step_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="p">,</span>
            <span class="n">run_id</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">force_write_logs</span><span class="o">=</span><span class="n">force_write_logs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">output_artifact_uris</span> <span class="o">=</span> <span class="n">output_utils</span><span class="o">.</span><span class="n">prepare_output_artifact_uris</span><span class="p">(</span>
            <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span>
        <span class="p">)</span>

        <span class="c1"># Run the step.</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">step_operator</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_step_with_step_operator</span><span class="p">(</span>
                    <span class="n">step_operator_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">step_operator</span><span class="p">,</span>
                    <span class="n">step_run_info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">,</span>
                    <span class="n">last_retry</span><span class="o">=</span><span class="n">last_retry</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_step_without_step_operator</span><span class="p">(</span>
                    <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
                    <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span>
                    <span class="n">step_run_info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">,</span>
                    <span class="n">input_artifacts</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span>
                    <span class="n">output_artifact_uris</span><span class="o">=</span><span class="n">output_artifact_uris</span><span class="p">,</span>
                    <span class="n">last_retry</span><span class="o">=</span><span class="n">last_retry</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
            <span class="n">output_utils</span><span class="o">.</span><span class="n">remove_artifact_dirs</span><span class="p">(</span>
                <span class="n">artifact_uris</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">output_artifact_uris</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">` has finished in &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">string_utils</span><span class="o">.</span><span class="n">get_human_readable_time</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">`.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_step_with_step_operator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">step_operator_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">step_run_info</span><span class="p">:</span> <span class="n">StepRunInfo</span><span class="p">,</span>
        <span class="n">last_retry</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs the current step with a step operator.</span>

<span class="sd">        Args:</span>
<span class="sd">            step_operator_name: The name of the step operator to use.</span>
<span class="sd">            step_run_info: Additional information needed to run the step.</span>
<span class="sd">            last_retry: Whether this is the last retry of the step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">step_operator</span> <span class="o">=</span> <span class="n">_get_step_operator</span><span class="p">(</span>
            <span class="n">stack</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">,</span>
            <span class="n">step_operator_name</span><span class="o">=</span><span class="n">step_operator_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">entrypoint_cfg_class</span> <span class="o">=</span> <span class="n">step_operator</span><span class="o">.</span><span class="n">entrypoint_config_class</span>
        <span class="n">entrypoint_command</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">entrypoint_cfg_class</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>
            <span class="o">+</span> <span class="n">entrypoint_cfg_class</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
                <span class="n">step_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="p">,</span>
                <span class="n">deployment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">step_run_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">step_run_id</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">environment</span> <span class="o">=</span> <span class="n">orchestrator_utils</span><span class="o">.</span><span class="n">get_config_environment_vars</span><span class="p">(</span>
            <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span>
            <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">step_run_id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">last_retry</span><span class="p">:</span>
            <span class="n">environment</span><span class="p">[</span><span class="n">ENV_ZENML_IGNORE_FAILURE_HOOK</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Using step operator `</span><span class="si">%s</span><span class="s2">` to run step `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
            <span class="n">step_operator</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">step_operator</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span>
            <span class="n">info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">,</span>
            <span class="n">entrypoint_command</span><span class="o">=</span><span class="n">entrypoint_command</span><span class="p">,</span>
            <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_step_without_step_operator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pipeline_run</span><span class="p">:</span> <span class="n">PipelineRunResponse</span><span class="p">,</span>
        <span class="n">step_run</span><span class="p">:</span> <span class="n">StepRunResponse</span><span class="p">,</span>
        <span class="n">step_run_info</span><span class="p">:</span> <span class="n">StepRunInfo</span><span class="p">,</span>
        <span class="n">input_artifacts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StepRunInputResponse</span><span class="p">],</span>
        <span class="n">output_artifact_uris</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">last_retry</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs the current step without a step operator.</span>

<span class="sd">        Args:</span>
<span class="sd">            pipeline_run: The model of the current pipeline run.</span>
<span class="sd">            step_run: The model of the current step run.</span>
<span class="sd">            step_run_info: Additional information needed to run the step.</span>
<span class="sd">            input_artifacts: The input artifact versions of the current step.</span>
<span class="sd">            output_artifact_uris: The output artifact URIs of the current step.</span>
<span class="sd">            last_retry: Whether this is the last retry of the step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">last_retry</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ENV_ZENML_IGNORE_FAILURE_HOOK</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
        <span class="n">runner</span> <span class="o">=</span> <span class="n">StepRunner</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">)</span>
        <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
            <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span>
            <span class="n">input_artifacts</span><span class="o">=</span><span class="n">input_artifacts</span><span class="p">,</span>
            <span class="n">output_artifact_uris</span><span class="o">=</span><span class="n">output_artifact_uris</span><span class="p">,</span>
            <span class="n">step_run_info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.step_launcher.StepLauncher.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">orchestrator_run_id</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Initializes the launcher.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>step</code></td>
        <td><code>Step</code></td>
        <td><p>The step to launch.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>orchestrator_run_id</code></td>
        <td><code>str</code></td>
        <td><p>The orchestrator pipeline run id.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the deployment has no associated stack.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_launcher.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="n">PipelineDeploymentResponse</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="n">Step</span><span class="p">,</span>
    <span class="n">orchestrator_run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the launcher.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment.</span>
<span class="sd">        step: The step to launch.</span>
<span class="sd">        orchestrator_run_id: The orchestrator pipeline run id.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the deployment has no associated stack.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span> <span class="o">=</span> <span class="n">deployment</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_step</span> <span class="o">=</span> <span class="n">step</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrator_run_id</span> <span class="o">=</span> <span class="n">orchestrator_run_id</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">deployment</span><span class="o">.</span><span class="n">stack</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing stack for deployment </span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">. This is &quot;</span>
            <span class="s2">&quot;probably because the stack was manually deleted.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span> <span class="o">=</span> <span class="n">Stack</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span><span class="n">deployment</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">pipeline_parameter_name</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.step_launcher.StepLauncher.launch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Launches the step.</p>

<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>BaseException</code></td>
        <td><p>If the step failed to launch, run, or publish.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_launcher.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Launches the step.</span>

<span class="sd">    Raises:</span>
<span class="sd">        BaseException: If the step failed to launch, run, or publish.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pipeline_run</span><span class="p">,</span> <span class="n">run_was_created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_or_reuse_run</span><span class="p">()</span>

    <span class="c1"># Enable or disable step logs storage</span>
    <span class="k">if</span> <span class="n">handle_bool_env_var</span><span class="p">(</span><span class="n">ENV_ZENML_DISABLE_STEP_LOGS_STORAGE</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">step_logging_enabled</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">step_logging_enabled</span> <span class="o">=</span> <span class="n">orchestrator_utils</span><span class="o">.</span><span class="n">is_setting_enabled</span><span class="p">(</span>
            <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_step_logs</span><span class="p">,</span>
            <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">enable_step_logs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">logs_context</span> <span class="o">=</span> <span class="n">nullcontext</span><span class="p">()</span>
    <span class="n">logs_model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">step_logging_enabled</span><span class="p">:</span>
        <span class="c1"># Configure the logs</span>
        <span class="n">logs_uri</span> <span class="o">=</span> <span class="n">step_logging</span><span class="o">.</span><span class="n">prepare_logs_uri</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logs_context</span> <span class="o">=</span> <span class="n">step_logging</span><span class="o">.</span><span class="n">StepLogsStorageContext</span><span class="p">(</span>
            <span class="n">logs_uri</span><span class="o">=</span><span class="n">logs_uri</span><span class="p">,</span> <span class="n">artifact_store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span>
        <span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>

        <span class="n">logs_model</span> <span class="o">=</span> <span class="n">LogsRequest</span><span class="p">(</span>
            <span class="n">uri</span><span class="o">=</span><span class="n">logs_uri</span><span class="p">,</span>
            <span class="n">artifact_store_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">logs_context</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">run_was_created</span><span class="p">:</span>
                <span class="n">pipeline_run_metadata</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">get_pipeline_run_metadata</span><span class="p">(</span>
                        <span class="n">run_id</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">publish_utils</span><span class="o">.</span><span class="n">publish_pipeline_run_metadata</span><span class="p">(</span>
                    <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="n">pipeline_run_metadata</span><span class="o">=</span><span class="n">pipeline_run_metadata</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">pipeline_model_version</span><span class="p">,</span> <span class="n">pipeline_run</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">step_run_utils</span><span class="o">.</span><span class="n">prepare_pipeline_run_model_version</span><span class="p">(</span>
                    <span class="n">pipeline_run</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">request_factory</span> <span class="o">=</span> <span class="n">step_run_utils</span><span class="o">.</span><span class="n">StepRunRequestFactory</span><span class="p">(</span>
                <span class="n">deployment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deployment</span><span class="p">,</span>
                <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
                <span class="n">stack</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">step_run_request</span> <span class="o">=</span> <span class="n">request_factory</span><span class="o">.</span><span class="n">create_request</span><span class="p">(</span>
                <span class="n">invocation_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span>
            <span class="p">)</span>
            <span class="n">step_run_request</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="n">logs_model</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">request_factory</span><span class="o">.</span><span class="n">populate_request</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">step_run_request</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed preparing step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span>
                <span class="n">step_run_request</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">FAILED</span>
                <span class="n">step_run_request</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
                <span class="k">raise</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">step_run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">create_run_step</span><span class="p">(</span>
                    <span class="n">step_run_request</span>
                <span class="p">)</span>

                <span class="n">step_model_version</span><span class="p">,</span> <span class="n">step_run</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">step_run_utils</span><span class="o">.</span><span class="n">prepare_step_run_model_version</span><span class="p">(</span>
                        <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">step_run</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">` has started.&quot;</span><span class="p">)</span>
                <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">last_retry</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">max_retries</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span><span class="o">.</span><span class="n">max_retries</span>
                    <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span>
                    <span class="k">else</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="n">delay</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span><span class="o">.</span><span class="n">delay</span>
                    <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span>
                    <span class="k">else</span> <span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">backoff</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span><span class="o">.</span><span class="n">backoff</span>
                    <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry</span>
                    <span class="k">else</span> <span class="mi">1</span>
                <span class="p">)</span>

                <span class="k">while</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
                    <span class="n">last_retry</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">==</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># here pass a forced save_to_file callable to be</span>
                        <span class="c1"># used as a dump function to use before starting</span>
                        <span class="c1"># the external jobs in step operators</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                            <span class="n">logs_context</span><span class="p">,</span>
                            <span class="n">step_logging</span><span class="o">.</span><span class="n">StepLogsStorageContext</span><span class="p">,</span>
                        <span class="p">):</span>
                            <span class="n">force_write_logs</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
                                <span class="n">logs_context</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">,</span>
                                <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>

                            <span class="k">def</span><span class="w"> </span><span class="nf">_bypass</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">return</span> <span class="kc">None</span>

                            <span class="n">force_write_logs</span> <span class="o">=</span> <span class="n">_bypass</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_run_step</span><span class="p">(</span>
                            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
                            <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span>
                            <span class="n">last_retry</span><span class="o">=</span><span class="n">last_retry</span><span class="p">,</span>
                            <span class="n">force_write_logs</span><span class="o">=</span><span class="n">force_write_logs</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
                        <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Failed to run step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">`. Retrying...&quot;</span>
                            <span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Sleeping for </span><span class="si">{</span><span class="n">delay</span><span class="si">}</span><span class="s2"> seconds before retrying.&quot;</span>
                            <span class="p">)</span>
                            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
                            <span class="n">delay</span> <span class="o">*=</span> <span class="n">backoff</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Failed to run step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">` after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> retries. Exiting.&quot;</span>
                            <span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                            <span class="n">publish_utils</span><span class="o">.</span><span class="n">publish_failed_step_run</span><span class="p">(</span>
                                <span class="n">step_run</span><span class="o">.</span><span class="n">id</span>
                            <span class="p">)</span>
                            <span class="k">raise</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Using cached version of step `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">model_version</span> <span class="o">:=</span> <span class="n">step_model_version</span>
                    <span class="ow">or</span> <span class="n">pipeline_model_version</span>
                <span class="p">):</span>
                    <span class="n">step_run_utils</span><span class="o">.</span><span class="n">link_output_artifacts_to_model_version</span><span class="p">(</span>
                        <span class="n">artifacts</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span>
                        <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline run `</span><span class="si">{</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` failed.&quot;</span><span class="p">)</span>
        <span class="n">publish_utils</span><span class="o">.</span><span class="n">publish_failed_pipeline_run</span><span class="p">(</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.step_run_utils" class="doc doc-heading">
        <code>step_run_utils</code>



</h3>

    <div class="doc doc-contents ">

      <p>Utilities for creating step runs.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.step_run_utils.StepRunRequestFactory" class="doc doc-heading">
        <code>
StepRunRequestFactory        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Helper class to create step run requests.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StepRunRequestFactory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class to create step run requests.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">pipeline_run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the object.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The deployment for which to create step run requests.</span>
<span class="sd">            pipeline_run: The pipeline run for which to create step run</span>
<span class="sd">                requests.</span>
<span class="sd">            stack: The stack on which the pipeline run is happening.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span> <span class="o">=</span> <span class="n">deployment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_run</span> <span class="o">=</span> <span class="n">pipeline_run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invocation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepRunRequest</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a step run request.</span>

<span class="sd">        This will only create a request with basic information and will not yet</span>
<span class="sd">        compute information like the cache key and inputs. This is separated</span>
<span class="sd">        into a different method `populate_request(...)` that might raise</span>
<span class="sd">        exceptions while trying to compute this information.</span>

<span class="sd">        Args:</span>
<span class="sd">            invocation_id: The invocation ID for which to create the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The step run request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StepRunRequest</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">invocation_id</span><span class="p">,</span>
            <span class="n">pipeline_run_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">deployment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
            <span class="n">start_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
            <span class="n">user</span><span class="o">=</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">workspace</span><span class="o">=</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_workspace</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">populate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">StepRunRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Populate a step run request with additional information.</span>

<span class="sd">        Args:</span>
<span class="sd">            request: The request to populate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="n">input_artifacts</span><span class="p">,</span> <span class="n">parent_step_ids</span> <span class="o">=</span> <span class="n">input_utils</span><span class="o">.</span><span class="n">resolve_step_inputs</span><span class="p">(</span>
            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_run</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">input_artifact_ids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">input_name</span><span class="p">:</span> <span class="n">artifact</span><span class="o">.</span><span class="n">id</span>
            <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">input_artifacts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">request</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">input_artifact_ids</span>
        <span class="n">request</span><span class="o">.</span><span class="n">parent_step_ids</span> <span class="o">=</span> <span class="n">parent_step_ids</span>

        <span class="n">cache_key</span> <span class="o">=</span> <span class="n">cache_utils</span><span class="o">.</span><span class="n">generate_cache_key</span><span class="p">(</span>
            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
            <span class="n">input_artifact_ids</span><span class="o">=</span><span class="n">input_artifact_ids</span><span class="p">,</span>
            <span class="n">artifact_store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="p">,</span>
            <span class="n">workspace_id</span><span class="o">=</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_workspace</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">cache_key</span> <span class="o">=</span> <span class="n">cache_key</span>

        <span class="p">(</span>
            <span class="n">docstring</span><span class="p">,</span>
            <span class="n">source_code</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_docstring_and_source_code</span><span class="p">(</span><span class="n">invocation_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">request</span><span class="o">.</span><span class="n">docstring</span> <span class="o">=</span> <span class="n">docstring</span>
        <span class="n">request</span><span class="o">.</span><span class="n">source_code</span> <span class="o">=</span> <span class="n">source_code</span>
        <span class="n">request</span><span class="o">.</span><span class="n">code_hash</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">CODE_HASH_PARAMETER_NAME</span>
        <span class="p">)</span>

        <span class="n">cache_enabled</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_setting_enabled</span><span class="p">(</span>
            <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_cache</span><span class="p">,</span>
            <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">enable_cache</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">cache_enabled</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cached_step_run</span> <span class="o">:=</span> <span class="n">cache_utils</span><span class="o">.</span><span class="n">get_cached_step_run</span><span class="p">(</span>
                <span class="n">cache_key</span><span class="o">=</span><span class="n">cache_key</span>
            <span class="p">):</span>
                <span class="n">request</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">input_name</span><span class="p">:</span> <span class="n">artifact</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">cached_step_run</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>

                <span class="n">request</span><span class="o">.</span><span class="n">original_step_run_id</span> <span class="o">=</span> <span class="n">cached_step_run</span><span class="o">.</span><span class="n">id</span>
                <span class="n">request</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">output_name</span><span class="p">:</span> <span class="p">[</span><span class="n">artifact</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">artifacts</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">output_name</span><span class="p">,</span> <span class="n">artifacts</span> <span class="ow">in</span> <span class="n">cached_step_run</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>

                <span class="n">request</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">CACHED</span>
                <span class="n">request</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">start_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_docstring_and_source_code</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">invocation_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the docstring and source code for the step.</span>

<span class="sd">        Args:</span>
<span class="sd">            invocation_id: The step invocation ID for which to get the</span>
<span class="sd">                docstring and source code.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The docstring and source code of the step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">[</span><span class="n">invocation_id</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_docstring_and_source_code_from_step_instance</span><span class="p">(</span>
                <span class="n">step</span><span class="o">=</span><span class="n">step</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Failed to import the step instance, this is most likely because this</span>
        <span class="c1"># code is running on the server as part of a template execution.</span>
        <span class="c1"># We now try to fetch the docstring/source code from a step run of the</span>
        <span class="c1"># deployment that was used to create the template</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_to_get_docstring_and_source_code_from_template</span><span class="p">(</span>
            <span class="n">invocation_id</span><span class="o">=</span><span class="n">invocation_id</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_docstring_and_source_code_from_step_instance</span><span class="p">(</span>
        <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the docstring and source code of a step.</span>

<span class="sd">        Args:</span>
<span class="sd">            step: The step configuration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The docstring and source code of a step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.steps.base_step</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseStep</span>

        <span class="n">step_instance</span> <span class="o">=</span> <span class="n">BaseStep</span><span class="o">.</span><span class="n">load_from_source</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

        <span class="n">docstring</span> <span class="o">=</span> <span class="n">step_instance</span><span class="o">.</span><span class="n">docstring</span>
        <span class="k">if</span> <span class="n">docstring</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">docstring</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TEXT_FIELD_MAX_LENGTH</span><span class="p">:</span>
            <span class="n">docstring</span> <span class="o">=</span> <span class="n">docstring</span><span class="p">[:</span> <span class="p">(</span><span class="n">TEXT_FIELD_MAX_LENGTH</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>

        <span class="n">source_code</span> <span class="o">=</span> <span class="n">step_instance</span><span class="o">.</span><span class="n">source_code</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_code</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TEXT_FIELD_MAX_LENGTH</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="n">source_code</span><span class="p">[:</span> <span class="p">(</span><span class="n">TEXT_FIELD_MAX_LENGTH</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>

        <span class="k">return</span> <span class="n">docstring</span><span class="p">,</span> <span class="n">source_code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_try_to_get_docstring_and_source_code_from_template</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">invocation_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to get the docstring and source code via a potential template.</span>

<span class="sd">        Args:</span>
<span class="sd">            invocation_id: The step invocation ID for which to get the</span>
<span class="sd">                docstring and source code.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The docstring and source code of the step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">template_id</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">template_id</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">get_run_template</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">deployment_id</span> <span class="o">:=</span> <span class="n">template</span><span class="o">.</span><span class="n">source_deployment</span><span class="o">.</span><span class="n">id</span>
                <span class="k">if</span> <span class="n">template</span><span class="o">.</span><span class="n">source_deployment</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="n">steps</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">list_run_steps</span><span class="p">(</span>
                    <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment_id</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">invocation_id</span><span class="p">,</span>
                    <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">hydrate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">step</span><span class="o">.</span><span class="n">docstring</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">source_code</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.step_run_utils.StepRunRequestFactory.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Initialize the object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The deployment for which to create step run requests.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The pipeline run for which to create step run
requests.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack on which the pipeline run is happening.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">pipeline_run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the object.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The deployment for which to create step run requests.</span>
<span class="sd">        pipeline_run: The pipeline run for which to create step run</span>
<span class="sd">            requests.</span>
<span class="sd">        stack: The stack on which the pipeline run is happening.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span> <span class="o">=</span> <span class="n">deployment</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_run</span> <span class="o">=</span> <span class="n">pipeline_run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.step_run_utils.StepRunRequestFactory.create_request" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invocation_id</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Create a step run request.</p>
<p>This will only create a request with basic information and will not yet
compute information like the cache key and inputs. This is separated
into a different method <code>populate_request(...)</code> that might raise
exceptions while trying to compute this information.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>invocation_id</code></td>
        <td><code>str</code></td>
        <td><p>The invocation ID for which to create the request.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>StepRunRequest</code></td>
      <td><p>The step run request.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invocation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepRunRequest</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a step run request.</span>

<span class="sd">    This will only create a request with basic information and will not yet</span>
<span class="sd">    compute information like the cache key and inputs. This is separated</span>
<span class="sd">    into a different method `populate_request(...)` that might raise</span>
<span class="sd">    exceptions while trying to compute this information.</span>

<span class="sd">    Args:</span>
<span class="sd">        invocation_id: The invocation ID for which to create the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The step run request.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">StepRunRequest</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">invocation_id</span><span class="p">,</span>
        <span class="n">pipeline_run_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">deployment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
        <span class="n">start_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
        <span class="n">user</span><span class="o">=</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">workspace</span><span class="o">=</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_workspace</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.step_run_utils.StepRunRequestFactory.populate_request" class="doc doc-heading">
<code class="highlight language-python"><span class="n">populate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Populate a step run request with additional information.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>request</code></td>
        <td><code>StepRunRequest</code></td>
        <td><p>The request to populate.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">populate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">StepRunRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Populate a step run request with additional information.</span>

<span class="sd">    Args:</span>
<span class="sd">        request: The request to populate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="n">input_artifacts</span><span class="p">,</span> <span class="n">parent_step_ids</span> <span class="o">=</span> <span class="n">input_utils</span><span class="o">.</span><span class="n">resolve_step_inputs</span><span class="p">(</span>
        <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
        <span class="n">pipeline_run</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_run</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">input_artifact_ids</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">input_name</span><span class="p">:</span> <span class="n">artifact</span><span class="o">.</span><span class="n">id</span>
        <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">input_artifacts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="n">request</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">input_artifact_ids</span>
    <span class="n">request</span><span class="o">.</span><span class="n">parent_step_ids</span> <span class="o">=</span> <span class="n">parent_step_ids</span>

    <span class="n">cache_key</span> <span class="o">=</span> <span class="n">cache_utils</span><span class="o">.</span><span class="n">generate_cache_key</span><span class="p">(</span>
        <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
        <span class="n">input_artifact_ids</span><span class="o">=</span><span class="n">input_artifact_ids</span><span class="p">,</span>
        <span class="n">artifact_store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="p">,</span>
        <span class="n">workspace_id</span><span class="o">=</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_workspace</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">cache_key</span> <span class="o">=</span> <span class="n">cache_key</span>

    <span class="p">(</span>
        <span class="n">docstring</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_docstring_and_source_code</span><span class="p">(</span><span class="n">invocation_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">request</span><span class="o">.</span><span class="n">docstring</span> <span class="o">=</span> <span class="n">docstring</span>
    <span class="n">request</span><span class="o">.</span><span class="n">source_code</span> <span class="o">=</span> <span class="n">source_code</span>
    <span class="n">request</span><span class="o">.</span><span class="n">code_hash</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">CODE_HASH_PARAMETER_NAME</span>
    <span class="p">)</span>

    <span class="n">cache_enabled</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_setting_enabled</span><span class="p">(</span>
        <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_cache</span><span class="p">,</span>
        <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">enable_cache</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">cache_enabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cached_step_run</span> <span class="o">:=</span> <span class="n">cache_utils</span><span class="o">.</span><span class="n">get_cached_step_run</span><span class="p">(</span>
            <span class="n">cache_key</span><span class="o">=</span><span class="n">cache_key</span>
        <span class="p">):</span>
            <span class="n">request</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">input_name</span><span class="p">:</span> <span class="n">artifact</span><span class="o">.</span><span class="n">id</span>
                <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">cached_step_run</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="n">request</span><span class="o">.</span><span class="n">original_step_run_id</span> <span class="o">=</span> <span class="n">cached_step_run</span><span class="o">.</span><span class="n">id</span>
            <span class="n">request</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">output_name</span><span class="p">:</span> <span class="p">[</span><span class="n">artifact</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">artifacts</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">output_name</span><span class="p">,</span> <span class="n">artifacts</span> <span class="ow">in</span> <span class="n">cached_step_run</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="n">request</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">CACHED</span>
            <span class="n">request</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">start_time</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.create_cached_step_runs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_cached_step_runs</span><span class="p">(</span><span class="n">deployment</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Create all cached step runs for a pipeline run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The deployment of the pipeline run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The pipeline run for which to create the step runs.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack on which the pipeline run is happening.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Set[str]</code></td>
      <td><p>The invocation IDs of the created step runs.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_cached_step_runs</span><span class="p">(</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">pipeline_run</span><span class="p">:</span> <span class="n">PipelineRunResponse</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create all cached step runs for a pipeline run.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The deployment of the pipeline run.</span>
<span class="sd">        pipeline_run: The pipeline run for which to create the step runs.</span>
<span class="sd">        stack: The stack on which the pipeline run is happening.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The invocation IDs of the created step runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cached_invocations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">visited_invocations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">request_factory</span> <span class="o">=</span> <span class="n">StepRunRequestFactory</span><span class="p">(</span>
        <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="n">stack</span>
    <span class="p">)</span>

    <span class="n">pipeline_model_version</span><span class="p">,</span> <span class="n">pipeline_run</span> <span class="o">=</span> <span class="n">prepare_pipeline_run_model_version</span><span class="p">(</span>
        <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span>
    <span class="p">)</span>

    <span class="k">while</span> <span class="p">(</span>
        <span class="n">cache_candidates</span> <span class="o">:=</span> <span class="n">find_cacheable_invocation_candidates</span><span class="p">(</span>
            <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span>
            <span class="n">finished_invocations</span><span class="o">=</span><span class="n">cached_invocations</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># We&#39;ve already checked these invocations and were not able to cache</span>
        <span class="c1"># them -&gt; no need to check them again</span>
        <span class="o">-</span> <span class="n">visited_invocations</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">invocation_id</span> <span class="ow">in</span> <span class="n">cache_candidates</span><span class="p">:</span>
            <span class="n">visited_invocations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">invocation_id</span><span class="p">)</span>

            <span class="c1"># Make sure the request factory has the most up to date pipeline</span>
            <span class="c1"># run to avoid hydration calls</span>
            <span class="n">request_factory</span><span class="o">.</span><span class="n">pipeline_run</span> <span class="o">=</span> <span class="n">pipeline_run</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">step_run_request</span> <span class="o">=</span> <span class="n">request_factory</span><span class="o">.</span><span class="n">create_request</span><span class="p">(</span>
                    <span class="n">invocation_id</span>
                <span class="p">)</span>
                <span class="n">request_factory</span><span class="o">.</span><span class="n">populate_request</span><span class="p">(</span><span class="n">step_run_request</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># We failed to create/populate the step run. This might be due</span>
                <span class="c1"># to some input resolution error, or an error importing the step</span>
                <span class="c1"># source (there might be some missing dependencies). We just</span>
                <span class="c1"># treat the step as not cached and let the orchestrator try</span>
                <span class="c1"># again in a potentially different environment.</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Failed preparing step run `</span><span class="si">%s</span><span class="s2">`: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">invocation_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">step_run_request</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">CACHED</span><span class="p">:</span>
                <span class="c1"># If we&#39;re not able to cache the step run, the orchestrator</span>
                <span class="c1"># will run the step later which will create the step run</span>
                <span class="c1"># -&gt; We don&#39;t need to do anything here</span>
                <span class="k">continue</span>

            <span class="n">step_run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">create_run_step</span><span class="p">(</span><span class="n">step_run_request</span><span class="p">)</span>

            <span class="c1"># Refresh the pipeline run here to make sure we have the latest</span>
            <span class="c1"># state</span>
            <span class="n">pipeline_run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">get_pipeline_run</span><span class="p">(</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">step_model_version</span><span class="p">,</span> <span class="n">step_run</span> <span class="o">=</span> <span class="n">prepare_step_run_model_version</span><span class="p">(</span>
                <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">model_version</span> <span class="o">:=</span> <span class="n">step_model_version</span> <span class="ow">or</span> <span class="n">pipeline_model_version</span><span class="p">:</span>
                <span class="n">link_output_artifacts_to_model_version</span><span class="p">(</span>
                    <span class="n">artifacts</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span>
                    <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using cached version of step `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span> <span class="n">invocation_id</span><span class="p">)</span>
            <span class="n">cached_invocations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">invocation_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cached_invocations</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.find_cacheable_invocation_candidates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_cacheable_invocation_candidates</span><span class="p">(</span><span class="n">deployment</span><span class="p">,</span> <span class="n">finished_invocations</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Find invocations that can potentially be cached.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment containing the invocations.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>finished_invocations</code></td>
        <td><code>Set[str]</code></td>
        <td><p>A set of invocations that are already finished.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Set[str]</code></td>
      <td><p>The set of invocations that can potentially be cached.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_cacheable_invocation_candidates</span><span class="p">(</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">finished_invocations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find invocations that can potentially be cached.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment containing the invocations.</span>
<span class="sd">        finished_invocations: A set of invocations that are already finished.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The set of invocations that can potentially be cached.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">invocations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">invocation_id</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">invocation_id</span> <span class="ow">in</span> <span class="n">finished_invocations</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">cache_enabled</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_setting_enabled</span><span class="p">(</span>
            <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_cache</span><span class="p">,</span>
            <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">enable_cache</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_enabled</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span><span class="p">)</span> <span class="o">-</span> <span class="n">finished_invocations</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">invocations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">invocation_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">invocations</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.get_model_version_created_by_pipeline_run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_model_version_created_by_pipeline_run</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Get a model version that was created by a specific pipeline run.</p>
<p>This function does not refresh the pipeline run, so it will only try to
fetch the model version from existing steps if they're already part of the
response.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>model_name</code></td>
        <td><code>str</code></td>
        <td><p>The model name for which to get the version.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The pipeline run for which to get the version.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.models.v2.core.model_version.ModelVersionResponse]</code></td>
      <td><p>A model version with the given name created by the run, or None if such
a model version does not exist.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_model_version_created_by_pipeline_run</span><span class="p">(</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">:</span> <span class="n">PipelineRunResponse</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelVersionResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a model version that was created by a specific pipeline run.</span>

<span class="sd">    This function does not refresh the pipeline run, so it will only try to</span>
<span class="sd">    fetch the model version from existing steps if they&#39;re already part of the</span>
<span class="sd">    response.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_name: The model name for which to get the version.</span>
<span class="sd">        pipeline_run: The pipeline run for which to get the version.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A model version with the given name created by the run, or None if such</span>
<span class="sd">        a model version does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model</span> <span class="ow">and</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">model_version</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">pipeline_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">model_name</span>
            <span class="ow">and</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">model_version</span>

    <span class="c1"># We fetch a list of hydrated step runs here in order to avoid hydration</span>
    <span class="c1"># calls for each step separately.</span>
    <span class="n">candidate_step_runs</span> <span class="o">=</span> <span class="n">pagination_utils</span><span class="o">.</span><span class="n">depaginate</span><span class="p">(</span>
        <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">list_run_steps</span><span class="p">,</span>
        <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">hydrate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">step_run</span> <span class="ow">in</span> <span class="n">candidate_step_runs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model</span> <span class="ow">and</span> <span class="n">step_run</span><span class="o">.</span><span class="n">model_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">model_name</span>
                <span class="ow">and</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">step_run</span><span class="o">.</span><span class="n">model_version</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.get_or_create_model_version_for_pipeline_run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_or_create_model_version_for_pipeline_run</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">,</span> <span class="n">substitutions</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Get or create a model version as part of a pipeline run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>model</code></td>
        <td><code>Model</code></td>
        <td><p>The model to get or create.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The pipeline run for which the model should be created.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>substitutions</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Substitutions to apply to the model version name.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[zenml.models.v2.core.model_version.ModelVersionResponse, bool]</code></td>
      <td><p>The model version and a boolean indicating whether it was newly created
or not.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_or_create_model_version_for_pipeline_run</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="s2">&quot;Model&quot;</span><span class="p">,</span>
    <span class="n">pipeline_run</span><span class="p">:</span> <span class="n">PipelineRunResponse</span><span class="p">,</span>
    <span class="n">substitutions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ModelVersionResponse</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get or create a model version as part of a pipeline run.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: The model to get or create.</span>
<span class="sd">        pipeline_run: The pipeline run for which the model should be created.</span>
<span class="sd">        substitutions: Substitutions to apply to the model version name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The model version and a boolean indicating whether it was newly created</span>
<span class="sd">        or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Copy the model before modifying it so we don&#39;t accidently modify</span>
    <span class="c1"># configurations in which the model object is potentially referenced</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">model_version_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">_get_model_version</span><span class="p">(),</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">model</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">string_utils</span><span class="o">.</span><span class="n">format_name_template</span><span class="p">(</span>
                <span class="n">model</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                <span class="n">substitutions</span><span class="o">=</span><span class="n">substitutions</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">string_utils</span><span class="o">.</span><span class="n">format_name_template</span><span class="p">(</span>
            <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">substitutions</span><span class="o">=</span><span class="n">substitutions</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">model</span><span class="o">.</span><span class="n">_get_or_create_model_version</span><span class="p">(),</span>
            <span class="n">model</span><span class="o">.</span><span class="n">_created_model_version</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># The model version should be created as part of this run</span>
    <span class="c1"># -&gt; We first check if it was already created as part of this run, and if</span>
    <span class="c1"># not we do create it. If this is running in two parallel steps, we might</span>
    <span class="c1"># run into issues that this will create two versions. Ideally, all model</span>
    <span class="c1"># versions required for a pipeline run and its steps could be created</span>
    <span class="c1"># server-side at run creation time before the first step starts.</span>
    <span class="k">if</span> <span class="n">model_version</span> <span class="o">:=</span> <span class="n">get_model_version_created_by_pipeline_run</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">model_version</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">_get_or_create_model_version</span><span class="p">(),</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.link_output_artifacts_to_model_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">link_output_artifacts_to_model_version</span><span class="p">(</span><span class="n">artifacts</span><span class="p">,</span> <span class="n">model_version</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Link the outputs of a step run to a model version.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>artifacts</code></td>
        <td><code>Dict[str, List[zenml.models.v2.core.artifact_version.ArtifactVersionResponse]]</code></td>
        <td><p>The step output artifacts.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>model_version</code></td>
        <td><code>ModelVersionResponse</code></td>
        <td><p>The model version to link.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">link_output_artifacts_to_model_version</span><span class="p">(</span>
    <span class="n">artifacts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ArtifactVersionResponse</span><span class="p">]],</span>
    <span class="n">model_version</span><span class="p">:</span> <span class="n">ModelVersionResponse</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Link the outputs of a step run to a model version.</span>

<span class="sd">    Args:</span>
<span class="sd">        artifacts: The step output artifacts.</span>
<span class="sd">        model_version: The model version to link.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">output_artifacts</span> <span class="ow">in</span> <span class="n">artifacts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">output_artifact</span> <span class="ow">in</span> <span class="n">output_artifacts</span><span class="p">:</span>
            <span class="n">link_artifact_version_to_model_version</span><span class="p">(</span>
                <span class="n">artifact_version</span><span class="o">=</span><span class="n">output_artifact</span><span class="p">,</span>
                <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.link_pipeline_run_to_model_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">link_pipeline_run_to_model_version</span><span class="p">(</span><span class="n">pipeline_run</span><span class="p">,</span> <span class="n">model_version</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Link a pipeline run to a model version.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The pipeline run to link.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>model_version</code></td>
        <td><code>ModelVersionResponse</code></td>
        <td><p>The model version to link.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">link_pipeline_run_to_model_version</span><span class="p">(</span>
    <span class="n">pipeline_run</span><span class="p">:</span> <span class="n">PipelineRunResponse</span><span class="p">,</span> <span class="n">model_version</span><span class="p">:</span> <span class="n">ModelVersionResponse</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Link a pipeline run to a model version.</span>

<span class="sd">    Args:</span>
<span class="sd">        pipeline_run: The pipeline run to link.</span>
<span class="sd">        model_version: The model version to link.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">create_model_version_pipeline_run_link</span><span class="p">(</span>
        <span class="n">ModelVersionPipelineRunRequest</span><span class="p">(</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.log_model_version_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_model_version_dashboard_url</span><span class="p">(</span><span class="n">model_version</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Log the dashboard URL for a model version.</p>
<p>If the current server is not a ZenML Pro tenant, a fallback message is
logged instead.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>model_version</code></td>
        <td><code>ModelVersionResponse</code></td>
        <td><p>The model version for which to log the dashboard URL.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">log_model_version_dashboard_url</span><span class="p">(</span>
    <span class="n">model_version</span><span class="p">:</span> <span class="n">ModelVersionResponse</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the dashboard URL for a model version.</span>

<span class="sd">    If the current server is not a ZenML Pro tenant, a fallback message is</span>
<span class="sd">    logged instead.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_version: The model version for which to log the dashboard URL.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.utils.dashboard_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_model_version_url</span>

    <span class="k">if</span> <span class="n">model_version_url</span> <span class="o">:=</span> <span class="n">get_model_version_url</span><span class="p">(</span><span class="n">model_version</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Dashboard URL for Model Version `</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)`:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">model_version</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">model_version</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">model_version_url</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Models can be viewed in the dashboard using ZenML Pro. Sign up &quot;</span>
            <span class="s2">&quot;for a free trial at https://www.zenml.io/pro/&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.prepare_pipeline_run_model_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_pipeline_run_model_version</span><span class="p">(</span><span class="n">pipeline_run</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Prepare the model version for a pipeline run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The pipeline run for which to prepare the model version.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[Optional[zenml.models.v2.core.model_version.ModelVersionResponse], zenml.models.v2.core.pipeline_run.PipelineRunResponse]</code></td>
      <td><p>The prepared model version and the updated pipeline run.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_pipeline_run_model_version</span><span class="p">(</span>
    <span class="n">pipeline_run</span><span class="p">:</span> <span class="n">PipelineRunResponse</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ModelVersionResponse</span><span class="p">],</span> <span class="n">PipelineRunResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare the model version for a pipeline run.</span>

<span class="sd">    Args:</span>
<span class="sd">        pipeline_run: The pipeline run for which to prepare the model version.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The prepared model version and the updated pipeline run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_version</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">model_version</span><span class="p">:</span>
        <span class="n">model_version</span> <span class="o">=</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">model_version</span>
    <span class="k">elif</span> <span class="n">config_model</span> <span class="o">:=</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
        <span class="n">model_version</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_or_create_model_version_for_pipeline_run</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">config_model</span><span class="p">,</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
            <span class="n">substitutions</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">substitutions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">update_run</span><span class="p">(</span>
            <span class="n">run_id</span><span class="o">=</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">run_update</span><span class="o">=</span><span class="n">PipelineRunUpdate</span><span class="p">(</span><span class="n">model_version_id</span><span class="o">=</span><span class="n">model_version</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">link_pipeline_run_to_model_version</span><span class="p">(</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span> <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span>
        <span class="p">)</span>
        <span class="n">log_model_version_dashboard_url</span><span class="p">(</span><span class="n">model_version</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model_version</span><span class="p">,</span> <span class="n">pipeline_run</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.step_run_utils.prepare_step_run_model_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_step_run_model_version</span><span class="p">(</span><span class="n">step_run</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Prepare the model version for a step run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step_run</code></td>
        <td><code>StepRunResponse</code></td>
        <td><p>The step run for which to prepare the model version.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The pipeline run of the step.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[Optional[zenml.models.v2.core.model_version.ModelVersionResponse], zenml.models.v2.core.step_run.StepRunResponse]</code></td>
      <td><p>The prepared model version and the updated step run.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_run_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_step_run_model_version</span><span class="p">(</span>
    <span class="n">step_run</span><span class="p">:</span> <span class="n">StepRunResponse</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">:</span> <span class="n">PipelineRunResponse</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ModelVersionResponse</span><span class="p">],</span> <span class="n">StepRunResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare the model version for a step run.</span>

<span class="sd">    Args:</span>
<span class="sd">        step_run: The step run for which to prepare the model version.</span>
<span class="sd">        pipeline_run: The pipeline run of the step.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The prepared model version and the updated step run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_version</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">model_version</span><span class="p">:</span>
        <span class="n">model_version</span> <span class="o">=</span> <span class="n">step_run</span><span class="o">.</span><span class="n">model_version</span>
    <span class="k">elif</span> <span class="n">config_model</span> <span class="o">:=</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
        <span class="n">model_version</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">get_or_create_model_version_for_pipeline_run</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">config_model</span><span class="p">,</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
            <span class="n">substitutions</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">substitutions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">step_run</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">update_run_step</span><span class="p">(</span>
            <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">step_run_update</span><span class="o">=</span><span class="n">StepRunUpdate</span><span class="p">(</span><span class="n">model_version_id</span><span class="o">=</span><span class="n">model_version</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">link_pipeline_run_to_model_version</span><span class="p">(</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span> <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">created</span><span class="p">:</span>
            <span class="n">log_model_version_dashboard_url</span><span class="p">(</span><span class="n">model_version</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model_version</span><span class="p">,</span> <span class="n">step_run</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.step_runner" class="doc doc-heading">
        <code>step_runner</code>



</h3>

    <div class="doc doc-contents ">

      <p>Class to run steps.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.step_runner.StepRunner" class="doc doc-heading">
        <code>
StepRunner        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Class to run steps.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StepRunner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to run steps.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the step runner.</span>

<span class="sd">        Args:</span>
<span class="sd">            step: The step to run.</span>
<span class="sd">            stack: The stack on which the step should run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span> <span class="o">=</span> <span class="n">stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration of the step to run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The step configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pipeline_run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">,</span>
        <span class="n">step_run</span><span class="p">:</span> <span class="s2">&quot;StepRunResponse&quot;</span><span class="p">,</span>
        <span class="n">input_artifacts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StepRunInputResponse</span><span class="p">],</span>
        <span class="n">output_artifact_uris</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">step_run_info</span><span class="p">:</span> <span class="n">StepRunInfo</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs the step.</span>

<span class="sd">        Args:</span>
<span class="sd">            pipeline_run: The model of the current pipeline run.</span>
<span class="sd">            step_run: The model of the current step run.</span>
<span class="sd">            input_artifacts: The input artifact versions of the step.</span>
<span class="sd">            output_artifact_uris: The URIs of the output artifacts of the step.</span>
<span class="sd">            step_run_info: The step run info.</span>

<span class="sd">        Raises:</span>
<span class="sd">            BaseException: A general exception if the step fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">handle_bool_env_var</span><span class="p">(</span><span class="n">ENV_ZENML_DISABLE_STEP_LOGS_STORAGE</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">step_logging_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">enabled_on_step</span> <span class="o">=</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_step_logs</span>
            <span class="n">enabled_on_pipeline</span> <span class="o">=</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_step_logs</span>

            <span class="n">step_logging_enabled</span> <span class="o">=</span> <span class="n">is_setting_enabled</span><span class="p">(</span>
                <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">enabled_on_step</span><span class="p">,</span>
                <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="n">enabled_on_pipeline</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">logs_context</span> <span class="o">=</span> <span class="n">nullcontext</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">step_logging_enabled</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">redirected</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">logs</span><span class="p">:</span>
                <span class="n">logs_context</span> <span class="o">=</span> <span class="n">StepLogsStorageContext</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
                    <span class="n">logs_uri</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span>
                    <span class="n">artifact_store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;There is no LogsResponseModel prepared for the step. The&quot;</span>
                    <span class="s2">&quot;step logging storage is disabled.&quot;</span>
                <span class="p">)</span>

        <span class="k">with</span> <span class="n">logs_context</span><span class="p">:</span>
            <span class="n">step_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_step</span><span class="p">()</span>
            <span class="n">output_materializers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_output_materializers</span><span class="p">()</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span>
                <span class="n">inspect</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">step_instance</span><span class="o">.</span><span class="n">entrypoint</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">output_annotations</span> <span class="o">=</span> <span class="n">parse_return_type_annotations</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">step_instance</span><span class="o">.</span><span class="n">entrypoint</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_artifact_names_in_collections</span><span class="p">(</span>
                <span class="n">step_run</span><span class="p">,</span>
                <span class="n">output_annotations</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="n">output_artifact_uris</span><span class="p">,</span>
                    <span class="n">output_materializers</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">prepare_step_run</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">)</span>

            <span class="c1"># Initialize the step context singleton</span>
            <span class="n">StepContext</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>
            <span class="n">step_context</span> <span class="o">=</span> <span class="n">StepContext</span><span class="p">(</span>
                <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
                <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span>
                <span class="n">output_materializers</span><span class="o">=</span><span class="n">output_materializers</span><span class="p">,</span>
                <span class="n">output_artifact_uris</span><span class="o">=</span><span class="n">output_artifact_uris</span><span class="p">,</span>
                <span class="n">output_artifact_configs</span><span class="o">=</span><span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">artifact_config</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output_annotations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="c1"># Parse the inputs for the entrypoint function.</span>
            <span class="n">function_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_inputs</span><span class="p">(</span>
                <span class="n">args</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
                <span class="n">annotations</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">annotations</span><span class="p">,</span>
                <span class="n">input_artifacts</span><span class="o">=</span><span class="n">input_artifacts</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">step_failed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">return_values</span> <span class="o">=</span> <span class="n">step_instance</span><span class="o">.</span><span class="n">call_entrypoint</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">function_params</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">step_exception</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
                <span class="n">step_failed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">handle_bool_env_var</span><span class="p">(</span>
                    <span class="n">ENV_ZENML_IGNORE_FAILURE_HOOK</span><span class="p">,</span> <span class="kc">False</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">failure_hook_source</span>
                        <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">failure_hook_source</span>
                    <span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detected failure hook. Running...&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">load_and_run_hook</span><span class="p">(</span>
                            <span class="n">failure_hook_source</span><span class="p">,</span>
                            <span class="n">step_exception</span><span class="o">=</span><span class="n">step_exception</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">raise</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">step_run_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">get_step_run_metadata</span><span class="p">(</span>
                        <span class="n">info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">publish_step_run_metadata</span><span class="p">(</span>
                        <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">step_run_id</span><span class="p">,</span>
                        <span class="n">step_run_metadata</span><span class="o">=</span><span class="n">step_run_metadata</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">cleanup_step_run</span><span class="p">(</span>
                        <span class="n">info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">,</span> <span class="n">step_failed</span><span class="o">=</span><span class="n">step_failed</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">step_failed</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">success_hook_source</span>
                            <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">success_hook_source</span>
                        <span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detected success hook. Running...&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">load_and_run_hook</span><span class="p">(</span>
                                <span class="n">success_hook_source</span><span class="p">,</span>
                                <span class="n">step_exception</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="p">)</span>

                        <span class="c1"># Store and publish the output artifacts of the step function.</span>
                        <span class="n">output_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_outputs</span><span class="p">(</span>
                            <span class="n">return_values</span><span class="p">,</span> <span class="n">output_annotations</span>
                        <span class="p">)</span>
                        <span class="n">artifact_metadata_enabled</span> <span class="o">=</span> <span class="n">is_setting_enabled</span><span class="p">(</span>
                            <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_artifact_metadata</span><span class="p">,</span>
                            <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">enable_artifact_metadata</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">artifact_visualization_enabled</span> <span class="o">=</span> <span class="n">is_setting_enabled</span><span class="p">(</span>
                            <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_artifact_visualization</span><span class="p">,</span>
                            <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">enable_artifact_visualization</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">output_artifacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store_output_artifacts</span><span class="p">(</span>
                            <span class="n">output_data</span><span class="o">=</span><span class="n">output_data</span><span class="p">,</span>
                            <span class="n">output_artifact_uris</span><span class="o">=</span><span class="n">output_artifact_uris</span><span class="p">,</span>
                            <span class="n">output_materializers</span><span class="o">=</span><span class="n">output_materializers</span><span class="p">,</span>
                            <span class="n">output_annotations</span><span class="o">=</span><span class="n">output_annotations</span><span class="p">,</span>
                            <span class="n">artifact_metadata_enabled</span><span class="o">=</span><span class="n">artifact_metadata_enabled</span><span class="p">,</span>
                            <span class="n">artifact_visualization_enabled</span><span class="o">=</span><span class="n">artifact_visualization_enabled</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">model_version</span> <span class="o">:=</span> <span class="n">step_run</span><span class="o">.</span><span class="n">model_version</span>
                            <span class="ow">or</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">model_version</span>
                        <span class="p">):</span>
                            <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.orchestrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">step_run_utils</span>

                            <span class="n">step_run_utils</span><span class="o">.</span><span class="n">link_output_artifacts_to_model_version</span><span class="p">(</span>
                                <span class="n">artifacts</span><span class="o">=</span><span class="p">{</span>
                                    <span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output_artifacts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                <span class="p">},</span>
                                <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span><span class="p">,</span>
                            <span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">step_context</span><span class="o">.</span><span class="n">_cleanup_registry</span><span class="o">.</span><span class="n">execute_callbacks</span><span class="p">(</span>
                        <span class="n">raise_on_exception</span><span class="o">=</span><span class="kc">False</span>
                    <span class="p">)</span>
                    <span class="n">StepContext</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>  <span class="c1"># Remove the step context singleton</span>

            <span class="c1"># Update the status and output artifacts of the step run.</span>
            <span class="n">output_artifact_ids</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">output_name</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">artifact</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">output_name</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">output_artifacts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">publish_successful_step_run</span><span class="p">(</span>
                <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">step_run_id</span><span class="p">,</span>
                <span class="n">output_artifact_ids</span><span class="o">=</span><span class="n">output_artifact_ids</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_artifact_names_in_collections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">step_run</span><span class="p">:</span> <span class="s2">&quot;StepRunResponse&quot;</span><span class="p">,</span>
        <span class="n">output_annotations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OutputSignature</span><span class="p">],</span>
        <span class="n">collections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluates the artifact names in the collections.</span>

<span class="sd">        Args:</span>
<span class="sd">            step_run: The step run.</span>
<span class="sd">            output_annotations: The output annotations of the step function</span>
<span class="sd">                (also evaluated).</span>
<span class="sd">            collections: The collections to evaluate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">collections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_annotations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">output_annotations</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">k</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">artifact_config</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">artifact_config</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">string_utils</span><span class="o">.</span><span class="n">format_name_template</span><span class="p">(</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">artifact_config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">substitutions</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">substitutions</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BaseStep&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the step instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The step instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.steps</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseStep</span>

        <span class="n">step_instance</span> <span class="o">=</span> <span class="n">BaseStep</span><span class="o">.</span><span class="n">load_from_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="n">step_instance</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">step_instance</span><span class="p">)</span>
        <span class="n">step_instance</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span>
        <span class="k">return</span> <span class="n">step_instance</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_output_materializers</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseMaterializer</span><span class="p">],</span> <span class="o">...</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads the output materializers for the step.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The step output materializers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">materializers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">output_materializers</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">materializer_source</span><span class="p">:</span>
                <span class="n">materializer_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseMaterializer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">source_utils</span><span class="o">.</span><span class="n">load_and_validate_class</span><span class="p">(</span>
                        <span class="n">source</span><span class="p">,</span> <span class="n">expected_class</span><span class="o">=</span><span class="n">BaseMaterializer</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">output_materializers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">materializer_class</span><span class="p">)</span>

            <span class="n">materializers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">output_materializers</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">materializers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_inputs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">annotations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">input_artifacts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StepRunInputResponse</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the inputs for a step entrypoint function.</span>

<span class="sd">        Args:</span>
<span class="sd">            args: The arguments of the step entrypoint function.</span>
<span class="sd">            annotations: The annotations of the step entrypoint function.</span>
<span class="sd">            input_artifacts: The input artifact versions of the step.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The parsed inputs for the step entrypoint function.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If a function argument value is missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">function_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;self&quot;</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">arg_type</span> <span class="o">=</span> <span class="n">annotations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">arg_type</span> <span class="o">=</span> <span class="n">resolve_type_annotation</span><span class="p">(</span><span class="n">arg_type</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">input_artifacts</span><span class="p">:</span>
                <span class="n">function_params</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_input_artifact</span><span class="p">(</span>
                    <span class="n">input_artifacts</span><span class="p">[</span><span class="n">arg</span><span class="p">],</span> <span class="n">arg_type</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">function_params</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unable to find value for step function argument `</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">function_params</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_hook_inputs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">annotations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">step_exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the inputs for a hook function.</span>

<span class="sd">        Args:</span>
<span class="sd">            args: The arguments of the hook function.</span>
<span class="sd">            annotations: The annotations of the hook function.</span>
<span class="sd">            step_exception: The exception of the original step.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The parsed inputs for the hook function.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If hook function is passed a wrong parameter type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">function_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;self&quot;</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">arg_type</span> <span class="o">=</span> <span class="n">annotations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">arg_type</span> <span class="o">=</span> <span class="n">resolve_type_annotation</span><span class="p">(</span><span class="n">arg_type</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">arg_type</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">):</span>
                <span class="n">function_params</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_exception</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># It should not be of any other type</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Hook functions can only take arguments of type &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`BaseException`, not </span><span class="si">{</span><span class="n">arg_type</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">function_params</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_input_artifact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">artifact</span><span class="p">:</span> <span class="s2">&quot;ArtifactVersionResponse&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads an input artifact.</span>

<span class="sd">        Args:</span>
<span class="sd">            artifact: The artifact to load.</span>
<span class="sd">            data_type: The data type of the artifact value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The artifact value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Skip materialization for `UnmaterializedArtifact`.</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">UnmaterializedArtifact</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">UnmaterializedArtifact</span><span class="p">(</span>
                <span class="o">**</span><span class="n">artifact</span><span class="o">.</span><span class="n">get_hydrated_version</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">Any</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_union</span><span class="p">(</span><span class="n">get_origin</span><span class="p">(</span><span class="n">data_type</span><span class="p">)):</span>
            <span class="c1"># Entrypoint function does not define a specific type for the input,</span>
            <span class="c1"># we use the datatype of the stored artifact</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">source_utils</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">artifact</span><span class="o">.</span><span class="n">data_type</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.orchestrators.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">register_artifact_store_filesystem</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">materializer_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseMaterializer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">source_utils</span><span class="o">.</span><span class="n">load_and_validate_class</span><span class="p">(</span>
                <span class="n">artifact</span><span class="o">.</span><span class="n">materializer</span><span class="p">,</span> <span class="n">expected_class</span><span class="o">=</span><span class="n">BaseMaterializer</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_load_artifact</span><span class="p">(</span><span class="n">artifact_store</span><span class="p">:</span> <span class="s2">&quot;BaseArtifactStore&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
            <span class="n">materializer</span><span class="p">:</span> <span class="n">BaseMaterializer</span> <span class="o">=</span> <span class="n">materializer_class</span><span class="p">(</span>
                <span class="n">uri</span><span class="o">=</span><span class="n">artifact</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span> <span class="n">artifact_store</span><span class="o">=</span><span class="n">artifact_store</span>
            <span class="p">)</span>
            <span class="n">materializer</span><span class="o">.</span><span class="n">validate_load_type_compatibility</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">materializer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">artifact</span><span class="o">.</span><span class="n">artifact_store_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="c1"># Register the artifact store of the active stack here to avoid</span>
            <span class="c1"># unnecessary component/flavor calls when using</span>
            <span class="c1"># `register_artifact_store_filesystem(...)`</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">_register</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">_load_artifact</span><span class="p">(</span><span class="n">artifact_store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">register_artifact_store_filesystem</span><span class="p">(</span>
                <span class="n">artifact</span><span class="o">.</span><span class="n">artifact_store_id</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">target_artifact_store</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_load_artifact</span><span class="p">(</span><span class="n">artifact_store</span><span class="o">=</span><span class="n">target_artifact_store</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_outputs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">return_values</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">output_annotations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OutputSignature</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the step function outputs.</span>

<span class="sd">        Args:</span>
<span class="sd">            return_values: The return values of the step function.</span>
<span class="sd">            output_annotations: The output annotations of the step function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated output, mapping output names to return values.</span>

<span class="sd">        Raises:</span>
<span class="sd">            StepInterfaceError: If the step function return values do not</span>
<span class="sd">                match the output annotations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">step_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">pipeline_parameter_name</span>

        <span class="c1"># if there are no outputs, the return value must be `None`.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_annotations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">StepInterfaceError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Wrong step function output type for step `</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">`: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected no outputs but the function returned something: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">return_values</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># if there is only one output annotation (either directly specified</span>
        <span class="c1"># or contained in an `Output` tuple) we treat the step function</span>
        <span class="c1"># return value as the return for that output.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_annotations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">return_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">return_values</span><span class="p">]</span>

        <span class="c1"># if the user defined multiple outputs, the return value must be a list</span>
        <span class="c1"># or tuple.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">return_values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">StepInterfaceError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Wrong step function output type for step `</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">`: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Expected multiple outputs (</span><span class="si">{</span><span class="n">output_annotations</span><span class="si">}</span><span class="s2">) but &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the function did not return a list or tuple &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(actual return value: </span><span class="si">{</span><span class="n">return_values</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="c1"># The amount of actual outputs must be the same as the amount of</span>
        <span class="c1"># expected outputs.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_annotations</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">return_values</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">StepInterfaceError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Wrong amount of step function outputs for step &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">: Expected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">output_annotations</span><span class="p">)</span><span class="si">}</span><span class="s2"> outputs &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;but the function returned </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">return_values</span><span class="p">)</span><span class="si">}</span><span class="s2"> outputs&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(return values: </span><span class="si">{</span><span class="n">return_values</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.steps.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_args</span>

        <span class="n">validated_outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">return_value</span><span class="p">,</span> <span class="p">(</span><span class="n">output_name</span><span class="p">,</span> <span class="n">output_annotation</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">return_values</span><span class="p">,</span> <span class="n">output_annotations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">output_type</span> <span class="o">=</span> <span class="n">output_annotation</span><span class="o">.</span><span class="n">resolved_annotation</span>
            <span class="k">if</span> <span class="n">output_type</span> <span class="ow">is</span> <span class="n">Any</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_union</span><span class="p">(</span><span class="n">get_origin</span><span class="p">(</span><span class="n">output_type</span><span class="p">)):</span>
                    <span class="n">output_type</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">output_type</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">return_value</span><span class="p">,</span> <span class="n">output_type</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">StepInterfaceError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Wrong type for output &#39;</span><span class="si">{</span><span class="n">output_name</span><span class="si">}</span><span class="s2">&#39; of step &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; (expected type: </span><span class="si">{</span><span class="n">output_type</span><span class="si">}</span><span class="s2">, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;actual type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">return_value</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                    <span class="p">)</span>
            <span class="n">validated_outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">return_value</span>
        <span class="k">return</span> <span class="n">validated_outputs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_store_output_artifacts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">output_materializers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseMaterializer</span><span class="p">],</span> <span class="o">...</span><span class="p">]],</span>
        <span class="n">output_artifact_uris</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">output_annotations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OutputSignature</span><span class="p">],</span>
        <span class="n">artifact_metadata_enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">artifact_visualization_enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;ArtifactVersionResponse&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores the output artifacts of the step.</span>

<span class="sd">        Args:</span>
<span class="sd">            output_data: The output data of the step function, mapping output</span>
<span class="sd">                names to return values.</span>
<span class="sd">            output_materializers: The output materializers of the step.</span>
<span class="sd">            output_artifact_uris: The output artifact URIs of the step.</span>
<span class="sd">            output_annotations: The output annotations of the step function.</span>
<span class="sd">            artifact_metadata_enabled: Whether artifact metadata collection is</span>
<span class="sd">                enabled.</span>
<span class="sd">            artifact_visualization_enabled: Whether artifact visualization is</span>
<span class="sd">                enabled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The IDs of the published output artifacts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">step_context</span> <span class="o">=</span> <span class="n">get_step_context</span><span class="p">()</span>
        <span class="n">artifact_requests</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">output_name</span><span class="p">,</span> <span class="n">return_value</span> <span class="ow">in</span> <span class="n">output_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">return_value</span><span class="p">)</span>
            <span class="n">materializer_classes</span> <span class="o">=</span> <span class="n">output_materializers</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">materializer_classes</span><span class="p">:</span>
                <span class="n">materializer_class</span> <span class="o">=</span> <span class="n">materializer_utils</span><span class="o">.</span><span class="n">select_materializer</span><span class="p">(</span>
                    <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                    <span class="n">materializer_classes</span><span class="o">=</span><span class="n">materializer_classes</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If no materializer classes are stored in the IR, that means</span>
                <span class="c1"># there was no/an `Any` type annotation for the output and</span>
                <span class="c1"># we try to find a materializer for it at runtime</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.materializers.materializer_registry</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
                    <span class="n">materializer_registry</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">default_materializer_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span>
                    <span class="n">output_name</span>
                <span class="p">]</span><span class="o">.</span><span class="n">default_materializer_source</span>

                <span class="k">if</span> <span class="n">default_materializer_source</span><span class="p">:</span>
                    <span class="n">default_materializer_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseMaterializer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">source_utils</span><span class="o">.</span><span class="n">load_and_validate_class</span><span class="p">(</span>
                            <span class="n">default_materializer_source</span><span class="p">,</span>
                            <span class="n">expected_class</span><span class="o">=</span><span class="n">BaseMaterializer</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">materializer_registry</span><span class="o">.</span><span class="n">default_materializer</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">default_materializer_class</span>
                    <span class="p">)</span>

                <span class="n">materializer_class</span> <span class="o">=</span> <span class="n">materializer_registry</span><span class="p">[</span><span class="n">data_type</span><span class="p">]</span>

            <span class="n">uri</span> <span class="o">=</span> <span class="n">output_artifact_uris</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
            <span class="n">artifact_config</span> <span class="o">=</span> <span class="n">output_annotations</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">artifact_config</span>

            <span class="n">artifact_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">artifact_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">has_custom_name</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">artifact_config</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">artifact_config</span><span class="o">.</span><span class="n">version</span>
                <span class="n">artifact_type</span> <span class="o">=</span> <span class="n">artifact_config</span><span class="o">.</span><span class="n">artifact_type</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">has_custom_name</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

            <span class="c1"># Override the artifact name if it is not a custom name.</span>
            <span class="k">if</span> <span class="n">has_custom_name</span><span class="p">:</span>
                <span class="n">artifact_name</span> <span class="o">=</span> <span class="n">output_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">step_context</span><span class="o">.</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">pipeline</span><span class="p">:</span>
                    <span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">step_context</span><span class="o">.</span><span class="n">pipeline_run</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pipeline_name</span> <span class="o">=</span> <span class="s2">&quot;unlisted&quot;</span>
                <span class="n">step_name</span> <span class="o">=</span> <span class="n">step_context</span><span class="o">.</span><span class="n">step_run</span><span class="o">.</span><span class="n">name</span>
                <span class="n">artifact_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pipeline_name</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">output_name</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Get metadata that the user logged manually</span>
            <span class="n">user_metadata</span> <span class="o">=</span> <span class="n">step_context</span><span class="o">.</span><span class="n">get_output_metadata</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>

            <span class="c1"># Get full set of tags</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="n">step_context</span><span class="o">.</span><span class="n">get_output_tags</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>

            <span class="n">artifact_request</span> <span class="o">=</span> <span class="n">_store_artifact_data_and_prepare_request</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">artifact_name</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">return_value</span><span class="p">,</span>
                <span class="n">materializer_class</span><span class="o">=</span><span class="n">materializer_class</span><span class="p">,</span>
                <span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
                <span class="n">artifact_type</span><span class="o">=</span><span class="n">artifact_type</span><span class="p">,</span>
                <span class="n">store_metadata</span><span class="o">=</span><span class="n">artifact_metadata_enabled</span><span class="p">,</span>
                <span class="n">store_visualizations</span><span class="o">=</span><span class="n">artifact_visualization_enabled</span><span class="p">,</span>
                <span class="n">has_custom_name</span><span class="o">=</span><span class="n">has_custom_name</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
                <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
                <span class="n">save_type</span><span class="o">=</span><span class="n">ArtifactSaveType</span><span class="o">.</span><span class="n">STEP_OUTPUT</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">user_metadata</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">artifact_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artifact_request</span><span class="p">)</span>

        <span class="n">responses</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">batch_create_artifact_versions</span><span class="p">(</span>
            <span class="n">artifact_requests</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">output_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">responses</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_and_run_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hook_source</span><span class="p">:</span> <span class="s2">&quot;Source&quot;</span><span class="p">,</span>
        <span class="n">step_exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads hook source and runs the hook.</span>

<span class="sd">        Args:</span>
<span class="sd">            hook_source: The source of the hook function.</span>
<span class="sd">            step_exception: The exception of the original step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">hook</span> <span class="o">=</span> <span class="n">source_utils</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hook_source</span><span class="p">)</span>
            <span class="n">hook_spec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>

            <span class="n">function_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_hook_inputs</span><span class="p">(</span>
                <span class="n">args</span><span class="o">=</span><span class="n">hook_spec</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
                <span class="n">annotations</span><span class="o">=</span><span class="n">hook_spec</span><span class="o">.</span><span class="n">annotations</span><span class="p">,</span>
                <span class="n">step_exception</span><span class="o">=</span><span class="n">step_exception</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running hook </span><span class="si">{</span><span class="n">hook</span><span class="si">}</span><span class="s2"> with params: </span><span class="si">{</span><span class="n">function_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">hook</span><span class="p">(</span><span class="o">**</span><span class="n">function_params</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to load hook source with exception: &#39;</span><span class="si">{</span><span class="n">hook_source</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="zenml.orchestrators.step_runner.StepRunner.configuration" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configuration</span><span class="p">:</span> <span class="n">StepConfiguration</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Configuration of the step to run.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>StepConfiguration</code></td>
      <td><p>The step configuration.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.step_runner.StepRunner.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Initializes the step runner.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>step</code></td>
        <td><code>Step</code></td>
        <td><p>The step to run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack on which the step should run.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the step runner.</span>

<span class="sd">    Args:</span>
<span class="sd">        step: The step to run.</span>
<span class="sd">        stack: The stack on which the step should run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_step</span> <span class="o">=</span> <span class="n">step</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span> <span class="o">=</span> <span class="n">stack</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.step_runner.StepRunner.load_and_run_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_and_run_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook_source</span><span class="p">,</span> <span class="n">step_exception</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Loads hook source and runs the hook.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>hook_source</code></td>
        <td><code>Source</code></td>
        <td><p>The source of the hook function.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>step_exception</code></td>
        <td><code>Optional[BaseException]</code></td>
        <td><p>The exception of the original step.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_and_run_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">hook_source</span><span class="p">:</span> <span class="s2">&quot;Source&quot;</span><span class="p">,</span>
    <span class="n">step_exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads hook source and runs the hook.</span>

<span class="sd">    Args:</span>
<span class="sd">        hook_source: The source of the hook function.</span>
<span class="sd">        step_exception: The exception of the original step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">hook</span> <span class="o">=</span> <span class="n">source_utils</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">hook_source</span><span class="p">)</span>
        <span class="n">hook_spec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>

        <span class="n">function_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_hook_inputs</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="n">hook_spec</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
            <span class="n">annotations</span><span class="o">=</span><span class="n">hook_spec</span><span class="o">.</span><span class="n">annotations</span><span class="p">,</span>
            <span class="n">step_exception</span><span class="o">=</span><span class="n">step_exception</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running hook </span><span class="si">{</span><span class="n">hook</span><span class="si">}</span><span class="s2"> with params: </span><span class="si">{</span><span class="n">function_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">hook</span><span class="p">(</span><span class="o">**</span><span class="n">function_params</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to load hook source with exception: &#39;</span><span class="si">{</span><span class="n">hook_source</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.step_runner.StepRunner.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_run</span><span class="p">,</span> <span class="n">step_run</span><span class="p">,</span> <span class="n">input_artifacts</span><span class="p">,</span> <span class="n">output_artifact_uris</span><span class="p">,</span> <span class="n">step_run_info</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Runs the step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pipeline_run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The model of the current pipeline run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>step_run</code></td>
        <td><code>StepRunResponse</code></td>
        <td><p>The model of the current step run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>input_artifacts</code></td>
        <td><code>Dict[str, zenml.models.v2.core.step_run.StepRunInputResponse]</code></td>
        <td><p>The input artifact versions of the step.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_artifact_uris</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>The URIs of the output artifacts of the step.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>step_run_info</code></td>
        <td><code>StepRunInfo</code></td>
        <td><p>The step run info.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>BaseException</code></td>
        <td><p>A general exception if the step fails.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/step_runner.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pipeline_run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">,</span>
    <span class="n">step_run</span><span class="p">:</span> <span class="s2">&quot;StepRunResponse&quot;</span><span class="p">,</span>
    <span class="n">input_artifacts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StepRunInputResponse</span><span class="p">],</span>
    <span class="n">output_artifact_uris</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">step_run_info</span><span class="p">:</span> <span class="n">StepRunInfo</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the step.</span>

<span class="sd">    Args:</span>
<span class="sd">        pipeline_run: The model of the current pipeline run.</span>
<span class="sd">        step_run: The model of the current step run.</span>
<span class="sd">        input_artifacts: The input artifact versions of the step.</span>
<span class="sd">        output_artifact_uris: The URIs of the output artifacts of the step.</span>
<span class="sd">        step_run_info: The step run info.</span>

<span class="sd">    Raises:</span>
<span class="sd">        BaseException: A general exception if the step fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">handle_bool_env_var</span><span class="p">(</span><span class="n">ENV_ZENML_DISABLE_STEP_LOGS_STORAGE</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">step_logging_enabled</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">enabled_on_step</span> <span class="o">=</span> <span class="n">step_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_step_logs</span>
        <span class="n">enabled_on_pipeline</span> <span class="o">=</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_step_logs</span>

        <span class="n">step_logging_enabled</span> <span class="o">=</span> <span class="n">is_setting_enabled</span><span class="p">(</span>
            <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">enabled_on_step</span><span class="p">,</span>
            <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="n">enabled_on_pipeline</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">logs_context</span> <span class="o">=</span> <span class="n">nullcontext</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">step_logging_enabled</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">redirected</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">step_run</span><span class="o">.</span><span class="n">logs</span><span class="p">:</span>
            <span class="n">logs_context</span> <span class="o">=</span> <span class="n">StepLogsStorageContext</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
                <span class="n">logs_uri</span><span class="o">=</span><span class="n">step_run</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span>
                <span class="n">artifact_store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;There is no LogsResponseModel prepared for the step. The&quot;</span>
                <span class="s2">&quot;step logging storage is disabled.&quot;</span>
            <span class="p">)</span>

    <span class="k">with</span> <span class="n">logs_context</span><span class="p">:</span>
        <span class="n">step_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_step</span><span class="p">()</span>
        <span class="n">output_materializers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_output_materializers</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span>
            <span class="n">inspect</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">step_instance</span><span class="o">.</span><span class="n">entrypoint</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">output_annotations</span> <span class="o">=</span> <span class="n">parse_return_type_annotations</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="n">step_instance</span><span class="o">.</span><span class="n">entrypoint</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_artifact_names_in_collections</span><span class="p">(</span>
            <span class="n">step_run</span><span class="p">,</span>
            <span class="n">output_annotations</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">output_artifact_uris</span><span class="p">,</span>
                <span class="n">output_materializers</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">prepare_step_run</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">)</span>

        <span class="c1"># Initialize the step context singleton</span>
        <span class="n">StepContext</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>
        <span class="n">step_context</span> <span class="o">=</span> <span class="n">StepContext</span><span class="p">(</span>
            <span class="n">pipeline_run</span><span class="o">=</span><span class="n">pipeline_run</span><span class="p">,</span>
            <span class="n">step_run</span><span class="o">=</span><span class="n">step_run</span><span class="p">,</span>
            <span class="n">output_materializers</span><span class="o">=</span><span class="n">output_materializers</span><span class="p">,</span>
            <span class="n">output_artifact_uris</span><span class="o">=</span><span class="n">output_artifact_uris</span><span class="p">,</span>
            <span class="n">output_artifact_configs</span><span class="o">=</span><span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">artifact_config</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output_annotations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="c1"># Parse the inputs for the entrypoint function.</span>
        <span class="n">function_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_inputs</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
            <span class="n">annotations</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">annotations</span><span class="p">,</span>
            <span class="n">input_artifacts</span><span class="o">=</span><span class="n">input_artifacts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">step_failed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_values</span> <span class="o">=</span> <span class="n">step_instance</span><span class="o">.</span><span class="n">call_entrypoint</span><span class="p">(</span>
                <span class="o">**</span><span class="n">function_params</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">step_exception</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
            <span class="n">step_failed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">handle_bool_env_var</span><span class="p">(</span>
                <span class="n">ENV_ZENML_IGNORE_FAILURE_HOOK</span><span class="p">,</span> <span class="kc">False</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">failure_hook_source</span>
                    <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">failure_hook_source</span>
                <span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detected failure hook. Running...&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_and_run_hook</span><span class="p">(</span>
                        <span class="n">failure_hook_source</span><span class="p">,</span>
                        <span class="n">step_exception</span><span class="o">=</span><span class="n">step_exception</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">step_run_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">get_step_run_metadata</span><span class="p">(</span>
                    <span class="n">info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">publish_step_run_metadata</span><span class="p">(</span>
                    <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">step_run_id</span><span class="p">,</span>
                    <span class="n">step_run_metadata</span><span class="o">=</span><span class="n">step_run_metadata</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">cleanup_step_run</span><span class="p">(</span>
                    <span class="n">info</span><span class="o">=</span><span class="n">step_run_info</span><span class="p">,</span> <span class="n">step_failed</span><span class="o">=</span><span class="n">step_failed</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">step_failed</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">success_hook_source</span>
                        <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">success_hook_source</span>
                    <span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detected success hook. Running...&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">load_and_run_hook</span><span class="p">(</span>
                            <span class="n">success_hook_source</span><span class="p">,</span>
                            <span class="n">step_exception</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="c1"># Store and publish the output artifacts of the step function.</span>
                    <span class="n">output_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_outputs</span><span class="p">(</span>
                        <span class="n">return_values</span><span class="p">,</span> <span class="n">output_annotations</span>
                    <span class="p">)</span>
                    <span class="n">artifact_metadata_enabled</span> <span class="o">=</span> <span class="n">is_setting_enabled</span><span class="p">(</span>
                        <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_artifact_metadata</span><span class="p">,</span>
                        <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">enable_artifact_metadata</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">artifact_visualization_enabled</span> <span class="o">=</span> <span class="n">is_setting_enabled</span><span class="p">(</span>
                        <span class="n">is_enabled_on_step</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_artifact_visualization</span><span class="p">,</span>
                        <span class="n">is_enabled_on_pipeline</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">enable_artifact_visualization</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">output_artifacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store_output_artifacts</span><span class="p">(</span>
                        <span class="n">output_data</span><span class="o">=</span><span class="n">output_data</span><span class="p">,</span>
                        <span class="n">output_artifact_uris</span><span class="o">=</span><span class="n">output_artifact_uris</span><span class="p">,</span>
                        <span class="n">output_materializers</span><span class="o">=</span><span class="n">output_materializers</span><span class="p">,</span>
                        <span class="n">output_annotations</span><span class="o">=</span><span class="n">output_annotations</span><span class="p">,</span>
                        <span class="n">artifact_metadata_enabled</span><span class="o">=</span><span class="n">artifact_metadata_enabled</span><span class="p">,</span>
                        <span class="n">artifact_visualization_enabled</span><span class="o">=</span><span class="n">artifact_visualization_enabled</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">model_version</span> <span class="o">:=</span> <span class="n">step_run</span><span class="o">.</span><span class="n">model_version</span>
                        <span class="ow">or</span> <span class="n">pipeline_run</span><span class="o">.</span><span class="n">model_version</span>
                    <span class="p">):</span>
                        <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.orchestrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">step_run_utils</span>

                        <span class="n">step_run_utils</span><span class="o">.</span><span class="n">link_output_artifacts_to_model_version</span><span class="p">(</span>
                            <span class="n">artifacts</span><span class="o">=</span><span class="p">{</span>
                                <span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output_artifacts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                            <span class="p">},</span>
                            <span class="n">model_version</span><span class="o">=</span><span class="n">model_version</span><span class="p">,</span>
                        <span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">step_context</span><span class="o">.</span><span class="n">_cleanup_registry</span><span class="o">.</span><span class="n">execute_callbacks</span><span class="p">(</span>
                    <span class="n">raise_on_exception</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
                <span class="n">StepContext</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>  <span class="c1"># Remove the step context singleton</span>

        <span class="c1"># Update the status and output artifacts of the step run.</span>
        <span class="n">output_artifact_ids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">output_name</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">artifact</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">output_name</span><span class="p">,</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">output_artifacts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">publish_successful_step_run</span><span class="p">(</span>
            <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run_info</span><span class="o">.</span><span class="n">step_run_id</span><span class="p">,</span>
            <span class="n">output_artifact_ids</span><span class="o">=</span><span class="n">output_artifact_ids</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.topsort" class="doc doc-heading">
        <code>topsort</code>



</h3>

    <div class="doc doc-contents ">

      <p>Utilities for topological sort.</p>
<p>Implementation heavily inspired by TFX:
https://github.com/tensorflow/tfx/blob/master/tfx/utils/topsort.py</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.topsort.topsorted_layers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">topsorted_layers</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">get_node_id_fn</span><span class="p">,</span> <span class="n">get_parent_nodes</span><span class="p">,</span> <span class="n">get_child_nodes</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Sorts the DAG of nodes in topological order.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>nodes</code></td>
        <td><code>Sequence[~NodeT]</code></td>
        <td><p>A sequence of nodes.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>get_node_id_fn</code></td>
        <td><code>Callable[[~NodeT], str]</code></td>
        <td><p>Callable that returns a unique text identifier for a node.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>get_parent_nodes</code></td>
        <td><code>Callable[[~NodeT], List[~NodeT]]</code></td>
        <td><p>Callable that returns a list of parent nodes for a node.
If a parent node's id is not found in the list of node ids, that parent
node will be omitted.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>get_child_nodes</code></td>
        <td><code>Callable[[~NodeT], List[~NodeT]]</code></td>
        <td><p>Callable that returns a list of child nodes for a node.
If a child node's id is not found in the list of node ids, that child
node will be omitted.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[List[~NodeT]]</code></td>
      <td><p>A list of topologically ordered node layers. Each layer of nodes is sorted
by its node id given by <code>get_node_id_fn</code>.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the input nodes don't form a DAG.</p></td>
      </tr>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the nodes are not unique.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/topsort.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">topsorted_layers</span><span class="p">(</span>
    <span class="n">nodes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">NodeT</span><span class="p">],</span>
    <span class="n">get_node_id_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">NodeT</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">get_parent_nodes</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">NodeT</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeT</span><span class="p">]],</span>
    <span class="n">get_child_nodes</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">NodeT</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeT</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">NodeT</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sorts the DAG of nodes in topological order.</span>

<span class="sd">    Args:</span>
<span class="sd">        nodes: A sequence of nodes.</span>
<span class="sd">        get_node_id_fn: Callable that returns a unique text identifier for a node.</span>
<span class="sd">        get_parent_nodes: Callable that returns a list of parent nodes for a node.</span>
<span class="sd">            If a parent node&#39;s id is not found in the list of node ids, that parent</span>
<span class="sd">            node will be omitted.</span>
<span class="sd">        get_child_nodes: Callable that returns a list of child nodes for a node.</span>
<span class="sd">            If a child node&#39;s id is not found in the list of node ids, that child</span>
<span class="sd">            node will be omitted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of topologically ordered node layers. Each layer of nodes is sorted</span>
<span class="sd">        by its node id given by `get_node_id_fn`.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the input nodes don&#39;t form a DAG.</span>
<span class="sd">        ValueError: If the nodes are not unique.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make sure the nodes are unique.</span>
    <span class="n">node_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">get_node_id_fn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nodes must have unique ids.&quot;</span><span class="p">)</span>

    <span class="c1"># The outputs of get_(parent|child)_nodes should always be deduplicated,</span>
    <span class="c1"># and references to unknown nodes should be removed.</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_and_clean</span><span class="p">(</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">NodeT</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeT</span><span class="p">]],</span> <span class="n">func_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">NodeT</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeT</span><span class="p">]:</span>
        <span class="n">seen_inner_node_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">inner_node</span> <span class="ow">in</span> <span class="n">func</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">inner_node_id</span> <span class="o">=</span> <span class="n">get_node_id_fn</span><span class="p">(</span><span class="n">inner_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inner_node_id</span> <span class="ow">in</span> <span class="n">seen_inner_node_ids</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Duplicate node_id </span><span class="si">%s</span><span class="s2"> found when calling </span><span class="si">%s</span><span class="s2"> on node </span><span class="si">%s</span><span class="s2">. &quot;</span>
                    <span class="s2">&quot;This entry will be ignored.&quot;</span><span class="p">,</span>
                    <span class="n">inner_node_id</span><span class="p">,</span>
                    <span class="n">func_name</span><span class="p">,</span>
                    <span class="n">node</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">inner_node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;node_id </span><span class="si">%s</span><span class="s2"> found when calling </span><span class="si">%s</span><span class="s2"> on node </span><span class="si">%s</span><span class="s2">, but this node_id is &quot;</span>
                    <span class="s2">&quot;not found in the set of input nodes </span><span class="si">%s</span><span class="s2">. This entry will be &quot;</span>
                    <span class="s2">&quot;ignored.&quot;</span><span class="p">,</span>
                    <span class="n">inner_node_id</span><span class="p">,</span>
                    <span class="n">func_name</span><span class="p">,</span>
                    <span class="n">node</span><span class="p">,</span>
                    <span class="n">node_ids</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">seen_inner_node_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">inner_node_id</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_node</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_clean_parent_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">NodeT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeT</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_apply_and_clean</span><span class="p">(</span><span class="n">get_parent_nodes</span><span class="p">,</span> <span class="s2">&quot;get_parent_nodes&quot;</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_clean_child_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">NodeT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeT</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_apply_and_clean</span><span class="p">(</span><span class="n">get_child_nodes</span><span class="p">,</span> <span class="s2">&quot;get_child_nodes&quot;</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="c1"># The first layer contains nodes with no incoming edges.</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">get_clean_parent_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span>

    <span class="n">visited_node_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">layer</span><span class="p">:</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_node_id_fn</span><span class="p">)</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>

        <span class="n">next_layer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
            <span class="n">visited_node_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_node_id_fn</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">child_node</span> <span class="ow">in</span> <span class="n">get_clean_child_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="c1"># Include the child node if all its parents are visited. If the child</span>
                <span class="c1"># node is part of a cycle, it will never be included since it will have</span>
                <span class="c1"># at least one unvisited parent node which is also part of the cycle.</span>
                <span class="n">parent_node_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">get_node_id_fn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">get_clean_parent_nodes</span><span class="p">(</span><span class="n">child_node</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">parent_node_ids</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">visited_node_ids</span><span class="p">):</span>
                    <span class="n">next_layer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child_node</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">next_layer</span>

    <span class="n">num_output_nodes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">)</span>
    <span class="c1"># Nodes in cycles are not included in layers; raise an error if this happens.</span>
    <span class="k">if</span> <span class="n">num_output_nodes</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Cannot sort graph because it contains a cycle.&quot;</span><span class="p">)</span>
    <span class="c1"># This should never happen; raise an error if this occurs.</span>
    <span class="k">if</span> <span class="n">num_output_nodes</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown error occurred while sorting DAG.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">layers</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.utils" class="doc doc-heading">
        <code>utils</code>



</h3>

    <div class="doc doc-contents ">

      <p>Utility functions for the orchestrator.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.utils.register_artifact_store_filesystem" class="doc doc-heading">
        <code>
register_artifact_store_filesystem        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Context manager for the artifact_store/filesystem_registry dependency.</p>
<p>Even though it is rare, sometimes we bump into cases where we are trying to
load artifacts that belong to an artifact store which is different from
the active artifact store.</p>
<p>In cases like this, we will try to instantiate the target artifact store
by creating the corresponding artifact store Python object, which ends up
registering the right filesystem in the filesystem registry.</p>
<p>The problem is, the keys in the filesystem registry are schemes (such as
"s3://" or "gcs://"). If we have two artifact stores with the same set of
supported schemes, we might end up overwriting the filesystem that belongs
to the active artifact store (and its authentication). That's why we have
to re-instantiate the active artifact store again, so the correct filesystem
will be restored.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">register_artifact_store_filesystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for the artifact_store/filesystem_registry dependency.</span>

<span class="sd">    Even though it is rare, sometimes we bump into cases where we are trying to</span>
<span class="sd">    load artifacts that belong to an artifact store which is different from</span>
<span class="sd">    the active artifact store.</span>

<span class="sd">    In cases like this, we will try to instantiate the target artifact store</span>
<span class="sd">    by creating the corresponding artifact store Python object, which ends up</span>
<span class="sd">    registering the right filesystem in the filesystem registry.</span>

<span class="sd">    The problem is, the keys in the filesystem registry are schemes (such as</span>
<span class="sd">    &quot;s3://&quot; or &quot;gcs://&quot;). If we have two artifact stores with the same set of</span>
<span class="sd">    supported schemes, we might end up overwriting the filesystem that belongs</span>
<span class="sd">    to the active artifact store (and its authentication). That&#39;s why we have</span>
<span class="sd">    to re-instantiate the active artifact store again, so the correct filesystem</span>
<span class="sd">    will be restored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_artifact_store_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialization of the context manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_artifact_store_id: the ID of the artifact store to load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span> <span class="o">=</span> <span class="n">target_artifact_store_id</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BaseArtifactStore&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entering the context manager.</span>

<span class="sd">        It creates an instance of the target artifact store to register the</span>
<span class="sd">        correct filesystem in the registry.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The target artifact store object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the target artifact store can not be fetched or</span>
<span class="sd">                initiated due to missing dependencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">id</span>
                    <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span>
                <span class="p">):</span>
                    <span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Trying to use the artifact store with ID:&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;which is currently not the active artifact store.&quot;</span>
                    <span class="p">)</span>

                <span class="n">artifact_store_model_response</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">get_stack_component</span><span class="p">(</span>
                    <span class="n">component_type</span><span class="o">=</span><span class="n">StackComponentType</span><span class="o">.</span><span class="n">ARTIFACT_STORE</span><span class="p">,</span>
                    <span class="n">name_id_or_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="s2">&quot;BaseArtifactStore&quot;</span><span class="p">,</span>
                    <span class="n">StackComponent</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span><span class="n">artifact_store_model_response</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack</span><span class="o">.</span><span class="n">artifact_store</span>

        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to fetch the artifact store with id: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span><span class="si">}</span><span class="s2">&#39;. Check whether the &quot;</span>
                <span class="s2">&quot;artifact store still exists and you have the right &quot;</span>
                <span class="s2">&quot;permissions to access it.&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to load the implementation of the artifact store with&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;id: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span><span class="si">}</span><span class="s2">&#39;. Please make sure that &quot;</span>
                <span class="s2">&quot;the environment that you are loading this artifact from &quot;</span>
                <span class="s2">&quot;has the right dependencies.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">exc_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set it back to the original state.</span>

<span class="sd">        Args:</span>
<span class="sd">            exc_type: The class of the exception</span>
<span class="sd">            exc_value: The instance of the exception</span>
<span class="sd">            traceback: The traceback of the exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ENV_ZENML_SERVER</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="c1"># As we exit the handler, we have to re-register the filesystem</span>
            <span class="c1"># that belongs to the active artifact store as it may have been</span>
            <span class="c1"># overwritten.</span>
            <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">_register</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.utils.register_artifact_store_filesystem.__enter__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Entering the context manager.</p>
<p>It creates an instance of the target artifact store to register the
correct filesystem in the registry.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>BaseArtifactStore</code></td>
      <td><p>The target artifact store object.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the target artifact store can not be fetched or
initiated due to missing dependencies.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BaseArtifactStore&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entering the context manager.</span>

<span class="sd">    It creates an instance of the target artifact store to register the</span>
<span class="sd">    correct filesystem in the registry.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The target artifact store object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the target artifact store can not be fetched or</span>
<span class="sd">            initiated due to missing dependencies.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">id</span>
                <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span>
            <span class="p">):</span>
                <span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Trying to use the artifact store with ID:&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;which is currently not the active artifact store.&quot;</span>
                <span class="p">)</span>

            <span class="n">artifact_store_model_response</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">get_stack_component</span><span class="p">(</span>
                <span class="n">component_type</span><span class="o">=</span><span class="n">StackComponentType</span><span class="o">.</span><span class="n">ARTIFACT_STORE</span><span class="p">,</span>
                <span class="n">name_id_or_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
                <span class="s2">&quot;BaseArtifactStore&quot;</span><span class="p">,</span>
                <span class="n">StackComponent</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span><span class="n">artifact_store_model_response</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack</span><span class="o">.</span><span class="n">artifact_store</span>

    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Unable to fetch the artifact store with id: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span><span class="si">}</span><span class="s2">&#39;. Check whether the &quot;</span>
            <span class="s2">&quot;artifact store still exists and you have the right &quot;</span>
            <span class="s2">&quot;permissions to access it.&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Unable to load the implementation of the artifact store with&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;id: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span><span class="si">}</span><span class="s2">&#39;. Please make sure that &quot;</span>
            <span class="s2">&quot;the environment that you are loading this artifact from &quot;</span>
            <span class="s2">&quot;has the right dependencies.&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.utils.register_artifact_store_filesystem.__exit__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Set it back to the original state.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>exc_type</code></td>
        <td><code>Optional[Any]</code></td>
        <td><p>The class of the exception</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>exc_value</code></td>
        <td><code>Optional[Any]</code></td>
        <td><p>The instance of the exception</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>traceback</code></td>
        <td><code>Optional[Any]</code></td>
        <td><p>The traceback of the exception</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">exc_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set it back to the original state.</span>

<span class="sd">    Args:</span>
<span class="sd">        exc_type: The class of the exception</span>
<span class="sd">        exc_value: The instance of the exception</span>
<span class="sd">        traceback: The traceback of the exception</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ENV_ZENML_SERVER</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="c1"># As we exit the handler, we have to re-register the filesystem</span>
        <span class="c1"># that belongs to the active artifact store as it may have been</span>
        <span class="c1"># overwritten.</span>
        <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">_register</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.utils.register_artifact_store_filesystem.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_artifact_store_id</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Initialization of the context manager.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>target_artifact_store_id</code></td>
        <td><code>Optional[uuid.UUID]</code></td>
        <td><p>the ID of the artifact store to load.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_artifact_store_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialization of the context manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_artifact_store_id: the ID of the artifact store to load.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_artifact_store_id</span> <span class="o">=</span> <span class="n">target_artifact_store_id</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.utils.get_config_environment_vars" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_config_environment_vars</span><span class="p">(</span><span class="n">schedule_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_run_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step_run_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Gets environment variables to set for mirroring the active config.</p>
<p>If a schedule ID, pipeline run ID or step run ID is given, and the current
client is not authenticated to a server with an API key, the environment
variables will be updated to include a newly generated workload API token
that will be valid for the duration of the schedule, pipeline run, or step
run instead of the current API token used to authenticate the client.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>schedule_id</code></td>
        <td><code>Optional[uuid.UUID]</code></td>
        <td><p>Optional schedule ID to use to generate a new API token.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>pipeline_run_id</code></td>
        <td><code>Optional[uuid.UUID]</code></td>
        <td><p>Optional pipeline run ID to use to generate a new API
token.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>step_run_id</code></td>
        <td><code>Optional[uuid.UUID]</code></td>
        <td><p>Optional step run ID to use to generate a new API token.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, str]</code></td>
      <td><p>Environment variable dict.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_config_environment_vars</span><span class="p">(</span>
    <span class="n">schedule_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pipeline_run_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">step_run_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets environment variables to set for mirroring the active config.</span>

<span class="sd">    If a schedule ID, pipeline run ID or step run ID is given, and the current</span>
<span class="sd">    client is not authenticated to a server with an API key, the environment</span>
<span class="sd">    variables will be updated to include a newly generated workload API token</span>
<span class="sd">    that will be valid for the duration of the schedule, pipeline run, or step</span>
<span class="sd">    run instead of the current API token used to authenticate the client.</span>

<span class="sd">    Args:</span>
<span class="sd">        schedule_id: Optional schedule ID to use to generate a new API token.</span>
<span class="sd">        pipeline_run_id: Optional pipeline run ID to use to generate a new API</span>
<span class="sd">            token.</span>
<span class="sd">        step_run_id: Optional step run ID to use to generate a new API token.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Environment variable dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.login.credentials_store</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_credentials_store</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">zenml.zen_stores.rest_zen_store</span><span class="w"> </span><span class="kn">import</span> <span class="n">RestZenStore</span>

    <span class="n">global_config</span> <span class="o">=</span> <span class="n">GlobalConfiguration</span><span class="p">()</span>
    <span class="n">environment_vars</span> <span class="o">=</span> <span class="n">global_config</span><span class="o">.</span><span class="n">get_config_environment_vars</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">global_config</span><span class="o">.</span><span class="n">store_configuration</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">StoreType</span><span class="o">.</span><span class="n">REST</span>
        <span class="ow">and</span> <span class="n">global_config</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">get_store_info</span><span class="p">()</span><span class="o">.</span><span class="n">auth_scheme</span>
        <span class="o">!=</span> <span class="n">AuthScheme</span><span class="o">.</span><span class="n">NO_AUTH</span>
    <span class="p">):</span>
        <span class="n">credentials_store</span> <span class="o">=</span> <span class="n">get_credentials_store</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">global_config</span><span class="o">.</span><span class="n">store_configuration</span><span class="o">.</span><span class="n">url</span>
        <span class="n">api_token</span> <span class="o">=</span> <span class="n">credentials_store</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_expired</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">schedule_id</span> <span class="ow">or</span> <span class="n">pipeline_run_id</span> <span class="ow">or</span> <span class="n">step_run_id</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">global_config</span><span class="o">.</span><span class="n">zen_store</span><span class="p">,</span> <span class="n">RestZenStore</span><span class="p">)</span>

            <span class="c1"># The user has the option to manually set an expiration for the API</span>
            <span class="c1"># token generated for a pipeline run. In this case, we generate a new</span>
            <span class="c1"># generic API token that will be valid for the indicated duration.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">pipeline_run_id</span>
                <span class="ow">and</span> <span class="n">ZENML_PIPELINE_RUN_API_TOKEN_EXPIRATION</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;An unscoped API token will be generated for this pipeline &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;run that will expire after &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ZENML_PIPELINE_RUN_API_TOKEN_EXPIRATION</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;seconds instead of being scoped to the pipeline run &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;and not having an expiration time. This is more insecure &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;because the API token will remain valid even after the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;pipeline run completes its execution. This option has &quot;</span>
                    <span class="s2">&quot;been explicitly enabled by setting the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ENV_ZENML_PIPELINE_RUN_API_TOKEN_EXPIRATION</span><span class="si">}</span><span class="s2"> environment &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;variable&quot;</span>
                <span class="p">)</span>
                <span class="n">new_api_token</span> <span class="o">=</span> <span class="n">global_config</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">get_api_token</span><span class="p">(</span>
                    <span class="n">token_type</span><span class="o">=</span><span class="n">APITokenType</span><span class="o">.</span><span class="n">GENERIC</span><span class="p">,</span>
                    <span class="n">expires_in</span><span class="o">=</span><span class="n">ZENML_PIPELINE_RUN_API_TOKEN_EXPIRATION</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If a schedule ID, pipeline run ID or step run ID is supplied,</span>
                <span class="c1"># we need to fetch a new workload API token scoped to the</span>
                <span class="c1"># schedule, pipeline run or step run.</span>

                <span class="c1"># If only a schedule is given, the pipeline run credentials will</span>
                <span class="c1"># be valid for the entire duration of the schedule.</span>
                <span class="n">api_key</span> <span class="o">=</span> <span class="n">credentials_store</span><span class="o">.</span><span class="n">get_api_key</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pipeline_run_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">step_run_id</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;An API token without an expiration time will be generated &quot;</span>
                        <span class="s2">&quot;and used to run this pipeline on a schedule. This is very &quot;</span>
                        <span class="s2">&quot;insecure because the API token will be valid for the &quot;</span>
                        <span class="s2">&quot;entire lifetime of the schedule and can be used to access &quot;</span>
                        <span class="s2">&quot;your user account if accidentally leaked. When deploying &quot;</span>
                        <span class="s2">&quot;a pipeline on a schedule, it is strongly advised to use a &quot;</span>
                        <span class="s2">&quot;service account API key to authenticate to the ZenML &quot;</span>
                        <span class="s2">&quot;server instead of your regular user account. For more &quot;</span>
                        <span class="s2">&quot;information, see &quot;</span>
                        <span class="s2">&quot;https://docs.zenml.io/how-to/connecting-to-zenml/connect-with-a-service-account&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># The schedule, pipeline run or step run credentials are scoped to</span>
                <span class="c1"># the schedule, pipeline run or step run and will only be valid for</span>
                <span class="c1"># the duration of the schedule/pipeline run/step run.</span>
                <span class="n">new_api_token</span> <span class="o">=</span> <span class="n">global_config</span><span class="o">.</span><span class="n">zen_store</span><span class="o">.</span><span class="n">get_api_token</span><span class="p">(</span>
                    <span class="n">token_type</span><span class="o">=</span><span class="n">APITokenType</span><span class="o">.</span><span class="n">WORKLOAD</span><span class="p">,</span>
                    <span class="n">schedule_id</span><span class="o">=</span><span class="n">schedule_id</span><span class="p">,</span>
                    <span class="n">pipeline_run_id</span><span class="o">=</span><span class="n">pipeline_run_id</span><span class="p">,</span>
                    <span class="n">step_run_id</span><span class="o">=</span><span class="n">step_run_id</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">environment_vars</span><span class="p">[</span><span class="n">ENV_ZENML_STORE_PREFIX</span> <span class="o">+</span> <span class="s2">&quot;API_TOKEN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">new_api_token</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">api_token</span><span class="p">:</span>
            <span class="c1"># For all other cases, the pipeline run environment is configured</span>
            <span class="c1"># with the current access token.</span>
            <span class="n">environment_vars</span><span class="p">[</span><span class="n">ENV_ZENML_STORE_PREFIX</span> <span class="o">+</span> <span class="s2">&quot;API_TOKEN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">api_token</span><span class="o">.</span><span class="n">access_token</span>
            <span class="p">)</span>

    <span class="c1"># Disable credentials caching to avoid storing sensitive information</span>
    <span class="c1"># in the pipeline run environment</span>
    <span class="n">environment_vars</span><span class="p">[</span><span class="n">ENV_ZENML_DISABLE_CREDENTIALS_DISK_CACHING</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>

    <span class="c1"># Make sure to use the correct active stack/workspace which might come</span>
    <span class="c1"># from a .zen repository and not the global config</span>
    <span class="n">environment_vars</span><span class="p">[</span><span class="n">ENV_ZENML_ACTIVE_STACK_ID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_stack_model</span><span class="o">.</span><span class="n">id</span>
    <span class="p">)</span>
    <span class="n">environment_vars</span><span class="p">[</span><span class="n">ENV_ZENML_ACTIVE_WORKSPACE_ID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">active_workspace</span><span class="o">.</span><span class="n">id</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">environment_vars</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.utils.get_orchestrator_run_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_orchestrator_run_name</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Gets an orchestrator run name.</p>
<p>This run name is not the same as the ZenML run name but can instead be
used to display in the orchestrator UI.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pipeline_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the pipeline that will run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>max_length</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>Maximum length of the generated name.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the max length is below 8 characters.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The orchestrator run name.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_orchestrator_run_name</span><span class="p">(</span>
    <span class="n">pipeline_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets an orchestrator run name.</span>

<span class="sd">    This run name is not the same as the ZenML run name but can instead be</span>
<span class="sd">    used to display in the orchestrator UI.</span>

<span class="sd">    Args:</span>
<span class="sd">        pipeline_name: Name of the pipeline that will run.</span>
<span class="sd">        max_length: Maximum length of the generated name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the max length is below 8 characters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The orchestrator run name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suffix_length</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">pipeline_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pipeline_name</span><span class="si">}</span><span class="s2">_&quot;</span>

    <span class="k">if</span> <span class="n">max_length</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">max_length</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Maximum length for orchestrator run name must be 8 or above.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Make sure we always have a certain suffix to guarantee no overlap</span>
        <span class="c1"># with other runs</span>
        <span class="n">suffix_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)))</span>
        <span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">pipeline_name</span><span class="p">[:</span> <span class="p">(</span><span class="n">max_length</span> <span class="o">-</span> <span class="n">suffix_length</span><span class="p">)]</span>

    <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="s2">&quot;0123456789abcdef&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">suffix_length</span><span class="p">))</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pipeline_name</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="zenml.orchestrators.utils.is_setting_enabled" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_setting_enabled</span><span class="p">(</span><span class="n">is_enabled_on_step</span><span class="p">,</span> <span class="n">is_enabled_on_pipeline</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Checks if a certain setting is enabled within a step run.</p>
<p>This is the case if:
- the setting is explicitly enabled for the step, or
- the setting is neither explicitly disabled for the step nor the pipeline.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>is_enabled_on_step</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>The setting of the step.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>is_enabled_on_pipeline</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>The setting of the pipeline.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if the setting is enabled within the step run, False otherwise.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_setting_enabled</span><span class="p">(</span>
    <span class="n">is_enabled_on_step</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="n">is_enabled_on_pipeline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if a certain setting is enabled within a step run.</span>

<span class="sd">    This is the case if:</span>
<span class="sd">    - the setting is explicitly enabled for the step, or</span>
<span class="sd">    - the setting is neither explicitly disabled for the step nor the pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">        is_enabled_on_step: The setting of the step.</span>
<span class="sd">        is_enabled_on_pipeline: The setting of the pipeline.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the setting is enabled within the step run, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_enabled_on_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">is_enabled_on_step</span>
    <span class="k">if</span> <span class="n">is_enabled_on_pipeline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">is_enabled_on_pipeline</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.orchestrators.wheeled_orchestrator" class="doc doc-heading">
        <code>wheeled_orchestrator</code>



</h3>

    <div class="doc doc-contents ">

      <p>Wheeled orchestrator class.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h4 id="zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator" class="doc doc-heading">
        <code>
WheeledOrchestrator            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestrator" href="#zenml.orchestrators.base_orchestrator.BaseOrchestrator">BaseOrchestrator</a>, <span title="abc.ABC">ABC</span>)
        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Base class for wheeled orchestrators.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/wheeled_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WheeledOrchestrator</span><span class="p">(</span><span class="n">BaseOrchestrator</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for wheeled orchestrators.&quot;&quot;&quot;</span>

    <span class="n">package_name</span> <span class="o">=</span> <span class="n">DEFAULT_PACKAGE_NAME</span>
    <span class="n">package_version</span> <span class="o">=</span> <span class="n">__version__</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy_repository_to_temp_dir_and_add_setup_py</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy the repository to a temporary directory and add a setup.py file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path to the temporary directory containing the copied repository.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">repo_path</span> <span class="o">=</span> <span class="n">get_source_root</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_PACKAGE_NAME</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sanitize_name</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">repo_path</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Create a temporary folder</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;zenml-temp-&quot;</span><span class="p">)</span>

        <span class="c1"># Create a folder within the temporary directory</span>
        <span class="n">temp_repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>
        <span class="n">fileio</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">temp_repo_path</span><span class="p">)</span>

        <span class="c1"># Copy the repository to the temporary directory</span>
        <span class="n">copy_dir</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="n">temp_repo_path</span><span class="p">)</span>

        <span class="c1"># Create init file in the copied directory</span>
        <span class="n">init_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_repo_path</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">fileio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">init_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Create a setup.py file</span>
        <span class="n">setup_py_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">from setuptools import setup, find_packages</span>

<span class="s2">setup(</span>
<span class="s2">    name=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;,</span>
<span class="s2">    version=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_version</span><span class="si">}</span><span class="s2">&quot;,</span>
<span class="s2">    packages=find_packages(),</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">setup_py_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;setup.py&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">fileio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">setup_py_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">setup_py_content</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">temp_dir</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_wheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a wheel for the package in the given temporary directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            temp_dir (str): Path to the temporary directory containing the package.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the wheel file could not be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Path to the created wheel file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Change to the temporary directory</span>
        <span class="n">original_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Run the `pip wheel` command to create the wheel</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="s2">&quot;wheel&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wheel creation stdout: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wheel creation stderr: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Find the created wheel file</span>
            <span class="n">wheel_file</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">file</span>
                    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.whl&quot;</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">wheel_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to create wheel file.&quot;</span><span class="p">)</span>

            <span class="n">wheel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">wheel_file</span><span class="p">)</span>

            <span class="c1"># Verify the wheel file is a valid zip file</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">wheel_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">wheel_path</span><span class="si">}</span><span class="s2"> is not a valid zip file.&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">wheel_path</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Change back to the original directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">original_dir</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sanitize_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sanitize the value to be used in a cluster name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Arbitrary input cluster name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sanitized cluster name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;[^a-z0-9-]&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># replaces any character that is not a lowercase letter, digit, or hyphen with a hyphen</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[-]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># trim leading hyphens</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-]+$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># trim trailing hyphens</span>
        <span class="k">return</span> <span class="n">name</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.copy_repository_to_temp_dir_and_add_setup_py" class="doc doc-heading">
<code class="highlight language-python"><span class="n">copy_repository_to_temp_dir_and_add_setup_py</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Copy the repository to a temporary directory and add a setup.py file.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Path to the temporary directory containing the copied repository.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/wheeled_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="nf">copy_repository_to_temp_dir_and_add_setup_py</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy the repository to a temporary directory and add a setup.py file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path to the temporary directory containing the copied repository.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">repo_path</span> <span class="o">=</span> <span class="n">get_source_root</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_PACKAGE_NAME</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sanitize_name</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">repo_path</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Create a temporary folder</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;zenml-temp-&quot;</span><span class="p">)</span>

        <span class="c1"># Create a folder within the temporary directory</span>
        <span class="n">temp_repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>
        <span class="n">fileio</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">temp_repo_path</span><span class="p">)</span>

        <span class="c1"># Copy the repository to the temporary directory</span>
        <span class="n">copy_dir</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="n">temp_repo_path</span><span class="p">)</span>

        <span class="c1"># Create init file in the copied directory</span>
        <span class="n">init_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_repo_path</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">fileio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">init_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Create a setup.py file</span>
        <span class="n">setup_py_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">from setuptools import setup, find_packages</span>

<span class="s2">setup(</span>
<span class="s2">    name=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&quot;,</span>
<span class="s2">    version=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">package_version</span><span class="si">}</span><span class="s2">&quot;,</span>
<span class="s2">    packages=find_packages(),</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">setup_py_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;setup.py&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">fileio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">setup_py_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">setup_py_content</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">temp_dir</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.create_wheel" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_wheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Create a wheel for the package in the given temporary directory.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>temp_dir</code></td>
        <td><code>str</code></td>
        <td><p>Path to the temporary directory containing the package.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the wheel file could not be created.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Path to the created wheel file.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/wheeled_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_wheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a wheel for the package in the given temporary directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_dir (str): Path to the temporary directory containing the package.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the wheel file could not be created.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the created wheel file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Change to the temporary directory</span>
    <span class="n">original_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run the `pip wheel` command to create the wheel</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="s2">&quot;wheel&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wheel creation stdout: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wheel creation stderr: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Find the created wheel file</span>
        <span class="n">wheel_file</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">file</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.whl&quot;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">wheel_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to create wheel file.&quot;</span><span class="p">)</span>

        <span class="n">wheel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">wheel_file</span><span class="p">)</span>

        <span class="c1"># Verify the wheel file is a valid zip file</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">wheel_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">wheel_path</span><span class="si">}</span><span class="s2"> is not a valid zip file.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">wheel_path</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Change back to the original directory</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">original_dir</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="zenml.orchestrators.wheeled_orchestrator.WheeledOrchestrator.sanitize_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sanitize_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Sanitize the value to be used in a cluster name.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>Arbitrary input cluster name.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Sanitized cluster name.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/orchestrators/wheeled_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sanitize_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sanitize the value to be used in a cluster name.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Arbitrary input cluster name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sanitized cluster name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;[^a-z0-9-]&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># replaces any character that is not a lowercase letter, digit, or hyphen with a hyphen</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[-]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># trim leading hyphens</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-]+$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># trim trailing hyphens</span>
    <span class="k">return</span> <span class="n">name</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../core-models/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Models" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Models
            </div>
          </div>
        </a>
      
      
        
        <a href="../core-pipelines/" class="md-footer__link md-footer__link--next" aria-label="Next: Pipelines" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Pipelines
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 ZenML GmbH – <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  
    
  




<h4>This website uses cookies</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        <label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>